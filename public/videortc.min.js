/**
 ** videortc - Add real-time communication to your own applications.
 ** @author IntPowers <info@ivrpowers.com> (https://www.ivrpowers.com/)
 ** @version 3.3.0 - 2020-03-25
 **/
!function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var d=r[a]={exports:{}};t[a][0].call(d.exports,function(e){var r=t[a][1][e];return i(r||e)},d,d.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(e){"use strict";var t="undefined"!=typeof Uint8Array?Uint8Array:Array,r="+".charCodeAt(0),i="/".charCodeAt(0),o="0".charCodeAt(0),a="a".charCodeAt(0),s="A".charCodeAt(0),c="-".charCodeAt(0),d="_".charCodeAt(0);function l(e){var t=e.charCodeAt(0);return t===r||t===c?62:t===i||t===d?63:t<o?-1:t<o+10?t-o+26+26:t<s+26?t-s:t<a+26?t-a+26:void 0}e.toByteArray=function(e){var r,n,i,o,a,s;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=e.length;a="="===e.charAt(c-2)?2:"="===e.charAt(c-1)?1:0,s=new t(3*e.length/4-a),i=a>0?e.length-4:e.length;var d=0;function u(e){s[d++]=e}for(r=0,n=0;r<i;r+=4,n+=3)u((16711680&(o=l(e.charAt(r))<<18|l(e.charAt(r+1))<<12|l(e.charAt(r+2))<<6|l(e.charAt(r+3))))>>16),u((65280&o)>>8),u(255&o);return 2===a?u(255&(o=l(e.charAt(r))<<2|l(e.charAt(r+1))>>4)):1===a&&(u((o=l(e.charAt(r))<<10|l(e.charAt(r+1))<<4|l(e.charAt(r+2))>>2)>>8&255),u(255&o)),s},e.fromByteArray=function(e){var t,r,i,o,a=e.length%3,s="";function c(e){return n.charAt(e)}for(t=0,i=e.length-a;t<i;t+=3)r=(e[t]<<16)+(e[t+1]<<8)+e[t+2],s+=c((o=r)>>18&63)+c(o>>12&63)+c(o>>6&63)+c(63&o);switch(a){case 1:s+=c((r=e[e.length-1])>>2),s+=c(r<<4&63),s+="==";break;case 2:s+=c((r=(e[e.length-2]<<8)+e[e.length-1])>>10),s+=c(r>>4&63),s+=c(r<<2&63),s+="="}return s}}(void 0===r?this.base64js={}:r)},{}],2:[function(e,t,r){"use strict";t.exports=function(e){var t=e._SomePromiseArray;function r(e){var r=new t(e),n=r.promise();return r.setHowMany(1),r.setUnwrap(),r.init(),n}e.any=function(e){return r(e)},e.prototype.any=function(){return r(this)}}},{}],3:[function(e,t,r){(function(r){"use strict";var n;try{throw new Error}catch(e){n=e}var i=e("./schedule"),o=e("./queue"),a=e("./util");function s(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new o(16),this._normalQueue=new o(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=i}function c(e,t,r){this._lateQueue.push(e,t,r),this._queueTick()}function d(e,t,r){this._normalQueue.push(e,t,r),this._queueTick()}function l(e){this._normalQueue._pushOne(e),this._queueTick()}s.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},s.prototype.hasCustomScheduler=function(){return this._customScheduler},s.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},s.prototype.disableTrampolineIfNecessary=function(){a.hasDevTools&&(this._trampolineEnabled=!1)},s.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},s.prototype.fatalError=function(e,t){t?(r.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),r.exit(2)):this.throwLater(e)},s.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},a.hasDevTools?(s.prototype.invokeLater=function(e,t,r){this._trampolineEnabled?c.call(this,e,t,r):this._schedule(function(){setTimeout(function(){e.call(t,r)},100)})},s.prototype.invoke=function(e,t,r){this._trampolineEnabled?d.call(this,e,t,r):this._schedule(function(){e.call(t,r)})},s.prototype.settlePromises=function(e){this._trampolineEnabled?l.call(this,e):this._schedule(function(){e._settlePromises()})}):(s.prototype.invokeLater=c,s.prototype.invoke=d,s.prototype.settlePromises=l),s.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var r=e.shift(),n=e.shift();t.call(r,n)}else t._settlePromises()}},s.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},s.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},s.prototype._reset=function(){this._isTickUsed=!1},t.exports=s,t.exports.firstLineError=n}).call(this,e("qC859L"))},{"./queue":27,"./schedule":30,"./util":37,qC859L:43}],4:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){var i=!1,o=function(e,t){this._reject(t)},a=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},s=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},c=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=n.propagateFromFunction(),e.prototype._boundValue=n.boundValueFunction());var d=r(o),l=new e(t);l._propagateFrom(this,1);var u=this._target();if(l._setBoundTo(d),d instanceof e){var p={promiseRejectionQueued:!1,promise:l,target:u,bindingPromise:d};u._then(t,a,void 0,l,p),d._then(s,c,void 0,l,p),l._setOnCancel(d)}else l._resolveCallback(u);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,r){return e.resolve(r).bind(t)}}},{}],5:[function(e,t,r){"use strict";var n;"undefined"!=typeof Promise&&(n=Promise);var i=e("./promise")();i.noConflict=function(){try{Promise===i&&(Promise=n)}catch(e){}return i},t.exports=i},{"./promise":23}],6:[function(e,t,r){"use strict";var n=Object.create;if(n){var i=n(null),o=n(null);i[" size"]=o[" size"]=0}t.exports=function(t){var r,n,a=e("./util"),s=a.canEvaluate,c=a.isIdentifier,d=function(e){return new Function("ensureMethod","                                    \n        return function(obj) {                                               \n            'use strict'                                                     \n            var len = this.length;                                           \n            ensureMethod(obj, 'methodName');                                 \n            switch(len) {                                                    \n                case 1: return obj.methodName(this[0]);                      \n                case 2: return obj.methodName(this[0], this[1]);             \n                case 3: return obj.methodName(this[0], this[1], this[2]);    \n                case 0: return obj.methodName();                             \n                default:                                                     \n                    return obj.methodName.apply(obj, this);                  \n            }                                                                \n        };                                                                   \n        ".replace(/methodName/g,e))(p)},l=function(e){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",e))},u=function(e,t,r){var n=r[e];if("function"!=typeof n){if(!c(e))return null;if(n=t(e),r[e]=n,r[" size"]++,r[" size"]>512){for(var i=Object.keys(r),o=0;o<256;++o)delete r[i[o]];r[" size"]=i.length-256}}return n};function p(e,r){var n;if(null!=e&&(n=e[r]),"function"!=typeof n){var i="Object "+a.classString(e)+" has no method '"+a.toString(r)+"'";throw new t.TypeError(i)}return n}function f(e){return p(e,this.pop()).apply(e,this)}function h(e){return e[this]}function m(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}r=function(e){return u(e,d,i)},n=function(e){return u(e,l,o)},t.prototype.call=function(e){for(var t=arguments.length,n=new Array(Math.max(t-1,0)),i=1;i<t;++i)n[i-1]=arguments[i];if(s){var o=r(e);if(null!==o)return this._then(o,void 0,void 0,n,void 0)}return n.push(e),this._then(f,void 0,void 0,n,void 0)},t.prototype.get=function(e){var t;if("number"==typeof e)t=m;else if(s){var r=n(e);t=null!==r?r:h}else t=h;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":37}],7:[function(e,t,r){"use strict";t.exports=function(t,r,n,i){var o=e("./util"),a=o.tryCatch,s=o.errorObj,c=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var r=e._cancellationParent;if(null==r||!r._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=r}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),c.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var r=0;r<e.length;++r)this._doInvokeOnCancel(e[r],t);else if(void 0!==e)if("function"==typeof e){if(!t){var n=a(e).call(this._boundValue());n===s&&(this._attachExtraTrace(n.e),c.throwLater(n.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),c.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":37}],8:[function(e,t,r){"use strict";t.exports=function(t){var r=e("./util"),n=e("./es5").keys,i=r.tryCatch,o=r.errorObj;return function(e,a,s){return function(c){var d=s._boundValue();e:for(var l=0;l<e.length;++l){var u=e[l];if(u===Error||null!=u&&u.prototype instanceof Error){if(c instanceof u)return i(a).call(d,c)}else if("function"==typeof u){var p=i(u).call(d,c);if(p===o)return p;if(p)return i(a).call(d,c)}else if(r.isObject(c)){for(var f=n(u),h=0;h<f.length;++h){var m=f[h];if(u[m]!=c[m])continue e}return i(a).call(d,c)}}return t}}}},{"./es5":14,"./util":37}],9:[function(e,t,r){"use strict";t.exports=function(e){var t=!1,r=[];function n(){this._trace=new n.CapturedTrace(i())}function i(){var e=r.length-1;if(e>=0)return r[e]}return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},n.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,r.push(this._trace))},n.prototype._popContext=function(){if(void 0!==this._trace){var e=r.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},n.CapturedTrace=null,n.create=function(){if(t)return new n},n.deactivateLongStackTraces=function(){},n.activateLongStackTraces=function(){var r=e.prototype._pushContext,o=e.prototype._popContext,a=e._peekContext,s=e.prototype._peekContext,c=e.prototype._promiseCreated;n.deactivateLongStackTraces=function(){e.prototype._pushContext=r,e.prototype._popContext=o,e._peekContext=a,e.prototype._peekContext=s,e.prototype._promiseCreated=c,t=!1},t=!0,e.prototype._pushContext=n.prototype._pushContext,e.prototype._popContext=n.prototype._popContext,e._peekContext=e.prototype._peekContext=i,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},n}},{}],10:[function(e,t,r){(function(r){"use strict";t.exports=function(t,n){var i,o,a,s=t._getDomain,c=t._async,d=e("./errors").Warning,l=e("./util"),u=l.canAttachTrace,p=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,f=/\((?:timers\.js):\d+:\d+\)/,h=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,m=null,v=null,g=!1,y=!(0==l.env("BLUEBIRD_DEBUG")||!l.env("BLUEBIRD_DEBUG")&&"development"!==l.env("NODE_ENV")),b=!(0==l.env("BLUEBIRD_WARNINGS")||!y&&!l.env("BLUEBIRD_WARNINGS")),_=!(0==l.env("BLUEBIRD_LONG_STACK_TRACES")||!y&&!l.env("BLUEBIRD_LONG_STACK_TRACES")),w=0!=l.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(b||!!l.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),c.invokeLater(this._notifyUnhandledRejection,this,void 0))},t.prototype._notifyUnhandledRejectionIsHandled=function(){G("rejectionHandled",i,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),G("unhandledRejection",o,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(e,t,r){return N(e,t,r||this)},t.onPossiblyUnhandledRejection=function(e){var t=s();o="function"==typeof e?null===t?e:l.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=s();i="function"==typeof e?null===t?e:l.domainBind(t,e):void 0};var C=function(){};t.longStackTraces=function(){if(c.haveItemsQueued()&&!K.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!K.longStackTraces&&q()){var e=t.prototype._captureStackTrace,r=t.prototype._attachExtraTrace;K.longStackTraces=!0,C=function(){if(c.haveItemsQueued()&&!K.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=r,n.deactivateLongStackTraces(),c.enableTrampoline(),K.longStackTraces=!1},t.prototype._captureStackTrace=B,t.prototype._attachExtraTrace=F,n.activateLongStackTraces(),c.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return K.longStackTraces&&q()};var S=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return l.global.dispatchEvent(e),function(e,t){var r=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!l.global.dispatchEvent(r)}}if("function"==typeof Event){e=new Event("CustomEvent");return l.global.dispatchEvent(e),function(e,t){var r=new Event(e.toLowerCase(),{cancelable:!0});return r.detail=t,!l.global.dispatchEvent(r)}}return(e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),l.global.dispatchEvent(e),function(e,t){var r=document.createEvent("CustomEvent");return r.initCustomEvent(e.toLowerCase(),!1,!0,t),!l.global.dispatchEvent(r)}}catch(e){}return function(){return!1}}(),T=l.isNode?function(){return r.emit.apply(r,arguments)}:l.global?function(e){var t="on"+e.toLowerCase(),r=l.global[t];return!!r&&(r.apply(l.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function A(e,t){return{promise:t}}var k={promiseCreated:A,promiseFulfilled:A,promiseRejected:A,promiseResolved:A,promiseCancelled:A,promiseChained:function(e,t,r){return{promise:t,child:r}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,r){return{reason:t,promise:r}},rejectionHandled:A},R=function(e){var t=!1;try{t=T.apply(null,arguments)}catch(e){c.throwLater(e),t=!0}var r=!1;try{r=S(e,k[e].apply(null,arguments))}catch(e){c.throwLater(e),r=!0}return r||t};function E(){return!1}function P(e,t,r){var n=this;try{e(t,r,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+l.toString(e));n._attachCancellationCallback(e)})}catch(e){return e}}function I(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?l.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function x(){return this._onCancelField}function D(e){this._onCancelField=e}function j(){this._cancellationParent=void 0,this._onCancelField=void 0}function O(e,t){if(0!=(1&t)){this._cancellationParent=e;var r=e._branchesRemainingToCancel;void 0===r&&(r=0),e._branchesRemainingToCancel=r+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}t.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&C()),"warnings"in e){var r=e.warnings;K.warnings=!!r,w=K.warnings,l.isObject(r)&&"wForgottenReturn"in r&&(w=!!r.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!K.cancellation){if(c.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=j,t.prototype._propagateFrom=O,t.prototype._onCancel=x,t.prototype._setOnCancel=D,t.prototype._attachCancellationCallback=I,t.prototype._execute=P,M=O,K.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!K.monitoring?(K.monitoring=!0,t.prototype._fireEvent=R):!e.monitoring&&K.monitoring&&(K.monitoring=!1,t.prototype._fireEvent=E)),t},t.prototype._fireEvent=E,t.prototype._execute=function(e,t,r){try{e(t,r)}catch(e){return e}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(e){},t.prototype._attachCancellationCallback=function(e){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(e,t){};var M=function(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)};function L(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function B(){this._trace=new Q(this._peekContext())}function F(e,t){if(u(e)){var r=this._trace;if(void 0!==r&&t&&(r=r._parent),void 0!==r)r.attachExtraTrace(e);else if(!e.__stackCleaned__){var n=U(e);l.notEnumerableProp(e,"stack",n.message+"\n"+n.stack.join("\n")),l.notEnumerableProp(e,"__stackCleaned__",!0)}}}function N(e,r,n){if(K.warnings){var i,o=new d(e);if(r)n._attachExtraTrace(o);else if(K.longStackTraces&&(i=t._peekContext()))i.attachExtraTrace(o);else{var a=U(o);o.stack=a.message+"\n"+a.stack.join("\n")}R("warning",o)||H(o,"",!0)}}function V(e){for(var t=[],r=0;r<e.length;++r){var n=e[r],i="    (No stack trace)"===n||m.test(n),o=i&&J(n);i&&!o&&(g&&" "!==n.charAt(0)&&(n="    "+n),t.push(n))}return t}function U(e){var t=e.stack,r=e.toString();return t="string"==typeof t&&t.length>0?function(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),r=0;r<t.length;++r){var n=t[r];if("    (No stack trace)"===n||m.test(n))break}return r>0&&"SyntaxError"!=e.name&&(t=t.slice(r)),t}(e):["    (No stack trace)"],{message:r,stack:"SyntaxError"==e.name?t:V(t)}}function H(e,t,r){if("undefined"!=typeof console){var n;if(l.isObject(e)){var i=e.stack;n=t+v(i,e)}else n=t+String(e);"function"==typeof a?a(n,r):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(n)}}function G(e,t,r,n){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(n):t(r,n))}catch(e){c.throwLater(e)}"unhandledRejection"===e?R(e,r,n)||i||H(r,"Unhandled rejection "):R(e,n)}function W(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e&&"function"==typeof e.toString?e.toString():l.toString(e);if(/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+function(e){if(e.length<41)return e;return e.substr(0,38)+"..."}(t)+">, no stack trace)"}function q(){return"function"==typeof X}var J=function(){return!1},z=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function $(e){var t=e.match(z);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function Q(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);X(this,Q),t>32&&this.uncycle()}l.inherits(Q,Error),n.CapturedTrace=Q,Q.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],r={},n=0,i=this;void 0!==i;++n)t.push(i),i=i._parent;for(n=(e=this._length=n)-1;n>=0;--n){var o=t[n].stack;void 0===r[o]&&(r[o]=n)}for(n=0;n<e;++n){var a=r[t[n].stack];if(void 0!==a&&a!==n){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[n]._parent=void 0,t[n]._length=1;var s=n>0?t[n-1]:this;a<e-1?(s._parent=t[a+1],s._parent.uncycle(),s._length=s._parent._length+1):(s._parent=void 0,s._length=1);for(var c=s._length+1,d=n-2;d>=0;--d)t[d]._length=c,c++;return}}}},Q.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=U(e),r=t.message,n=[t.stack],i=this;void 0!==i;)n.push(V(i.stack.split("\n"))),i=i._parent;!function(e){for(var t=e[0],r=1;r<e.length;++r){for(var n=e[r],i=t.length-1,o=t[i],a=-1,s=n.length-1;s>=0;--s)if(n[s]===o){a=s;break}for(s=a;s>=0;--s){var c=n[s];if(t[i]!==c)break;t.pop(),i--}t=n}}(n),function(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}(n),l.notEnumerableProp(e,"stack",function(e,t){for(var r=0;r<t.length-1;++r)t[r].push("From previous event:"),t[r]=t[r].join("\n");return r<t.length&&(t[r]=t[r].join("\n")),e+"\n"+t.join("\n")}(r,n)),l.notEnumerableProp(e,"__stackCleaned__",!0)}};var X=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():W(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,m=e,v=t;var r=Error.captureStackTrace;return J=function(e){return p.test(e)},function(e,t){Error.stackTraceLimit+=6,r(e,t),Error.stackTraceLimit-=6}}var n,i=new Error;if("string"==typeof i.stack&&i.stack.split("\n")[0].indexOf("stackDetection@")>=0)return m=/@/,v=t,g=!0,function(e){e.stack=(new Error).stack};try{throw new Error}catch(e){n="stack"in e}return"stack"in i||!n||"number"!=typeof Error.stackTraceLimit?(v=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?W(t):t.toString()},null):(m=e,v=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(a=function(e){console.warn(e)},l.isNode&&r.stderr.isTTY?a=function(e,t){var r=t?"[33m":"[31m";console.warn(r+e+"[0m\n")}:l.isNode||"string"!=typeof(new Error).stack||(a=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var K={warnings:b,longStackTraces:!1,cancellation:!1,monitoring:!1};return _&&t.longStackTraces(),{longStackTraces:function(){return K.longStackTraces},warnings:function(){return K.warnings},cancellation:function(){return K.cancellation},monitoring:function(){return K.monitoring},propagateFromFunction:function(){return M},boundValueFunction:function(){return L},checkForgottenReturns:function(e,t,r,n,i){if(void 0===e&&null!==t&&w){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&n._bitField))return;r&&(r+=" ");var o="",a="";if(t._trace){for(var s=t._trace.stack.split("\n"),c=V(s),d=c.length-1;d>=0;--d){var l=c[d];if(!f.test(l)){var u=l.match(h);u&&(o="at "+u[1]+":"+u[2]+":"+u[3]+" ");break}}if(c.length>0){var p=c[0];for(d=0;d<s.length;++d)if(s[d]===p){d>0&&(a="\n"+s[d-1]);break}}}var m="a promise was created in a "+r+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+a;n._warn(m,!0,t)}},setBounds:function(e,t){if(q()){for(var r,n,i=e.stack.split("\n"),o=t.stack.split("\n"),a=-1,s=-1,c=0;c<i.length;++c)if(d=$(i[c])){r=d.fileName,a=d.line;break}for(c=0;c<o.length;++c){var d;if(d=$(o[c])){n=d.fileName,s=d.line;break}}a<0||s<0||!r||!n||r!==n||a>=s||(J=function(e){if(p.test(e))return!0;var t=$(e);return!!(t&&t.fileName===r&&a<=t.line&&t.line<=s)})}},warn:N,deprecated:function(e,t){var r=e+" is deprecated and will be removed in a future version.";return t&&(r+=" Use "+t+" instead."),N(r)},CapturedTrace:Q,fireDomEvent:S,fireGlobalEvent:T}}}).call(this,e("qC859L"))},{"./errors":13,"./util":37,qC859L:43}],11:[function(e,t,r){"use strict";t.exports=function(e){function t(){return this.value}function r(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(r){return r instanceof e&&r.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:r},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(r,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,r,void 0,{reason:e},void 0);var t=arguments[1];return this.caught(e,function(){throw t})},e.prototype.catchReturn=function(r){if(arguments.length<=1)return r instanceof e&&r.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:r},void 0);var n=arguments[1];n instanceof e&&n.suppressUnhandledRejections();return this.caught(r,function(){return n})}}},{}],12:[function(e,t,r){"use strict";t.exports=function(e,t){var r=e.reduce,n=e.all;function i(){return n(this)}e.prototype.each=function(e){return r(this,e,t,0)._then(i,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return r(this,e,t,t)},e.each=function(e,n){return r(e,n,t,0)._then(i,void 0,void 0,e,void 0)},e.mapSeries=function(e,n){return r(e,n,t,t)}}},{}],13:[function(e,t,r){"use strict";var n,i,o=e("./es5"),a=o.freeze,s=e("./util"),c=s.inherits,d=s.notEnumerableProp;function l(e,t){function r(n){if(!(this instanceof r))return new r(n);d(this,"message","string"==typeof n?n:t),d(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return c(r,Error),r}var u=l("Warning","warning"),p=l("CancellationError","cancellation error"),f=l("TimeoutError","timeout error"),h=l("AggregateError","aggregate error");try{n=TypeError,i=RangeError}catch(e){n=l("TypeError","type error"),i=l("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),v=0;v<m.length;++v)"function"==typeof Array.prototype[m[v]]&&(h.prototype[m[v]]=Array.prototype[m[v]]);o.defineProperty(h.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),h.prototype.isOperational=!0;var g=0;function y(e){if(!(this instanceof y))return new y(e);d(this,"name","OperationalError"),d(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(d(this,"message",e.message),d(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}h.prototype.toString=function(){var e=Array(4*g+1).join(" "),t="\n"+e+"AggregateError of:\n";g++,e=Array(4*g+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",i=n.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];t+=(n=i.join("\n"))+"\n"}return g--,t},c(y,Error);var b=Error.__BluebirdErrorTypes__;b||(b=a({CancellationError:p,TimeoutError:f,OperationalError:y,RejectionError:y,AggregateError:h}),o.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:n,RangeError:i,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:u}},{"./es5":14,"./util":37}],14:[function(e,t,r){var n=function(){"use strict";return void 0===this}();if(n)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!(r&&!r.writable&&!r.set)}};else{var i={}.hasOwnProperty,o={}.toString,a={}.constructor.prototype,s=function(e){var t=[];for(var r in e)i.call(e,r)&&t.push(r);return t};t.exports={isArray:function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}},keys:s,names:s,defineProperty:function(e,t,r){return e[t]=r.value,e},getDescriptor:function(e,t){return{value:e[t]}},freeze:function(e){return e},getPrototypeOf:function(e){try{return Object(e).constructor.prototype}catch(e){return a}},isES5:n,propertyIsWritable:function(){return!0}}}},{}],15:[function(e,t,r){"use strict";t.exports=function(e,t){var r=e.map;e.prototype.filter=function(e,n){return r(this,e,n,t)},e.filter=function(e,n,i){return r(e,n,i,t)}}},{}],16:[function(e,t,r){"use strict";t.exports=function(t,r){var n=e("./util"),i=t.CancellationError,o=n.errorObj;function a(e,t,r){this.promise=e,this.type=t,this.handler=r,this.called=!1,this.cancelPromise=null}function s(e){this.finallyHandler=e}function c(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function d(){return u.call(this,this.promise._target()._settledValue())}function l(e){if(!c(this,e))return o.e=e,o}function u(e){var n=this.promise,a=this.handler;if(!this.called){this.called=!0;var u=this.isFinallyHandler()?a.call(n._boundValue()):a.call(n._boundValue(),e);if(void 0!==u){n._setReturnedNonUndefined();var p=r(u,n);if(p instanceof t){if(null!=this.cancelPromise){if(p._isCancelled()){var f=new i("late cancellation observer");return n._attachExtraTrace(f),o.e=f,o}p.isPending()&&p._attachCancellationCallback(new s(this))}return p._then(d,l,void 0,this,void 0)}}}return n.isRejected()?(c(this),o.e=e,o):(c(this),e)}return a.prototype.isFinallyHandler=function(){return 0===this.type},s.prototype._resultCancelled=function(){c(this.finallyHandler)},t.prototype._passThrough=function(e,t,r,n){return"function"!=typeof e?this.then():this._then(r,n,void 0,new a(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,u,u)},t.prototype.tap=function(e){return this._passThrough(e,1,u)},a}},{"./util":37}],17:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,a){var s=e("./errors").TypeError,c=e("./util"),d=c.errorObj,l=c.tryCatch,u=[];function p(e,r,i,o){if(a.cancellation()){var s=new t(n),c=this._finallyPromise=new t(n);this._promise=s.lastly(function(){return c}),s._captureStackTrace(),s._setOnCancel(this)}else{(this._promise=new t(n))._captureStackTrace()}this._stack=o,this._generatorFunction=e,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(u):u,this._yieldedPromise=null,this._cancellationPhase=!1}c.inherits(p,o),p.prototype._isResolved=function(){return null===this._promise},p.prototype._cleanup=function(){this._promise=this._generator=null,a.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},p.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=l(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var r=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),e=l(this._generator.throw).call(this._generator,r),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},p.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=l(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},p.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=l(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},p.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},p.prototype.promise=function(){return this._promise},p.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},p.prototype._continue=function(e){var r=this._promise;if(e===d)return this._cleanup(),this._cancellationPhase?r.cancel():r._rejectCallback(e.e,!1);var n=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?r.cancel():r._resolveCallback(n);var o=i(n,this._promise);if(o instanceof t||null!==(o=function(e,r,n){for(var o=0;o<r.length;++o){n._pushContext();var a=l(r[o])(e);if(n._popContext(),a===d){n._pushContext();var s=t.reject(d.e);return n._popContext(),s}var c=i(a,n);if(c instanceof t)return c}return null}(o,this._yieldHandlers,this._promise))){var a=(o=o._target())._bitField;0==(50397184&a)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&a)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&a)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()}else this._promiseRejected(new s("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",n)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},t.coroutine=function(e,t){if("function"!=typeof e)throw new s("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=Object(t).yieldHandler,n=p,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new n(void 0,void 0,r,i),a=o.promise();return o._generator=t,o._promiseFulfilled(void 0),a}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new s("expecting a function but got "+c.classString(e));u.push(e)},t.spawn=function(e){if(a.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return r("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new p(e,this),i=n.promise();return n._run(t.spawn),i}}},{"./errors":13,"./util":37}],18:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,a){var s,c=e("./util"),d=c.canEvaluate,l=c.tryCatch,u=c.errorObj;if(d){for(var p=function(e){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))},f=function(e){return new Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,e))},h=function(e){for(var r=new Array(e),n=0;n<r.length;++n)r[n]="this.p"+(n+1);var i=r.join(" = ")+" = null;",a="var promise;\n"+r.map(function(e){return"                                                         \n                promise = "+e+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "}).join("\n"),s=r.join(", "),c="Holder$"+e,d="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ";return d=d.replace(/\[TheName\]/g,c).replace(/\[TheTotal\]/g,e).replace(/\[ThePassedArguments\]/g,s).replace(/\[TheProperties\]/g,i).replace(/\[CancellationCode\]/g,a),new Function("tryCatch","errorObj","Promise","async",d)(l,u,t,o)},m=[],v=[],g=[],y=0;y<8;++y)m.push(h(y+1)),v.push(p(y+1)),g.push(f(y+1));s=function(e){this._reject(e)}}t.join=function(){var e,o=arguments.length-1;if(o>0&&"function"==typeof arguments[o]&&(e=arguments[o],o<=8&&d)){(C=new t(i))._captureStackTrace();for(var l=new(0,m[o-1])(e),u=v,p=0;p<o;++p){var f=n(arguments[p],C);if(f instanceof t){var h=(f=f._target())._bitField;0==(50397184&h)?(f._then(u[p],s,void 0,C,l),g[p](f,l),l.asyncNeeded=!1):0!=(33554432&h)?u[p].call(C,f._value(),l):0!=(16777216&h)?C._reject(f._reason()):C._cancel()}else u[p].call(C,f,l)}if(!C._isFateSealed()){if(l.asyncNeeded){var y=a();null!==y&&(l.fn=c.domainBind(y,l.fn))}C._setAsyncGuaranteed(),C._setOnCancel(l)}return C}for(var b=arguments.length,_=new Array(b),w=0;w<b;++w)_[w]=arguments[w];e&&_.pop();var C=new r(_).promise();return void 0!==e?C.spread(e):C}}},{"./util":37}],19:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,a){var s=t._getDomain,c=e("./util"),d=c.tryCatch,l=c.errorObj,u=t._async;function p(e,t,r,n){this.constructor$(e),this._promise._captureStackTrace();var i=s();this._callback=null===i?t:c.domainBind(i,t),this._preservedValues=n===o?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=[],u.invoke(this._asyncInit,this,void 0)}function f(e,r,i,o){if("function"!=typeof r)return n("expecting a function but got "+c.classString(r));var a=0;if(void 0!==i){if("object"!=typeof i||null===i)return t.reject(new TypeError("options argument must be an object but it is "+c.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+c.classString(i.concurrency)));a=i.concurrency}return new p(e,r,a="number"==typeof a&&isFinite(a)&&a>=1?a:0,o).promise()}c.inherits(p,r),p.prototype._asyncInit=function(){this._init$(void 0,-2)},p.prototype._init=function(){},p.prototype._promiseFulfilled=function(e,r){var n=this._values,o=this.length(),s=this._preservedValues,c=this._limit;if(r<0){if(n[r=-1*r-1]=e,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(c>=1&&this._inFlight>=c)return n[r]=e,this._queue.push(r),!1;null!==s&&(s[r]=e);var u=this._promise,p=this._callback,f=u._boundValue();u._pushContext();var h=d(p).call(f,e,r,o),m=u._popContext();if(a.checkForgottenReturns(h,m,null!==s?"Promise.filter":"Promise.map",u),h===l)return this._reject(h.e),!0;var v=i(h,this._promise);if(v instanceof t){var g=(v=v._target())._bitField;if(0==(50397184&g))return c>=1&&this._inFlight++,n[r]=v,v._proxy(this,-1*(r+1)),!1;if(0==(33554432&g))return 0!=(16777216&g)?(this._reject(v._reason()),!0):(this._cancel(),!0);h=v._value()}n[r]=h}return++this._totalResolved>=o&&(null!==s?this._filter(n,s):this._resolve(n),!0)},p.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,r=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var n=e.pop();this._promiseFulfilled(r[n],n)}},p.prototype._filter=function(e,t){for(var r=t.length,n=new Array(r),i=0,o=0;o<r;++o)e[o]&&(n[i++]=t[o]);n.length=i,this._resolve(n)},p.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return f(this,e,t,null)},t.map=function(e,t,r,n){return f(e,t,r,n)}}},{"./util":37}],20:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o){var a=e("./util"),s=a.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+a.classString(e));return function(){var n=new t(r);n._captureStackTrace(),n._pushContext();var i=s(e).apply(this,arguments),a=n._popContext();return o.checkForgottenReturns(i,a,"Promise.method",n),n._resolveFromSyncValue(i),n}},t.attempt=t.try=function(e){if("function"!=typeof e)return i("expecting a function but got "+a.classString(e));var n,c=new t(r);if(c._captureStackTrace(),c._pushContext(),arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var d=arguments[1],l=arguments[2];n=a.isArray(d)?s(e).apply(l,d):s(e).call(l,d)}else n=s(e)();var u=c._popContext();return o.checkForgottenReturns(n,u,"Promise.try",c),c._resolveFromSyncValue(n),c},t.prototype._resolveFromSyncValue=function(e){e===a.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":37}],21:[function(e,t,r){"use strict";var n=e("./util"),i=n.maybeWrapAsError,o=e("./errors").OperationalError,a=e("./es5");var s=/^(?:name|message|stack|cause)$/;function c(e){var t;if(function(e){return e instanceof Error&&a.getPrototypeOf(e)===Error.prototype}(e)){(t=new o(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var r=a.keys(e),i=0;i<r.length;++i){var c=r[i];s.test(c)||(t[c]=e[c])}return t}return n.markAsOriginatingFromRejection(e),e}t.exports=function(e,t){return function(r,n){if(null!==e){if(r){var o=c(i(r));e._attachExtraTrace(o),e._reject(o)}else if(t){for(var a=arguments.length,s=new Array(Math.max(a-1,0)),d=1;d<a;++d)s[d-1]=arguments[d];e._fulfill(s)}else e._fulfill(n);e=null}}}},{"./errors":13,"./es5":14,"./util":37}],22:[function(e,t,r){"use strict";t.exports=function(t){var r=e("./util"),n=t._async,i=r.tryCatch,o=r.errorObj;function a(e,t){if(!r.isArray(e))return s.call(this,e,t);var a=i(t).apply(this._boundValue(),[null].concat(e));a===o&&n.throwLater(a.e)}function s(e,t){var r=this._boundValue(),a=void 0===e?i(t).call(r,null):i(t).call(r,null,e);a===o&&n.throwLater(a.e)}function c(e,t){if(!e){var r=new Error(e+"");r.cause=e,e=r}var a=i(t).call(this._boundValue(),e);a===o&&n.throwLater(a.e)}t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var r=s;void 0!==t&&Object(t).spread&&(r=a),this._then(r,c,void 0,this,e)}return this}}},{"./util":37}],23:[function(e,t,r){(function(r){"use strict";t.exports=function(){var n=function(){return new h("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},i=function(){return new P.PromiseInspection(this._target())},o=function(e){return P.reject(new h(e))};function a(){}var s,c={},d=e("./util");s=d.isNode?function(){var e=r.domain;return void 0===e&&(e=null),e}:function(){return null},d.notEnumerableProp(P,"_getDomain",s);var l=e("./es5"),u=e("./async"),p=new u;l.defineProperty(P,"_async",{value:p});var f=e("./errors"),h=P.TypeError=f.TypeError;P.RangeError=f.RangeError;var m=P.CancellationError=f.CancellationError;P.TimeoutError=f.TimeoutError,P.OperationalError=f.OperationalError,P.RejectionError=f.OperationalError,P.AggregateError=f.AggregateError;var v=function(){},g={},y={},b=e("./thenables")(P,v),_=e("./promise_array")(P,v,b,o,a),w=e("./context")(P),C=w.create,S=e("./debuggability")(P,w),T=(S.CapturedTrace,e("./finally")(P,b)),A=e("./catch_filter")(y),k=e("./nodeback"),R=d.errorObj,E=d.tryCatch;function P(e){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,e!==v&&(!function(e,t){if("function"!=typeof t)throw new h("expecting a function but got "+d.classString(t));if(e.constructor!==P)throw new h("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}(this,e),this._resolveFromExecutor(e)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function I(e){this.promise._resolveCallback(e)}function x(e){this.promise._rejectCallback(e,!1)}function D(e){var t=new P(v);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}return P.prototype.toString=function(){return"[object Promise]"},P.prototype.caught=P.prototype.catch=function(e){var t=arguments.length;if(t>1){var r,n=new Array(t-1),i=0;for(r=0;r<t-1;++r){var a=arguments[r];if(!d.isObject(a))return o("expecting an object but got A catch statement predicate "+d.classString(a));n[i++]=a}return n.length=i,e=arguments[r],this.then(void 0,A(n,e,this))}return this.then(void 0,e)},P.prototype.reflect=function(){return this._then(i,i,void 0,this,void 0)},P.prototype.then=function(e,t){if(S.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var r=".then() only accepts functions but was passed: "+d.classString(e);arguments.length>1&&(r+=", "+d.classString(t)),this._warn(r)}return this._then(e,t,void 0,void 0,void 0)},P.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},P.prototype.spread=function(e){return"function"!=typeof e?o("expecting a function but got "+d.classString(e)):this.all()._then(e,void 0,void 0,g,void 0)},P.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},P.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new _(this).promise()},P.prototype.error=function(e){return this.caught(d.originatesFromRejection,e)},P.getNewLibraryCopy=t.exports,P.is=function(e){return e instanceof P},P.fromNode=P.fromCallback=function(e){var t=new P(v);t._captureStackTrace();var r=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=E(e)(k(t,r));return n===R&&t._rejectCallback(n.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},P.all=function(e){return new _(e).promise()},P.cast=function(e){var t=b(e);return t instanceof P||((t=new P(v))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},P.resolve=P.fulfilled=P.cast,P.reject=P.rejected=function(e){var t=new P(v);return t._captureStackTrace(),t._rejectCallback(e,!0),t},P.setScheduler=function(e){if("function"!=typeof e)throw new h("expecting a function but got "+d.classString(e));return p.setScheduler(e)},P.prototype._then=function(e,t,r,n,i){var o=void 0!==i,a=o?i:new P(v),c=this._target(),l=c._bitField;o||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===n&&0!=(2097152&this._bitField)&&(n=0!=(50397184&l)?this._boundValue():c===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var u=s();if(0!=(50397184&l)){var f,h,g=c._settlePromiseCtx;0!=(33554432&l)?(h=c._rejectionHandler0,f=e):0!=(16777216&l)?(h=c._fulfillmentHandler0,f=t,c._unsetRejectionIsUnhandled()):(g=c._settlePromiseLateCancellationObserver,h=new m("late cancellation observer"),c._attachExtraTrace(h),f=t),p.invoke(g,c,{handler:null===u?f:"function"==typeof f&&d.domainBind(u,f),promise:a,receiver:n,value:h})}else c._addCallbacks(e,t,a,n,u);return a},P.prototype._length=function(){return 65535&this._bitField},P.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},P.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},P.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},P.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},P.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},P.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},P.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},P.prototype._isFinal=function(){return(4194304&this._bitField)>0},P.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},P.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},P.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},P.prototype._setAsyncGuaranteed=function(){p.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},P.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==c)return void 0===t&&this._isBound()?this._boundValue():t},P.prototype._promiseAt=function(e){return this[4*e-4+2]},P.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},P.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},P.prototype._boundValue=function(){},P.prototype._migrateCallback0=function(e){e._bitField;var t=e._fulfillmentHandler0,r=e._rejectionHandler0,n=e._promise0,i=e._receiverAt(0);void 0===i&&(i=c),this._addCallbacks(t,r,n,i,null)},P.prototype._migrateCallbackAt=function(e,t){var r=e._fulfillmentHandlerAt(t),n=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=c),this._addCallbacks(r,n,i,o,null)},P.prototype._addCallbacks=function(e,t,r,n,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=r,this._receiver0=n,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:d.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:d.domainBind(i,t));else{var a=4*o-4;this[a+2]=r,this[a+3]=n,"function"==typeof e&&(this[a+0]=null===i?e:d.domainBind(i,e)),"function"==typeof t&&(this[a+1]=null===i?t:d.domainBind(i,t))}return this._setLength(o+1),o},P.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},P.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(n(),!1);var r=b(e,this);if(!(r instanceof P))return this._fulfill(e);t&&this._propagateFrom(r,2);var i=r._target();if(i!==this){var o=i._bitField;if(0==(50397184&o)){var a=this._length();a>0&&i._migrateCallback0(this);for(var s=1;s<a;++s)i._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(i)}else if(0!=(33554432&o))this._fulfill(i._value());else if(0!=(16777216&o))this._reject(i._reason());else{var c=new m("late cancellation observer");i._attachExtraTrace(c),this._reject(c)}}else this._reject(n())}},P.prototype._rejectCallback=function(e,t,r){var n=d.ensureErrorObject(e),i=n===e;if(!i&&!r&&S.warnings()){var o="a promise was rejected with a non-error: "+d.classString(e);this._warn(o,!0)}this._attachExtraTrace(n,!!t&&i),this._reject(e)},P.prototype._resolveFromExecutor=function(e){var t=this;this._captureStackTrace(),this._pushContext();var r=!0,n=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,r)});r=!1,this._popContext(),void 0!==n&&t._rejectCallback(n,!0)},P.prototype._settlePromiseFromHandler=function(e,t,r,n){var i=n._bitField;if(0==(65536&i)){var o;n._pushContext(),t===g?r&&"number"==typeof r.length?o=E(e).apply(this._boundValue(),r):(o=R).e=new h("cannot .spread() a non-array: "+d.classString(r)):o=E(e).call(t,r);var a=n._popContext();0==(65536&(i=n._bitField))&&(o===y?n._reject(r):o===R?n._rejectCallback(o.e,!1):(S.checkForgottenReturns(o,a,"",n,this),n._resolveCallback(o)))}},P.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},P.prototype._followee=function(){return this._rejectionHandler0},P.prototype._setFollowee=function(e){this._rejectionHandler0=e},P.prototype._settlePromise=function(e,t,r,n){var o=e instanceof P,s=this._bitField,c=0!=(134217728&s);0!=(65536&s)?(o&&e._invokeInternalOnCancel(),r instanceof T&&r.isFinallyHandler()?(r.cancelPromise=e,E(t).call(r,n)===R&&e._reject(R.e)):t===i?e._fulfill(i.call(r)):r instanceof a?r._promiseCancelled(e):o||e instanceof _?e._cancel():r.cancel()):"function"==typeof t?o?(c&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,r,n,e)):t.call(r,n,e):r instanceof a?r._isResolved()||(0!=(33554432&s)?r._promiseFulfilled(n,e):r._promiseRejected(n,e)):o&&(c&&e._setAsyncGuaranteed(),0!=(33554432&s)?e._fulfill(n):e._reject(n))},P.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,r=e.promise,n=e.receiver,i=e.value;"function"==typeof t?r instanceof P?this._settlePromiseFromHandler(t,n,i,r):t.call(n,i,r):r instanceof P&&r._reject(i)},P.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},P.prototype._settlePromise0=function(e,t,r){var n=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,e,i,t)},P.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},P.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var r=n();return this._attachExtraTrace(r),this._reject(r)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():p.settlePromises(this))}},P.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return p.fatalError(e,d.isNode);(65535&t)>0?p.settlePromises(this):this._ensurePossibleRejectionHandled()}},P.prototype._fulfillPromises=function(e,t){for(var r=1;r<e;r++){var n=this._fulfillmentHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,t)}},P.prototype._rejectPromises=function(e,t){for(var r=1;r<e;r++){var n=this._rejectionHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,t)}},P.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var r=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,r,e),this._rejectPromises(t,r)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,e),this._fulfillPromises(t,n)}this._setLength(0)}this._clearCancellationData()},P.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},P.defer=P.pending=function(){return S.deprecated("Promise.defer","new Promise"),{promise:new P(v),resolve:I,reject:x}},d.notEnumerableProp(P,"_makeSelfResolutionError",n),e("./method")(P,v,b,o,S),e("./bind")(P,v,b,S),e("./cancel")(P,_,o,S),e("./direct_resolve")(P),e("./synchronous_inspection")(P),e("./join")(P,_,b,v,p,s),P.Promise=P,P.version="3.4.7",e("./map.js")(P,_,o,b,v,S),e("./call_get.js")(P),e("./using.js")(P,o,b,C,v,S),e("./timers.js")(P,v,S),e("./generators.js")(P,o,v,b,a,S),e("./nodeify.js")(P),e("./promisify.js")(P,v),e("./props.js")(P,_,b,o),e("./race.js")(P,v,b,o),e("./reduce.js")(P,_,o,b,v,S),e("./settle.js")(P,_,S),e("./some.js")(P,_,o),e("./filter.js")(P,v),e("./each.js")(P,v),e("./any.js")(P),d.toFastProperties(P),d.toFastProperties(P.prototype),D({a:1}),D({b:2}),D({c:3}),D(1),D(function(){}),D(void 0),D(!1),D(new P(v)),S.setBounds(u.firstLineError,d.lastLineError),P}}).call(this,e("qC859L"))},{"./any.js":2,"./async":3,"./bind":4,"./call_get.js":6,"./cancel":7,"./catch_filter":8,"./context":9,"./debuggability":10,"./direct_resolve":11,"./each.js":12,"./errors":13,"./es5":14,"./filter.js":15,"./finally":16,"./generators.js":17,"./join":18,"./map.js":19,"./method":20,"./nodeback":21,"./nodeify.js":22,"./promise_array":24,"./promisify.js":25,"./props.js":26,"./race.js":28,"./reduce.js":29,"./settle.js":31,"./some.js":32,"./synchronous_inspection":33,"./thenables":34,"./timers.js":35,"./using.js":36,"./util":37,qC859L:43}],24:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o){var a=e("./util");a.isArray;function s(e){var n=this._promise=new t(r);e instanceof t&&n._propagateFrom(e,3),n._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return a.inherits(s,o),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function e(r,o){var s=n(this._values,this._promise);if(s instanceof t){var c=(s=s._target())._bitField;if(this._values=s,0==(50397184&c))return this._promise._setAsyncGuaranteed(),s._then(e,this._reject,void 0,this,o);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(s._reason()):this._cancel();s=s._value()}if(null!==(s=a.asArray(s)))0!==s.length?this._iterate(s):-5===o?this._resolveEmptyArray():this._resolve(function(e){switch(e){case-2:return[];case-3:return{}}}(o));else{var d=i("expecting an array or an iterable object but got "+a.classString(s)).reason();this._promise._rejectCallback(d,!1)}},s.prototype._iterate=function(e){var r=this.getActualLength(e.length);this._length=r,this._values=this.shouldCopyValues()?new Array(r):this._values;for(var i=this._promise,o=!1,a=null,s=0;s<r;++s){var c=n(e[s],i);a=c instanceof t?(c=c._target())._bitField:null,o?null!==a&&c.suppressUnhandledRejections():null!==a?0==(50397184&a)?(c._proxy(this,s),this._values[s]=c):o=0!=(33554432&a)?this._promiseFulfilled(c._value(),s):0!=(16777216&a)?this._promiseRejected(c._reason(),s):this._promiseCancelled(s):o=this._promiseFulfilled(c,s)}o||i._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},s.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},s.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var r=0;r<e.length;++r)e[r]instanceof t&&e[r].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(e){return e},s}},{"./util":37}],25:[function(e,t,r){"use strict";t.exports=function(t,r){var n={},i=e("./util"),o=e("./nodeback"),a=i.withAppended,s=i.maybeWrapAsError,c=i.canEvaluate,d=e("./errors").TypeError,l={__isPromisified__:!0},u=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),p=function(e){return i.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e};function f(e){return!u.test(e)}function h(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function m(e,t,r){var n=i.getDataPropertyOrDefault(e,t+r,l);return!!n&&h(n)}function v(e,t,r,n){for(var o=i.inheritedDataKeys(e),a=[],s=0;s<o.length;++s){var c=o[s],l=e[c],u=n===p||p(c,l,e);"function"!=typeof l||h(l)||m(e,c,t)||!n(c,l,e,u)||a.push(c,l)}return function(e,t,r){for(var n=0;n<e.length;n+=2){var i=e[n];if(r.test(i))for(var o=i.replace(r,""),a=0;a<e.length;a+=2)if(e[a]===o)throw new d("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}(a,t,r),a}var g=function(e){return e.replace(/([$])/,"\\$")},y=function(e){return i.filledRange(e,"_arg","")};var b=c?function(e,c,d,l,u,p){var f=Math.max(0,function(e){return"number"==typeof e.length?Math.max(Math.min(e.length,1024),0):0}(l)-1),h=function(e){for(var t=[e],r=Math.max(0,e-1-3),n=e-1;n>=r;--n)t.push(n);for(n=e+1;n<=3;++n)t.push(n);return t}(f),m="string"==typeof e||c===n;var v="string"==typeof e?"this != null ? this['"+e+"'] : fn":"fn",g="'use strict';                                                \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise, "+p+");   \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n            return promise;                                                  \n        };                                                                   \n        notEnumerableProp(ret, '__isPromisified__', true);                   \n        return ret;                                                          \n    ".replace("[CodeForSwitchCase]",function(){for(var e,t,r,n="",i=0;i<h.length;++i)n+="case "+h[i]+":"+(e=h[i],t=y(e).join(", "),r=e>0?", ":"",(m?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===c?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n").replace("{{args}}",t).replace(", ",r));return n+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",m?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}()).replace("[GetFunctionCode]",v);return g=g.replace("Parameters",function(e){return i.filledRange(Math.max(e,3),"_arg","")}(f)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",g)(t,l,c,a,s,o,i.tryCatch,i.errorObj,i.notEnumerableProp,r)}:function(e,c,d,l,u,p){var f=function(){return this}(),h=e;function m(){var i=c;c===n&&(i=this);var d=new t(r);d._captureStackTrace();var l="string"==typeof h&&this!==f?this[h]:e,u=o(d,p);try{l.apply(i,a(arguments,u))}catch(e){d._rejectCallback(s(e),!0,!0)}return d._isFateSealed()||d._setAsyncGuaranteed(),d}return"string"==typeof h&&(e=l),i.notEnumerableProp(m,"__isPromisified__",!0),m};function _(e,t,r,o,a){for(var s=new RegExp(g(t)+"$"),c=v(e,t,s,r),d=0,l=c.length;d<l;d+=2){var u=c[d],p=c[d+1],f=u+t;if(o===b)e[f]=b(u,n,u,p,t,a);else{var h=o(p,function(){return b(u,n,u,p,t,a)});i.notEnumerableProp(h,"__isPromisified__",!0),e[f]=h}}return i.toFastProperties(e),e}t.promisify=function(e,t){if("function"!=typeof e)throw new d("expecting a function but got "+i.classString(e));if(h(e))return e;var r=function(e,t,r){return b(e,t,void 0,e,null,r)}(e,void 0===(t=Object(t)).context?n:t.context,!!t.multiArgs);return i.copyDescriptors(e,r,f),r},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new d("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var r=!!(t=Object(t)).multiArgs,n=t.suffix;"string"!=typeof n&&(n="Async");var o=t.filter;"function"!=typeof o&&(o=p);var a=t.promisifier;if("function"!=typeof a&&(a=b),!i.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=i.inheritedDataKeys(e),c=0;c<s.length;++c){var l=e[s[c]];"constructor"!==s[c]&&i.isClass(l)&&(_(l.prototype,n,o,a,r),_(l,n,o,a,r))}return _(e,n,o,a,r)}}},{"./errors":13,"./nodeback":21,"./util":37}],26:[function(e,t,r){"use strict";t.exports=function(t,r,n,i){var o,a=e("./util"),s=a.isObject,c=e("./es5");"function"==typeof Map&&(o=Map);var d=function(){var e=0,t=0;function r(r,n){this[e]=r,this[e+t]=n,e++}return function(n){t=n.size,e=0;var i=new Array(2*n.size);return n.forEach(r,i),i}}();function l(e){var t,r=!1;if(void 0!==o&&e instanceof o)t=d(e),r=!0;else{var n=c.keys(e),i=n.length;t=new Array(2*i);for(var a=0;a<i;++a){var s=n[a];t[a]=e[s],t[a+i]=s}}this.constructor$(t),this._isMap=r,this._init$(void 0,-3)}function u(e){var r,o=n(e);return s(o)?(r=o instanceof t?o._then(t.props,void 0,void 0,void 0,void 0):new l(o).promise(),o instanceof t&&r._propagateFrom(o,2),r):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}a.inherits(l,r),l.prototype._init=function(){},l.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var r;if(this._isMap)r=function(e){for(var t=new o,r=e.length/2|0,n=0;n<r;++n){var i=e[r+n],a=e[n];t.set(i,a)}return t}(this._values);else{r={};for(var n=this.length(),i=0,a=this.length();i<a;++i)r[this._values[i+n]]=this._values[i]}return this._resolve(r),!0}return!1},l.prototype.shouldCopyValues=function(){return!1},l.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return u(this)},t.props=function(e){return u(e)}}},{"./es5":14,"./util":37}],27:[function(e,t,r){"use strict";function n(e){this._capacity=e,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(e){return this._capacity<e},n.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},n.prototype.push=function(e,t,r){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(e),this._pushOne(t),void this._pushOne(r);var i=this._front+n-3;this._checkCapacity(n);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=r,this._length=n},n.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,function(e,t,r,n,i){for(var o=0;o<i;++o)r[o+n]=e[o+t],e[o+t]=void 0}(this,0,this,t,this._front+this._length&t-1)},t.exports=n},{}],28:[function(e,t,r){"use strict";t.exports=function(t,r,n,i){var o=e("./util"),a=function(e){return e.then(function(t){return s(t,e)})};function s(e,s){var c=n(e);if(c instanceof t)return a(c);if(null===(e=o.asArray(e)))return i("expecting an array or an iterable object but got "+o.classString(e));var d=new t(r);void 0!==s&&d._propagateFrom(s,3);for(var l=d._fulfill,u=d._reject,p=0,f=e.length;p<f;++p){var h=e[p];(void 0!==h||p in e)&&t.cast(h)._then(l,u,void 0,d,null)}return d}t.race=function(e){return s(e,void 0)},t.prototype.race=function(){return s(this,void 0)}}},{"./util":37}],29:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,a){var s=t._getDomain,c=e("./util"),d=c.tryCatch;function l(e,r,n,i){this.constructor$(e);var a=s();this._fn=null===a?r:c.domainBind(a,r),void 0!==n&&(n=t.resolve(n))._attachCancellationCallback(this),this._initialValue=n,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function p(e,t,r,i){return"function"!=typeof t?n("expecting a function but got "+c.classString(t)):new l(e,t,r,i).promise()}function f(e){this.accum=e,this.array._gotAccum(e);var r=i(this.value,this.array._promise);return r instanceof t?(this.array._currentCancellable=r,r._then(h,void 0,void 0,this,void 0)):h.call(this,r)}function h(e){var r,n=this.array,i=n._promise,o=d(n._fn);i._pushContext(),(r=void 0!==n._eachValues?o.call(i._boundValue(),e,this.index,this.length):o.call(i._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(n._currentCancellable=r);var s=i._popContext();return a.checkForgottenReturns(r,s,void 0!==n._eachValues?"Promise.each":"Promise.reduce",i),r}c.inherits(l,r),l.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},l.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},l.prototype._init=function(){},l.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},l.prototype.shouldCopyValues=function(){return!1},l.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},l.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},l.prototype._iterate=function(e){var r,n;this._values=e;var i=e.length;if(void 0!==this._initialValue?(r=this._initialValue,n=0):(r=t.resolve(e[0]),n=1),this._currentCancellable=r,!r.isRejected())for(;n<i;++n){var o={accum:null,value:e[n],index:n,length:i,array:this};r=r._then(f,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(u,u,void 0,r,this)},t.prototype.reduce=function(e,t){return p(this,e,t,null)},t.reduce=function(e,t,r,n){return p(e,t,r,n)}}},{"./util":37}],30:[function(e,t,r){(function(r,n){"use strict";var i,o=e("./util"),a=o.getNativePromise();if(o.isNode&&"undefined"==typeof MutationObserver){var s=n.setImmediate,c=r.nextTick;i=o.isRecentNode?function(e){s.call(n,e)}:function(e){c.call(r,e)}}else if("function"==typeof a&&"function"==typeof a.resolve){var d=a.resolve();i=function(e){d.then(e)}}else i="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:function(){var e=document.createElement("div"),t={attributes:!0},r=!1,n=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),r=!1}).observe(n,t);return function(i){var o=new MutationObserver(function(){o.disconnect(),i()});o.observe(e,t),r||(r=!0,n.classList.toggle("foo"))}}();t.exports=i}).call(this,e("qC859L"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./util":37,qC859L:43}],31:[function(e,t,r){"use strict";t.exports=function(t,r,n){var i=t.PromiseInspection;function o(e){this.constructor$(e)}e("./util").inherits(o,r),o.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},o.prototype._promiseFulfilled=function(e,t){var r=new i;return r._bitField=33554432,r._settledValueField=e,this._promiseResolved(t,r)},o.prototype._promiseRejected=function(e,t){var r=new i;return r._bitField=16777216,r._settledValueField=e,this._promiseResolved(t,r)},t.settle=function(e){return n.deprecated(".settle()",".reflect()"),new o(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":37}],32:[function(e,t,r){"use strict";t.exports=function(t,r,n){var i=e("./util"),o=e("./errors").RangeError,a=e("./errors").AggregateError,s=i.isArray,c={};function d(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function l(e,t){if((0|t)!==t||t<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var r=new d(e),i=r.promise();return r.setHowMany(t),r.init(),i}i.inherits(d,r),d.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var e=s(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},d.prototype.init=function(){this._initialized=!0,this._init()},d.prototype.setUnwrap=function(){this._unwrap=!0},d.prototype.howMany=function(){return this._howMany},d.prototype.setHowMany=function(e){this._howMany=e},d.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},d.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},d.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(c),this._checkOutcome())},d.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new a,t=this.length();t<this._values.length;++t)this._values[t]!==c&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},d.prototype._fulfilled=function(){return this._totalResolved},d.prototype._rejected=function(){return this._values.length-this.length()},d.prototype._addRejected=function(e){this._values.push(e)},d.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},d.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},d.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new o(t)},d.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return l(e,t)},t.prototype.some=function(e){return l(this,e)},t._SomePromiseArray=d}},{"./errors":13,"./util":37}],33:[function(e,t,r){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var r=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return a.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return r.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),n.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],34:[function(e,t,r){"use strict";t.exports=function(t,r){var n=e("./util"),i=n.errorObj,o=n.isObject;var a={}.hasOwnProperty;return function(e,s){if(o(e)){if(e instanceof t)return e;var c=function(e){try{return function(e){return e.then}(e)}catch(e){return i.e=e,i}}(e);if(c===i){s&&s._pushContext();var d=t.reject(c.e);return s&&s._popContext(),d}if("function"==typeof c)return function(e){try{return a.call(e,"_promise0")}catch(e){return!1}}(e)?(d=new t(r),e._then(d._fulfill,d._reject,void 0,d,null),d):function(e,o,a){var s=new t(r),c=s;a&&a._pushContext(),s._captureStackTrace(),a&&a._popContext();var d=!0,l=n.tryCatch(o).call(e,function(e){s&&(s._resolveCallback(e),s=null)},function(e){s&&(s._rejectCallback(e,d,!0),s=null)});return d=!1,s&&l===i&&(s._rejectCallback(l.e,!0,!0),s=null),c}(e,c,s)}return e}}},{"./util":37}],35:[function(e,t,r){"use strict";t.exports=function(t,r,n){var i=e("./util"),o=t.TimeoutError;function a(e){this.handle=e}a.prototype._resultCancelled=function(){clearTimeout(this.handle)};var s=function(e){return c(+this).thenReturn(e)},c=t.delay=function(e,i){var o,c;return void 0!==i?(o=t.resolve(i)._then(s,null,null,e,void 0),n.cancellation()&&i instanceof t&&o._setOnCancel(i)):(o=new t(r),c=setTimeout(function(){o._fulfill()},+e),n.cancellation()&&o._setOnCancel(new a(c)),o._captureStackTrace()),o._setAsyncGuaranteed(),o};t.prototype.delay=function(e){return c(e,this)};function d(e){return clearTimeout(this.handle),e}function l(e){throw clearTimeout(this.handle),e}t.prototype.timeout=function(e,t){var r,s;e=+e;var c=new a(setTimeout(function(){r.isPending()&&function(e,t,r){var n;n="string"!=typeof t?t instanceof Error?t:new o("operation timed out"):new o(t),i.markAsOriginatingFromRejection(n),e._attachExtraTrace(n),e._reject(n),null!=r&&r.cancel()}(r,t,s)},e));return n.cancellation()?(s=this.then(),(r=s._then(d,l,void 0,c,void 0))._setOnCancel(c)):r=this._then(d,l,void 0,c,void 0),r}}},{"./util":37}],36:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,a){var s=e("./util"),c=e("./errors").TypeError,d=e("./util").inherits,l=s.errorObj,u=s.tryCatch,p={};function f(e){setTimeout(function(){throw e},0)}function h(e,r){var i=0,a=e.length,s=new t(o);return function o(){if(i>=a)return s._fulfill();var c=function(e){var t=n(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}(e[i++]);if(c instanceof t&&c._isDisposable()){try{c=n(c._getDisposer().tryDispose(r),e.promise)}catch(e){return f(e)}if(c instanceof t)return c._then(o,f,null,null,null)}o()}(),s}function m(e,t,r){this._data=e,this._promise=t,this._context=r}function v(e,t,r){this.constructor$(e,t,r)}function g(e){return m.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function y(e){this.length=e,this.promise=null,this[e-1]=null}m.prototype.data=function(){return this._data},m.prototype.promise=function(){return this._promise},m.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():p},m.prototype.tryDispose=function(e){var t=this.resource(),r=this._context;void 0!==r&&r._pushContext();var n=t!==p?this.doDispose(t,e):null;return void 0!==r&&r._popContext(),this._promise._unsetDisposable(),this._data=null,n},m.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},d(v,m),v.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},y.prototype._resultCancelled=function(){for(var e=this.length,r=0;r<e;++r){var n=this[r];n instanceof t&&n.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return r("you must pass at least 2 arguments to Promise.using");var i,o=arguments[e-1];if("function"!=typeof o)return r("expecting a function but got "+s.classString(o));var c=!0;2===e&&Array.isArray(arguments[0])?(e=(i=arguments[0]).length,c=!1):(i=arguments,e--);for(var d=new y(e),p=0;p<e;++p){var f=i[p];if(m.isDisposer(f)){var v=f;(f=f.promise())._setDisposable(v)}else{var b=n(f);b instanceof t&&(f=b._then(g,null,null,{resources:d,index:p},void 0))}d[p]=f}var _=new Array(d.length);for(p=0;p<_.length;++p)_[p]=t.resolve(d[p]).reflect();var w=t.all(_).then(function(e){for(var t=0;t<e.length;++t){var r=e[t];if(r.isRejected())return l.e=r.error(),l;if(!r.isFulfilled())return void w.cancel();e[t]=r.value()}C._pushContext(),o=u(o);var n=c?o.apply(void 0,e):o(e),i=C._popContext();return a.checkForgottenReturns(n,i,"Promise.using",C),n}),C=w.lastly(function(){var e=new t.PromiseInspection(w);return h(d,e)});return d.promise=C,C._setOnCancel(d),C},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new v(e,this,i());throw new c}}},{"./errors":13,"./util":37}],37:[function(e,t,r){(function(r,n){"use strict";var i=e("./es5"),o="undefined"==typeof navigator,a={e:{}},s,c="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:void 0!==this?this:null;function d(){try{var e=s;return s=null,e.apply(this,arguments)}catch(e){return a.e=e,a}}function l(e){return s=e,d}var u=function(e,t){var r={}.hasOwnProperty;function n(){for(var n in this.constructor=e,this.constructor$=t,t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}return n.prototype=t.prototype,e.prototype=new n,e.prototype};function p(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function f(e){return"function"==typeof e||"object"==typeof e&&null!==e}function h(e){return p(e)?new Error(k(e)):e}function m(e,t){var r,n=e.length,i=new Array(n+1);for(r=0;r<n;++r)i[r]=e[r];return i[r]=t,i}function v(e,t,r){if(!i.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var n=Object.getOwnPropertyDescriptor(e,t);return null!=n?null==n.get&&null==n.set?n.value:r:void 0}function g(e,t,r){if(p(e))return e;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return i.defineProperty(e,t,n),e}function y(e){throw e}var b=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1};if(i.isES5){var r=Object.getOwnPropertyNames;return function(e){for(var n=[],o=Object.create(null);null!=e&&!t(e);){var a;try{a=r(e)}catch(e){return n}for(var s=0;s<a.length;++s){var c=a[s];if(!o[c]){o[c]=!0;var d=Object.getOwnPropertyDescriptor(e,c);null!=d&&null==d.get&&null==d.set&&n.push(c)}}e=i.getPrototypeOf(e)}return n}}var n={}.hasOwnProperty;return function(r){if(t(r))return[];var i=[];e:for(var o in r)if(n.call(r,o))i.push(o);else{for(var a=0;a<e.length;++a)if(n.call(e[a],o))continue e;i.push(o)}return i}}(),_=/this\s*\.\s*\S+\s*=/;function w(e){try{if("function"==typeof e){var t=i.names(e.prototype),r=i.isES5&&t.length>1,n=t.length>0&&!(1===t.length&&"constructor"===t[0]),o=_.test(e+"")&&i.names(e).length>0;if(r||n||o)return!0}return!1}catch(e){return!1}}function C(e){function t(){}t.prototype=e;for(var r=8;r--;)new t;return e}var S=/^[a-z$_][a-z$_0-9]*$/i;function T(e){return S.test(e)}function A(e,t,r){for(var n=new Array(e),i=0;i<e;++i)n[i]=t+i+r;return n}function k(e){try{return e+""}catch(e){return"[no string representation]"}}function R(e){return null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function E(e){try{g(e,"isOperational",!0)}catch(e){}}function P(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function I(e){return R(e)&&i.propertyIsWritable(e,"stack")}var x="stack"in new Error?function(e){return I(e)?e:new Error(k(e))}:function(e){if(I(e))return e;try{throw new Error(k(e))}catch(e){return e}};function D(e){return{}.toString.call(e)}function j(e,t,r){for(var n=i.names(e),o=0;o<n.length;++o){var a=n[o];if(r(a))try{i.defineProperty(t,a,i.getDescriptor(e,a))}catch(e){}}}var O=function(e){return i.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var M="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,r=[],n=e[Symbol.iterator]();!(t=n.next()).done;)r.push(t.value);return r};O=function(e){return i.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?M(e):null}}var L=void 0!==r&&"[object process]"===D(r).toLowerCase(),B=void 0!==r&&void 0!==r.env;function F(e){return B?r.env[e]:void 0}function N(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function V(e,t){return e.bind(t)}var U={isClass:w,isIdentifier:T,inheritedDataKeys:b,getDataPropertyOrDefault:v,thrower:y,isArray:i.isArray,asArray:O,notEnumerableProp:g,isPrimitive:p,isObject:f,isError:R,canEvaluate:o,errorObj:a,tryCatch:l,inherits:u,withAppended:m,maybeWrapAsError:h,toFastProperties:C,filledRange:A,toString:k,canAttachTrace:I,ensureErrorObject:x,originatesFromRejection:P,markAsOriginatingFromRejection:E,classString:D,copyDescriptors:j,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:L,hasEnvVariables:B,env:F,global:c,getNativePromise:N,domainBind:V},H;U.isRecentNode=U.isNode&&(H=r.versions.node.split(".").map(Number),0===H[0]&&H[1]>10||H[0]>0),U.isNode&&U.toFastProperties(r);try{throw new Error}catch(e){U.lastLineError=e}t.exports=U}).call(this,e("qC859L"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./es5":14,qC859L:43}],38:[function(e,t,r){var n=e("base64-js"),i=e("ieee754");function o(e,t,r){if(!(this instanceof o))return new o(e,t,r);var n,i,a,s,c=typeof e;if("base64"===t&&"string"===c)for(e=(n=e).trim?n.trim():n.replace(/^\s+|\s+$/g,"");e.length%4!=0;)e+="=";if("number"===c)i=C(e);else if("string"===c)i=o.byteLength(e,t);else{if("object"!==c)throw new Error("First argument needs to be a number, array or string.");i=C(e.length)}if(o._useTypedArrays?a=o._augment(new Uint8Array(i)):((a=this).length=i,a._isBuffer=!0),o._useTypedArrays&&"number"==typeof e.byteLength)a._set(e);else if(function(e){return S(e)||o.isBuffer(e)||e&&"object"==typeof e&&"number"==typeof e.length}(e))for(s=0;s<i;s++)o.isBuffer(e)?a[s]=e.readUInt8(s):a[s]=e[s];else if("string"===c)a.write(e,0,t);else if("number"===c&&!o._useTypedArrays&&!r)for(s=0;s<i;s++)a[s]=0;return a}function a(e,t,r,n){return o._charsWritten=R(function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function s(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;i++)n+=String.fromCharCode(e[i]);return n}function c(e,t,r,n){n||(D("boolean"==typeof r,"missing or invalid endian"),D(void 0!==t&&null!==t,"missing offset"),D(t+1<e.length,"Trying to read beyond buffer length"));var i,o=e.length;if(!(t>=o))return r?(i=e[t],t+1<o&&(i|=e[t+1]<<8)):(i=e[t]<<8,t+1<o&&(i|=e[t+1])),i}function d(e,t,r,n){n||(D("boolean"==typeof r,"missing or invalid endian"),D(void 0!==t&&null!==t,"missing offset"),D(t+3<e.length,"Trying to read beyond buffer length"));var i,o=e.length;if(!(t>=o))return r?(t+2<o&&(i=e[t+2]<<16),t+1<o&&(i|=e[t+1]<<8),i|=e[t],t+3<o&&(i+=e[t+3]<<24>>>0)):(t+1<o&&(i=e[t+1]<<16),t+2<o&&(i|=e[t+2]<<8),t+3<o&&(i|=e[t+3]),i+=e[t]<<24>>>0),i}function l(e,t,r,n){if(n||(D("boolean"==typeof r,"missing or invalid endian"),D(void 0!==t&&null!==t,"missing offset"),D(t+1<e.length,"Trying to read beyond buffer length")),!(t>=e.length)){var i=c(e,t,r,!0);return 32768&i?-1*(65535-i+1):i}}function u(e,t,r,n){if(n||(D("boolean"==typeof r,"missing or invalid endian"),D(void 0!==t&&null!==t,"missing offset"),D(t+3<e.length,"Trying to read beyond buffer length")),!(t>=e.length)){var i=d(e,t,r,!0);return 2147483648&i?-1*(4294967295-i+1):i}}function p(e,t,r,n){return n||(D("boolean"==typeof r,"missing or invalid endian"),D(t+3<e.length,"Trying to read beyond buffer length")),i.read(e,t,r,23,4)}function f(e,t,r,n){return n||(D("boolean"==typeof r,"missing or invalid endian"),D(t+7<e.length,"Trying to read beyond buffer length")),i.read(e,t,r,52,8)}function h(e,t,r,n,i){i||(D(void 0!==t&&null!==t,"missing value"),D("boolean"==typeof n,"missing or invalid endian"),D(void 0!==r&&null!==r,"missing offset"),D(r+1<e.length,"trying to write beyond buffer length"),P(t,65535));var o=e.length;if(!(r>=o))for(var a=0,s=Math.min(o-r,2);a<s;a++)e[r+a]=(t&255<<8*(n?a:1-a))>>>8*(n?a:1-a)}function m(e,t,r,n,i){i||(D(void 0!==t&&null!==t,"missing value"),D("boolean"==typeof n,"missing or invalid endian"),D(void 0!==r&&null!==r,"missing offset"),D(r+3<e.length,"trying to write beyond buffer length"),P(t,4294967295));var o=e.length;if(!(r>=o))for(var a=0,s=Math.min(o-r,4);a<s;a++)e[r+a]=t>>>8*(n?a:3-a)&255}function v(e,t,r,n,i){i||(D(void 0!==t&&null!==t,"missing value"),D("boolean"==typeof n,"missing or invalid endian"),D(void 0!==r&&null!==r,"missing offset"),D(r+1<e.length,"Trying to write beyond buffer length"),I(t,32767,-32768)),r>=e.length||h(e,t>=0?t:65535+t+1,r,n,i)}function g(e,t,r,n,i){i||(D(void 0!==t&&null!==t,"missing value"),D("boolean"==typeof n,"missing or invalid endian"),D(void 0!==r&&null!==r,"missing offset"),D(r+3<e.length,"Trying to write beyond buffer length"),I(t,2147483647,-2147483648)),r>=e.length||m(e,t>=0?t:4294967295+t+1,r,n,i)}function y(e,t,r,n,o){o||(D(void 0!==t&&null!==t,"missing value"),D("boolean"==typeof n,"missing or invalid endian"),D(void 0!==r&&null!==r,"missing offset"),D(r+3<e.length,"Trying to write beyond buffer length"),x(t,3.4028234663852886e38,-3.4028234663852886e38)),r>=e.length||i.write(e,t,r,n,23,4)}function b(e,t,r,n,o){o||(D(void 0!==t&&null!==t,"missing value"),D("boolean"==typeof n,"missing or invalid endian"),D(void 0!==r&&null!==r,"missing offset"),D(r+7<e.length,"Trying to write beyond buffer length"),x(t,1.7976931348623157e308,-1.7976931348623157e308)),r>=e.length||i.write(e,t,r,n,52,8)}r.Buffer=o,r.SlowBuffer=o,r.INSPECT_MAX_BYTES=50,o.poolSize=8192,o._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(e){return!1}}(),o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.isBuffer=function(e){return!(null===e||void 0===e||!e._isBuffer)},o.byteLength=function(e,t){var r;switch(e+="",t||"utf8"){case"hex":r=e.length/2;break;case"utf8":case"utf-8":r=A(e).length;break;case"ascii":case"binary":case"raw":r=e.length;break;case"base64":r=k(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=2*e.length;break;default:throw new Error("Unknown encoding")}return r},o.concat=function(e,t){if(D(S(e),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===e.length)return new o(0);if(1===e.length)return e[0];var r;if("number"!=typeof t)for(t=0,r=0;r<e.length;r++)t+=e[r].length;var n=new o(t),i=0;for(r=0;r<e.length;r++){var a=e[r];a.copy(n,i),i+=a.length}return n},o.prototype.write=function(e,t,r,n){if(isFinite(t))isFinite(r)||(n=r,r=void 0);else{var i=n;n=t,t=r,r=i}t=Number(t)||0;var s,c=this.length-t;switch(r?(r=Number(r))>c&&(r=c):r=c,n=String(n||"utf8").toLowerCase()){case"hex":s=function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;D(a%2==0,"Invalid hex string"),n>a/2&&(n=a/2);for(var s=0;s<n;s++){var c=parseInt(t.substr(2*s,2),16);D(!isNaN(c),"Invalid hex string"),e[r+s]=c}return o._charsWritten=2*s,s}(this,e,t,r);break;case"utf8":case"utf-8":s=function(e,t,r,n){return o._charsWritten=R(A(t),e,r,n)}(this,e,t,r);break;case"ascii":s=a(this,e,t,r);break;case"binary":s=function(e,t,r,n){return a(e,t,r,n)}(this,e,t,r);break;case"base64":s=function(e,t,r,n){return o._charsWritten=R(k(t),e,r,n)}(this,e,t,r);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":s=function(e,t,r,n){return o._charsWritten=R(function(e){for(var t,r,n,i=[],o=0;o<e.length;o++)t=e.charCodeAt(o),r=t>>8,n=t%256,i.push(n),i.push(r);return i}(t),e,r,n)}(this,e,t,r);break;default:throw new Error("Unknown encoding")}return s},o.prototype.toString=function(e,t,r){var i;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,(r=void 0!==r?Number(r):r=this.length)===t)return"";switch(e){case"hex":i=function(e,t,r){var n=e.length;(!t||t<0)&&(t=0);(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;o++)i+=T(e[o]);return i}(this,t,r);break;case"utf8":case"utf-8":i=function(e,t,r){var n="",i="";r=Math.min(e.length,r);for(var o=t;o<r;o++)e[o]<=127?(n+=E(i)+String.fromCharCode(e[o]),i=""):i+="%"+e[o].toString(16);return n+E(i)}(this,t,r);break;case"ascii":i=s(this,t,r);break;case"binary":i=function(e,t,r){return s(e,t,r)}(this,t,r);break;case"base64":i=function(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}(this,t,r);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=function(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}(this,t,r);break;default:throw new Error("Unknown encoding")}return i},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t||(t=0),n!==r&&0!==e.length&&0!==this.length){D(n>=r,"sourceEnd < sourceStart"),D(t>=0&&t<e.length,"targetStart out of bounds"),D(r>=0&&r<this.length,"sourceStart out of bounds"),D(n>=0&&n<=this.length,"sourceEnd out of bounds"),n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(i<100||!o._useTypedArrays)for(var a=0;a<i;a++)e[a+t]=this[a+r];else e._set(this.subarray(r,r+i),t)}},o.prototype.slice=function(e,t){var r=this.length;if(e=w(e,r,0),t=w(t,r,r),o._useTypedArrays)return o._augment(this.subarray(e,t));for(var n=t-e,i=new o(n,void 0,!0),a=0;a<n;a++)i[a]=this[a+e];return i},o.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},o.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},o.prototype.readUInt8=function(e,t){if(t||(D(void 0!==e&&null!==e,"missing offset"),D(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return this[e]},o.prototype.readUInt16LE=function(e,t){return c(this,e,!0,t)},o.prototype.readUInt16BE=function(e,t){return c(this,e,!1,t)},o.prototype.readUInt32LE=function(e,t){return d(this,e,!0,t)},o.prototype.readUInt32BE=function(e,t){return d(this,e,!1,t)},o.prototype.readInt8=function(e,t){if(t||(D(void 0!==e&&null!==e,"missing offset"),D(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return 128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){return l(this,e,!0,t)},o.prototype.readInt16BE=function(e,t){return l(this,e,!1,t)},o.prototype.readInt32LE=function(e,t){return u(this,e,!0,t)},o.prototype.readInt32BE=function(e,t){return u(this,e,!1,t)},o.prototype.readFloatLE=function(e,t){return p(this,e,!0,t)},o.prototype.readFloatBE=function(e,t){return p(this,e,!1,t)},o.prototype.readDoubleLE=function(e,t){return f(this,e,!0,t)},o.prototype.readDoubleBE=function(e,t){return f(this,e,!1,t)},o.prototype.writeUInt8=function(e,t,r){r||(D(void 0!==e&&null!==e,"missing value"),D(void 0!==t&&null!==t,"missing offset"),D(t<this.length,"trying to write beyond buffer length"),P(e,255)),t>=this.length||(this[t]=e)},o.prototype.writeUInt16LE=function(e,t,r){h(this,e,t,!0,r)},o.prototype.writeUInt16BE=function(e,t,r){h(this,e,t,!1,r)},o.prototype.writeUInt32LE=function(e,t,r){m(this,e,t,!0,r)},o.prototype.writeUInt32BE=function(e,t,r){m(this,e,t,!1,r)},o.prototype.writeInt8=function(e,t,r){r||(D(void 0!==e&&null!==e,"missing value"),D(void 0!==t&&null!==t,"missing offset"),D(t<this.length,"Trying to write beyond buffer length"),I(e,127,-128)),t>=this.length||(e>=0?this.writeUInt8(e,t,r):this.writeUInt8(255+e+1,t,r))},o.prototype.writeInt16LE=function(e,t,r){v(this,e,t,!0,r)},o.prototype.writeInt16BE=function(e,t,r){v(this,e,t,!1,r)},o.prototype.writeInt32LE=function(e,t,r){g(this,e,t,!0,r)},o.prototype.writeInt32BE=function(e,t,r){g(this,e,t,!1,r)},o.prototype.writeFloatLE=function(e,t,r){y(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){y(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){b(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){b(this,e,t,!1,r)},o.prototype.fill=function(e,t,r){if(e||(e=0),t||(t=0),r||(r=this.length),"string"==typeof e&&(e=e.charCodeAt(0)),D("number"==typeof e&&!isNaN(e),"value is not a number"),D(r>=t,"end < start"),r!==t&&0!==this.length){D(t>=0&&t<this.length,"start out of bounds"),D(r>=0&&r<=this.length,"end out of bounds");for(var n=t;n<r;n++)this[n]=e}},o.prototype.inspect=function(){for(var e=[],t=this.length,n=0;n<t;n++)if(e[n]=T(this[n]),n===r.INSPECT_MAX_BYTES){e[n+1]="...";break}return"<Buffer "+e.join(" ")+">"},o.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(o._useTypedArrays)return new o(this).buffer;for(var e=new Uint8Array(this.length),t=0,r=e.length;t<r;t+=1)e[t]=this[t];return e.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var _=o.prototype;function w(e,t,r){return"number"!=typeof e?r:(e=~~e)>=t?t:e>=0?e:(e+=t)>=0?e:0}function C(e){return(e=~~Math.ceil(+e))<0?0:e}function S(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function T(e){return e<16?"0"+e.toString(16):e.toString(16)}function A(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r);if(n<=127)t.push(e.charCodeAt(r));else{var i=r;n>=55296&&n<=57343&&r++;for(var o=encodeURIComponent(e.slice(i,r+1)).substr(1).split("%"),a=0;a<o.length;a++)t.push(parseInt(o[a],16))}}return t}function k(e){return n.toByteArray(e)}function R(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);i++)t[i+r]=e[i];return i}function E(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}function P(e,t){D("number"==typeof e,"cannot write a non-number as a number"),D(e>=0,"specified a negative value for writing an unsigned value"),D(e<=t,"value is larger than maximum value for type"),D(Math.floor(e)===e,"value has a fractional component")}function I(e,t,r){D("number"==typeof e,"cannot write a non-number as a number"),D(e<=t,"value larger than maximum allowed value"),D(e>=r,"value smaller than minimum allowed value"),D(Math.floor(e)===e,"value has a fractional component")}function x(e,t,r){D("number"==typeof e,"cannot write a non-number as a number"),D(e<=t,"value larger than maximum allowed value"),D(e>=r,"value smaller than minimum allowed value")}function D(e,t){if(!e)throw new Error(t||"Failed assertion")}o._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=_.get,e.set=_.set,e.write=_.write,e.toString=_.toString,e.toLocaleString=_.toString,e.toJSON=_.toJSON,e.copy=_.copy,e.slice=_.slice,e.readUInt8=_.readUInt8,e.readUInt16LE=_.readUInt16LE,e.readUInt16BE=_.readUInt16BE,e.readUInt32LE=_.readUInt32LE,e.readUInt32BE=_.readUInt32BE,e.readInt8=_.readInt8,e.readInt16LE=_.readInt16LE,e.readInt16BE=_.readInt16BE,e.readInt32LE=_.readInt32LE,e.readInt32BE=_.readInt32BE,e.readFloatLE=_.readFloatLE,e.readFloatBE=_.readFloatBE,e.readDoubleLE=_.readDoubleLE,e.readDoubleBE=_.readDoubleBE,e.writeUInt8=_.writeUInt8,e.writeUInt16LE=_.writeUInt16LE,e.writeUInt16BE=_.writeUInt16BE,e.writeUInt32LE=_.writeUInt32LE,e.writeUInt32BE=_.writeUInt32BE,e.writeInt8=_.writeInt8,e.writeInt16LE=_.writeInt16LE,e.writeInt16BE=_.writeInt16BE,e.writeInt32LE=_.writeInt32LE,e.writeInt32BE=_.writeInt32BE,e.writeFloatLE=_.writeFloatLE,e.writeFloatBE=_.writeFloatBE,e.writeDoubleLE=_.writeDoubleLE,e.writeDoubleBE=_.writeDoubleBE,e.fill=_.fill,e.inspect=_.inspect,e.toArrayBuffer=_.toArrayBuffer,e}},{"base64-js":1,ieee754:41}],39:[function(e,t,r){(function(e){"use strict";function r(t){return t instanceof e||t instanceof Date||t instanceof RegExp}function n(t){if(t instanceof e){var r=e.alloc?e.alloc(t.length):new e(t.length);return t.copy(r),r}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);throw new Error("Unexpected situation")}function i(e,t){return"__proto__"===t?void 0:e[t]}var o=t.exports=function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];var e,t,a=arguments[0];return Array.prototype.slice.call(arguments,1).forEach(function(s){"object"!=typeof s||null===s||Array.isArray(s)||Object.keys(s).forEach(function(c){return t=i(a,c),(e=i(s,c))===a?void 0:"object"!=typeof e||null===e?void(a[c]=e):Array.isArray(e)?void(a[c]=function e(t){var i=[];return t.forEach(function(t,a){"object"==typeof t&&null!==t?Array.isArray(t)?i[a]=e(t):r(t)?i[a]=n(t):i[a]=o({},t):i[a]=t}),i}(e)):r(e)?void(a[c]=n(e)):"object"!=typeof t||null===t||Array.isArray(t)?void(a[c]=o({},e)):void(a[c]=o(t,e))})}),a}}).call(this,e("buffer").Buffer)},{buffer:38}],40:[function(e,t,r){(function(e,r){"use strict";!function(){var n,i="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(w="object"==typeof e&&"object"==typeof e.versions&&e.versions.node&&!e.browser){var o=e.versions.node.toString().replace("v","");i="Nodejs/"+o+" (NodeOS) AppleWebKit/"+o+" (KHTML, like Gecko) Nodejs/"+o+" Nodejs/"+o}n=void 0!==r?r:window,"undefined"==typeof window&&("undefined"==typeof window&&void 0!==r&&(r.navigator={userAgent:i,getUserMedia:function(){}},n.window=r),"undefined"==typeof location&&(n.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(n.screen={width:0,height:0}));var a=window.navigator;void 0!==a?(void 0!==a.webkitGetUserMedia&&(a.getUserMedia=a.webkitGetUserMedia),void 0!==a.mozGetUserMedia&&(a.getUserMedia=a.mozGetUserMedia)):a={getUserMedia:function(){},userAgent:i};var s=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(a.userAgent||""),c=!(-1===a.userAgent.indexOf("Edge")||!a.msSaveOrOpenBlob&&!a.msSaveBlob),d=!!window.opera||a.userAgent.indexOf(" OPR/")>=0,l=a.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(a.userAgent),u=/^((?!chrome|android).)*safari/i.test(a.userAgent),p=!!window.chrome&&!d,f="undefined"!=typeof document&&!!document.documentMode&&!c;function h(e,t){var r=0,n=!1,i=window.setInterval(function(){e()&&(window.clearInterval(i),t(n)),r++>50&&(window.clearInterval(i),t(n=!0))},10)}var m={Android:function(){return a.userAgent.match(/Android/i)},BlackBerry:function(){return a.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return a.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return a.userAgent.match(/Opera Mini/i)},Windows:function(){return a.userAgent.match(/IEMobile/i)},any:function(){return m.Android()||m.BlackBerry()||m.iOS()||m.Opera()||m.Windows()},getOsName:function(){var e="Unknown OS";return m.Android()&&(e="Android"),m.BlackBerry()&&(e="BlackBerry"),m.iOS()&&(e="iOS"),m.Opera()&&(e="Opera Mini"),m.Windows()&&(e="Windows"),e}};var v="Unknown OS",g="Unknown OS Version";var y,b,_=function(){for(var e,t=a.appVersion,r=a.userAgent,n="-",i=[{s:"Chrome OS",r:/CrOS/},{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],o=0;e=i[o];o++)if(e.r.test(r)){n=e.s;break}var s="-";switch(/Windows/.test(n)&&(/Windows (.*)/.test(n)&&(s=/Windows (.*)/.exec(n)[1]),n="Windows"),n){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(r)&&(s=/Mac OS X (10[\.\_\d]+)/.exec(r)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(r)&&(s=/Android ([\.\_\d]+)/.exec(r)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(r)&&(s=(s=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))[1]+"."+s[2]+"."+(0|s[3]))}return{osName:n,osVersion:s}}();_&&_.osName&&"-"!=_.osName?(v=_.osName,g=_.osVersion):m.any()&&"Android"==(v=m.getOsName())&&(g=!!(b=(y=(y||a.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&b[1]);var w="object"==typeof e&&"object"==typeof e.versions&&e.versions.node;"Unknown OS"===v&&w&&(v="Nodejs",g=e.versions.node.toString().replace("v",""));var C=!1,S=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!C&&e in document.createElement("canvas")&&(C=!0),!S&&e in document.createElement("video")&&(S=!0))});var T=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,A=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,k=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;var R=[],E=[],P=[],I=[];a.mediaDevices&&a.mediaDevices.enumerateDevices&&(a.enumerateDevices=function(e){var t=a.mediaDevices.enumerateDevices();t&&t.then?a.mediaDevices.enumerateDevices().then(e).catch(function(){e([])}):e([])});var x=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?x=!0:a.mediaDevices&&a.mediaDevices.enumerateDevices&&(x=!0);var D=!1,j=!1,O=!1,M=!1,L=!1;function B(e){if(x)if(!a.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(a.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!a.enumerateDevices&&a.enumerateDevices&&(a.enumerateDevices=a.enumerateDevices.bind(a)),a.enumerateDevices){R=[],E=[],P=[],I=[],D=!1,j=!1,O=!1,M=!1,L=!1;var t={};a.enumerateDevices(function(r){R=[],E=[],P=[],I=[],r.forEach(function(e){var r={};for(var n in e)try{"function"!=typeof e[n]&&(r[n]=e[n])}catch(e){}t[r.deviceId+r.label+r.kind]||("audio"===r.kind&&(r.kind="audioinput"),"video"===r.kind&&(r.kind="videoinput"),r.deviceId||(r.deviceId=r.id),r.id||(r.id=r.deviceId),r.label?("videoinput"!==r.kind||L||(L=!0),"audioinput"!==r.kind||M||(M=!0)):(r.isCustomLabel=!0,"videoinput"===r.kind?r.label="Camera "+(I.length+1):"audioinput"===r.kind?r.label="Microphone "+(E.length+1):"audiooutput"===r.kind?r.label="Speaker "+(P.length+1):r.label="Please invoke getUserMedia once.",void 0!==F&&F.browser.isChrome&&F.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(r.label="HTTPs is required to get label of this "+r.kind+" device.")),"audioinput"===r.kind&&(D=!0,-1===E.indexOf(r)&&E.push(r)),"audiooutput"===r.kind&&(j=!0,-1===P.indexOf(r)&&P.push(r)),"videoinput"===r.kind&&(O=!0,-1===I.indexOf(r)&&I.push(r)),R.push(r),t[r.deviceId+r.label+r.kind]=r)}),void 0!==F&&(F.MediaDevices=R,F.hasMicrophone=D,F.hasSpeakers=j,F.hasWebcam=O,F.isWebsiteHasWebcamPermissions=L,F.isWebsiteHasMicrophonePermissions=M,F.audioInputDevices=E,F.audioOutputDevices=P,F.videoInputDevices=I),e&&e()})}else e&&e();else e&&e()}var F=window.DetectRTC||{};F.browser=function(){a.appVersion;var e,t,r,n=a.userAgent,i=a.appName,o=""+parseFloat(a.appVersion),s=parseInt(a.appVersion,10);if(d){i="Opera";try{s=(o=a.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){o="0.0.0.0",s=0}}else f?((t=n.indexOf("rv:"))>0?o=n.substring(t+3):(t=n.indexOf("MSIE"),o=n.substring(t+5)),i="IE"):p?(t=n.indexOf("Chrome"),i="Chrome",o=n.substring(t+7)):u?-1!==n.indexOf("CriOS")?(t=n.indexOf("CriOS"),i="Chrome",o=n.substring(t+6)):-1!==n.indexOf("FxiOS")?(t=n.indexOf("FxiOS"),i="Firefox",o=n.substring(t+6)):(t=n.indexOf("Safari"),i="Safari",o=n.substring(t+7),-1!==(t=n.indexOf("Version"))&&(o=n.substring(t+8)),-1!==a.userAgent.indexOf("Version/")&&(o=a.userAgent.split("Version/")[1].split(" ")[0])):l?(t=n.indexOf("Firefox"),i="Firefox",o=n.substring(t+8)):(e=n.lastIndexOf(" ")+1)<(t=n.lastIndexOf("/"))&&(i=n.substring(e,t),o=n.substring(t+1),i.toLowerCase()===i.toUpperCase()&&(i=a.appName));return c&&(i="Edge",o=a.userAgent.split("Edge/")[1]),-1!==(r=o.search(/[; \)]/))&&(o=o.substring(0,r)),s=parseInt(""+o,10),isNaN(s)&&(o=""+parseFloat(a.appVersion),s=parseInt(a.appVersion,10)),{fullVersion:o,version:s,name:i,isPrivateBrowsing:!1}}(),function(e){var t;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){t=!1},function(e){t=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var r;try{(r=window.indexedDB.open("test")).onerror=function(){return!0}}catch(e){t=!0}void 0===t&&h(function(){return"done"===r.readyState},function(e){e||(t=!r.result)})}else if(function(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var r=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(r&&parseInt(r[1],10)>=10)}(window.navigator.userAgent)){t=!1;try{window.indexedDB||(t=!0)}catch(e){t=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){t=!0}void 0===t&&(t=!1,window.localStorage.removeItem("test"))}}catch(e){t=!1}h(function(){return void 0!==t},function(r){e(t)})}(function(e){F.browser.isPrivateBrowsing=!!e}),F.browser["is"+F.browser.name]=!0,F.osName=v,F.osVersion=g;"object"==typeof e&&"object"==typeof e.versions&&e.versions["node-webkit"];var N=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){N||e in window&&(N=!0)}),F.isWebRTCSupported=N,F.isORTCSupported="undefined"!=typeof RTCIceGatherer;var V=!1;(F.browser.isChrome&&F.browser.version>=35?V=!0:F.browser.isFirefox&&F.browser.version>=34?V=!0:F.browser.isEdge&&F.browser.version>=17?V=!0:"Android"===F.osName&&F.browser.isChrome&&(V=!0),(a.getDisplayMedia||a.mediaDevices&&a.mediaDevices.getDisplayMedia)&&(V=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(F.browser.isChrome||F.browser.isEdge||F.browser.isOpera)?V=!1:F.browser.isFirefox&&(V=!1));F.isScreenCapturingSupported=V;var U={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){U.isSupported||e in window&&(U.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(U.isCreateMediaStreamSourceSupported=!0))}),F.isAudioContextSupported=U.isSupported,F.isCreateMediaStreamSourceSupported=U.isCreateMediaStreamSourceSupported;var H=!1;F.browser.isChrome&&F.browser.version>31&&(H=!0),F.isRtpDataChannelsSupported=H;var G=!1;F.browser.isFirefox&&F.browser.version>28?G=!0:F.browser.isChrome&&F.browser.version>25?G=!0:F.browser.isOpera&&F.browser.version>=11&&(G=!0),F.isSctpDataChannelsSupported=G,F.isMobileDevice=s;var W=!1;a.getUserMedia?W=!0:a.mediaDevices&&a.mediaDevices.getUserMedia&&(W=!0),F.browser.isChrome&&F.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(W="Requires HTTPs"),"Nodejs"===F.osName&&(W=!1),F.isGetUserMediaSupported=W;var q,J,z,$="";screen.width&&($+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));F.displayResolution=$,F.displayAspectRatio=(q=screen.width,J=screen.height,z=function e(t,r){return 0==r?t:e(r,t%r)}(q,J),q/z/(J/z)).toFixed(2),F.isCanvasSupportsStreamCapturing=C,F.isVideoSupportsStreamCapturing=S,"Chrome"==F.browser.name&&F.browser.version>=53&&(F.isCanvasSupportsStreamCapturing||(F.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),F.isVideoSupportsStreamCapturing||(F.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),F.DetectLocalIPAddress=function(e,t){if(F.isWebRTCSupported){var r=!0,n=!0;!function(e,t){if("undefined"!=typeof document&&"function"==typeof document.getElementById){var r={},n=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!n){var i=document.getElementById("iframe");if(!i)return;var o=i.contentWindow;n=o.RTCPeerConnection||o.mozRTCPeerConnection||o.webkitRTCPeerConnection}if(n){var a=null;"Chrome"===F.browser&&F.browser.version<58&&(a={optional:[{RtpDataChannels:!0}]});var s=new n({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},a);if(t&&(s.addStream?s.addStream(t):s.addTrack&&t.getTracks()[0]&&s.addTrack(t.getTracks()[0],t)),s.onicecandidate=function(e){e.candidate&&e.candidate.candidate?c(e.candidate.candidate):c()},!t)try{s.createDataChannel("sctp",{})}catch(e){}F.isPromisesSupported?s.createOffer().then(function(e){s.setLocalDescription(e).then(d)}):s.createOffer(function(e){s.setLocalDescription(e,d,function(){})},function(){})}}function c(t){if(t){var n=A.exec(t);if(n){var i=n[1],o=t.match(T);void 0===r[i]&&e(i,o,!0),r[i]=!0}}else e()}function d(){var e=s.localDescription.sdp.split("\n");e.forEach(function(e){e&&0===e.indexOf("a=candidate:")&&c(e)})}}(function(t){t?t.match(T)?e("Local: "+t,r=!1,n):t.match(k)?e("Public: "+t,r,n=!1):e("Public: "+t,r,n):e()},t)}},F.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,F.isWebSocketsBlocked=!F.isWebSocketsSupported,"Nodejs"===F.osName&&(F.isWebSocketsSupported=!0,F.isWebSocketsBlocked=!1),F.checkWebSocketsSupport=function(e){e=e||function(){};try{var t,r=new WebSocket("wss://echo.websocket.org:443/");r.onopen=function(){F.isWebSocketsBlocked=!1,t=(new Date).getTime(),r.send("ping")},r.onmessage=function(){F.WebsocketLatency=(new Date).getTime()-t+"ms",e(),r.close(),r=null},r.onerror=function(){F.isWebSocketsBlocked=!0,e()}}catch(t){F.isWebSocketsBlocked=!0,e()}},F.load=function(e){B(e=e||function(){})},F.MediaDevices=void 0!==R?R:[],F.hasMicrophone=D,F.hasSpeakers=j,F.hasWebcam=O,F.isWebsiteHasWebcamPermissions=L,F.isWebsiteHasMicrophonePermissions=M,F.audioInputDevices=E,F.audioOutputDevices=P,F.videoInputDevices=I;var Q=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(Q=!0),F.isSetSinkIdSupported=Q;var X=!1;F.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(X=!0):F.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(X=!0),F.isRTPSenderReplaceTracksSupported=X;var K=!1;F.browser.isFirefox&&F.browser.version>38&&(K=!0),F.isRemoteStreamProcessingSupported=K;var Y=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(Y=!0),F.isApplyConstraintsSupported=Y;var Z=!1;F.browser.isFirefox&&F.browser.version>=43&&(Z=!0),F.isMultiMonitorScreenCapturingSupported=Z,F.isPromisesSupported=!!("Promise"in window),F.version="1.4.0",void 0===F&&(window.DetectRTC={});var ee=window.MediaStream;void 0===ee&&"undefined"!=typeof webkitMediaStream&&(ee=webkitMediaStream),F.MediaStream=void 0!==ee&&"function"==typeof ee&&Object.keys(ee.prototype),"undefined"!=typeof MediaStreamTrack?F.MediaStreamTrack=Object.keys(MediaStreamTrack.prototype):F.MediaStreamTrack=!1;var te=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;F.RTCPeerConnection=void 0!==te&&Object.keys(te.prototype),window.DetectRTC=F,void 0!==t&&(t.exports=F),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return F})}()}).call(this,e("qC859L"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{qC859L:43}],41:[function(e,t,r){r.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,c=(1<<s)-1,d=c>>1,l=-7,u=r?i-1:0,p=r?-1:1,f=e[t+u];for(u+=p,o=f&(1<<-l)-1,f>>=-l,l+=s;l>0;o=256*o+e[t+u],u+=p,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+e[t+u],u+=p,l-=8);if(0===o)o=1-d;else{if(o===c)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=d}return(f?-1:1)*a*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var a,s,c,d=8*o-i-1,l=(1<<d)-1,u=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+u>=1?p/c:p*Math.pow(2,1-u))*c>=2&&(a++,c/=2),a+u>=l?(s=0,a=l):a+u>=1?(s=(t*c-1)*Math.pow(2,i),a+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&s,f+=h,s/=256,i-=8);for(a=a<<i|s,d+=i;d>0;e[r+f]=255&a,f+=h,a/=256,d-=8);e[r+f-h]|=128*m}},{}],42:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},{}],43:[function(e,t,r){var n=t.exports={};function i(){}n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var r=[];return window.addEventListener("message",function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),r.length>0&&r.shift()())},!0),function(e){r.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.on=i,n.addListener=i,n.once=i,n.off=i,n.removeListener=i,n.removeAllListeners=i,n.emit=i,n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],44:[function(e,t,r){"use strict";var n=e("sdp");function i(e,t,r,i,o){var a=n.writeRtpDescription(e.kind,t);if(a+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),a}function o(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),a=n(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(n.name.toLowerCase()===a.name.toLowerCase()&&n.clockRate===a.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&a.parameters.apt&&!i(n,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(n.numChannels,a.numChannels),r.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function a(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function s(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var l=function(r){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},l.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},l.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},l.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},l.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},l.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},l.prototype._gather=function(t,r){var i=this,o=this.transceivers[r].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var d=n.writeCandidate(s);a.candidate=Object.assign(a.candidate,n.parseCandidate(d)),a.candidate.candidate=d,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var l=n.getMediaSections(i._localDescription.sdp);l[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=n.getDescription(i._localDescription.sdp)+l.join("");var u=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),u&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){o.onlocalcandidate(e)})},0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,r,i){var a=o(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},l.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=n.parseRtpParameters(e);i.transceivers[t].localCapabilities=r}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=n.splitSections(i._remoteDescription.sdp),r=t.shift();var s=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],c=a.iceGatherer,d=a.iceTransport,l=a.dtlsTransport,u=a.localCapabilities,p=a.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var f=n.getIceParameters(e,r),h=n.getDtlsParameters(e,r);s&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===d.state&&d.start(c,f,s?"controlling":"controlled"),"new"===l.state&&l.start(h));var m=o(u,p);i._transceive(a,m.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(i){var l=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,l.signalingState)||l._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+l.signalingState));var u={};l.remoteStreams.forEach(function(e){u[e.id]=e});var p=[],f=n.splitSections(i.sdp),h=f.shift(),m=n.matchPrefix(h,"a=ice-lite").length>0,v=n.matchPrefix(h,"a=group:BUNDLE ").length>0;l.usingBundle=v;var g=n.matchPrefix(h,"a=ice-options:")[0];return l.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(a,c){var d=n.splitLines(a),f=n.getKind(a),g=n.isRejected(a)&&0===n.matchPrefix(a,"a=bundle-only").length,y=d[0].substr(2).split(" ")[2],b=n.getDirection(a,h),_=n.parseMsid(a),w=n.getMid(a)||n.generateIdentifier();if(g||"application"===f&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))l.transceivers[c]={mid:w,kind:f,protocol:y,rejected:!0};else{var C,S,T,A,k,R,E,P,I;!g&&l.transceivers[c]&&l.transceivers[c].rejected&&(l.transceivers[c]=l._createTransceiver(f,!0));var x,D,j=n.parseRtpParameters(a);g||(x=n.getIceParameters(a,h),(D=n.getDtlsParameters(a,h)).role="client"),E=n.parseRtpEncodingParameters(a);var O=n.parseRtcpParameters(a),M=n.matchPrefix(a,"a=end-of-candidates",h).length>0,L=n.matchPrefix(a,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!g&&v&&c>0&&l.transceivers[c]&&(l._disposeIceAndDtlsTransports(c),l.transceivers[c].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[c].iceTransport=l.transceivers[0].iceTransport,l.transceivers[c].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[c].rtpSender&&l.transceivers[c].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[c].rtpReceiver&&l.transceivers[c].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),"offer"!==i.type||g){if("answer"===i.type&&!g){S=(C=l.transceivers[c]).iceGatherer,T=C.iceTransport,A=C.dtlsTransport,k=C.rtpReceiver,R=C.sendEncodingParameters,P=C.localCapabilities,l.transceivers[c].recvEncodingParameters=E,l.transceivers[c].remoteCapabilities=j,l.transceivers[c].rtcpParameters=O,L.length&&"new"===T.state&&(!m&&!M||v&&0!==c?L.forEach(function(e){s(C.iceTransport,e)}):T.setRemoteCandidates(L)),v&&0!==c||("new"===T.state&&T.start(S,x,"controlling"),"new"===A.state&&A.start(D)),!o(C.localCapabilities,C.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,l._transceive(C,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!k||"sendrecv"!==b&&"sendonly"!==b?delete C.rtpReceiver:(I=k.track,_?(u[_.stream]||(u[_.stream]=new e.MediaStream),r(I,u[_.stream]),p.push([I,k,u[_.stream]])):(u.default||(u.default=new e.MediaStream),r(I,u.default),p.push([I,k,u.default])))}}else{(C=l.transceivers[c]||l._createTransceiver(f)).mid=w,C.iceGatherer||(C.iceGatherer=l._createIceGatherer(c,v)),L.length&&"new"===C.iceTransport.state&&(!M||v&&0!==c?L.forEach(function(e){s(C.iceTransport,e)}):C.iceTransport.setRemoteCandidates(L)),P=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name})),R=C.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var B,F=!1;if("sendrecv"===b||"sendonly"===b){if(F=!C.rtpReceiver,k=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,f),F)I=k.track,_&&"-"===_.stream||(_?(u[_.stream]||(u[_.stream]=new e.MediaStream,Object.defineProperty(u[_.stream],"id",{get:function(){return _.stream}})),Object.defineProperty(I,"id",{get:function(){return _.track}}),B=u[_.stream]):(u.default||(u.default=new e.MediaStream),B=u.default)),B&&(r(I,B),C.associatedRemoteMediaStreams.push(B)),p.push([I,k,B])}else C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(t){var r,n,i=t.getTracks().find(function(e){return e.id===C.rtpReceiver.track.id});i&&(r=i,(n=t).removeTrack(r),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:r})))}),C.associatedRemoteMediaStreams=[]);C.localCapabilities=P,C.remoteCapabilities=j,C.rtpReceiver=k,C.rtcpParameters=O,C.sendEncodingParameters=R,C.recvEncodingParameters=E,l._transceive(l.transceivers[c],!1,F)}}}),void 0===l._dtlsRole&&(l._dtlsRole="offer"===i.type?"active":"passive"),l._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(u).forEach(function(t){var r=u[t];if(r.getTracks().length){if(-1===l.remoteStreams.indexOf(r)){l.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){l._dispatchEvent("addstream",n)})}p.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&d(l,t,n,[r])})}}),p.forEach(function(e){e[2]||d(l,e[0],e[1],[])}),e.setTimeout(function(){l&&l.transceivers&&l.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},l.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=r.transceivers.filter(function(e){return"audio"===e.kind}).length,a=r.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)});o>0||a>0;)o>0&&(r._createTransceiver("audio"),o--),a>0&&(r._createTransceiver("video"),a--);var d=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(i,o){var a=i.track,s=i.kind,c=i.mid||n.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(o,r.usingBundle));var d=e.RTCRtpSender.getCapabilities(s);t<15019&&(d.codecs=d.codecs.filter(function(e){return"rtx"!==e.name})),d.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),d.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var l=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=d,i.sendEncodingParameters=l}),"max-compat"!==r._config.bundlePolicy&&(d+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){d+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,d+="a="+n.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))});var l=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(l)},l.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var a=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(a+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var s=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,n){if(!(n+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var d=o(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,d,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var d=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(d)},l.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!r._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<r.transceivers.length;d++)if(r.transceivers[d].mid===e.sdpMid){a=d;break}var l=r.transceivers[a];if(!l)return o(c("OperationError","Can not add ICE candidate"));if(l.rejected)return i();var u=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return i();if(u.component&&1!==u.component)return i();if((0===a||a>0&&l.iceTransport!==r.transceivers[0].iceTransport)&&!s(l.iceTransport,u))return o(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[a]+="a="+(u.type?p:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var f=0;f<r.transceivers.length&&(r.transceivers[f].rejected||(r.transceivers[f].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));f++);i()})},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){var n;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[r]).type]||n.type,t.set(r,e[r])}),t})}}});var u=["createOffer","createAnswer"];return u.forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),l}},{sdp:46}],45:[function(e,t,r){var n=e("buffer"),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(o(n,r),r.Buffer=a),a.prototype=Object.create(i.prototype),o(i,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},{buffer:38}],46:[function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},n.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?n.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},n.getCryptoParameters=function(e,t){return n.matchPrefix(e+t,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(e,t){var r=n.matchPrefix(e+t,"a=ice-ufrag:")[0],i=n.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substr(12),password:i.substr(10)}:null},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var o=r[i],a=n.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=n.parseRtpMap(a),c=n.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?n.parseFmtp(c[0]):{},s.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),o&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var l=n.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=l})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},n.parseSctpDescription=function(e){var t,r=n.parseMLine(e),i=n.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=n.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};if(n.matchPrefix(e,"a=sctpmap:").length>0){var a=n.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},n.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var i,o=void 0!==t?t:2;return i=e||n.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}],47:[function(e,t,r){var n=e("safe-buffer").Buffer;function i(e,t){this._block=n.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}i.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=n.from(e,t));for(var r=this._block,i=this._blockSize,o=e.length,a=this._len,s=0;s<o;){for(var c=a%i,d=Math.min(o-s,i-c),l=0;l<d;l++)r[c+l]=e[s+l];s+=d,(a+=d)%i==0&&this._update(r)}return this._len+=o,this},i.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var r=8*this._len;if(r<=4294967295)this._block.writeUInt32BE(r,this._blockSize-4);else{var n=(4294967295&r)>>>0,i=(r-n)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(n,this._blockSize-4)}this._update(this._block);var o=this._hash();return e?o.toString(e):o},i.prototype._update=function(){throw new Error("_update must be implemented by subclass")},t.exports=i},{"safe-buffer":45}],48:[function(e,t,r){(r=t.exports=function(e){e=e.toLowerCase();var t=r[e];if(!t)throw new Error(e+" is not supported (we accept pull requests)");return new t}).sha=e("./sha"),r.sha1=e("./sha1"),r.sha224=e("./sha224"),r.sha256=e("./sha256"),r.sha384=e("./sha384"),r.sha512=e("./sha512")},{"./sha":49,"./sha1":50,"./sha224":51,"./sha256":52,"./sha384":53,"./sha512":54}],49:[function(e,t,r){var n=e("inherits"),i=e("./hash"),o=e("safe-buffer").Buffer,a=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function c(){this.init(),this._w=s,i.call(this,64,56)}function d(e){return e<<30|e>>>2}function l(e,t,r,n){return 0===e?t&r|~t&n:2===e?t&r|t&n|r&n:t^r^n}n(c,i),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,r=this._w,n=0|this._a,i=0|this._b,o=0|this._c,s=0|this._d,c=0|this._e,u=0;u<16;++u)r[u]=e.readInt32BE(4*u);for(;u<80;++u)r[u]=r[u-3]^r[u-8]^r[u-14]^r[u-16];for(var p=0;p<80;++p){var f=~~(p/20),h=0|((t=n)<<5|t>>>27)+l(f,i,o,s)+c+r[p]+a[f];c=s,s=o,o=d(i),i=n,n=h}this._a=n+this._a|0,this._b=i+this._b|0,this._c=o+this._c|0,this._d=s+this._d|0,this._e=c+this._e|0},c.prototype._hash=function(){var e=o.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},t.exports=c},{"./hash":47,inherits:42,"safe-buffer":45}],50:[function(e,t,r){var n=e("inherits"),i=e("./hash"),o=e("safe-buffer").Buffer,a=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function c(){this.init(),this._w=s,i.call(this,64,56)}function d(e){return e<<5|e>>>27}function l(e){return e<<30|e>>>2}function u(e,t,r,n){return 0===e?t&r|~t&n:2===e?t&r|t&n|r&n:t^r^n}n(c,i),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,r=this._w,n=0|this._a,i=0|this._b,o=0|this._c,s=0|this._d,c=0|this._e,p=0;p<16;++p)r[p]=e.readInt32BE(4*p);for(;p<80;++p)r[p]=(t=r[p-3]^r[p-8]^r[p-14]^r[p-16])<<1|t>>>31;for(var f=0;f<80;++f){var h=~~(f/20),m=d(n)+u(h,i,o,s)+c+r[f]+a[h]|0;c=s,s=o,o=l(i),i=n,n=m}this._a=n+this._a|0,this._b=i+this._b|0,this._c=o+this._c|0,this._d=s+this._d|0,this._e=c+this._e|0},c.prototype._hash=function(){var e=o.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},t.exports=c},{"./hash":47,inherits:42,"safe-buffer":45}],51:[function(e,t,r){var n=e("inherits"),i=e("./sha256"),o=e("./hash"),a=e("safe-buffer").Buffer,s=new Array(64);function c(){this.init(),this._w=s,o.call(this,64,56)}n(c,i),c.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},c.prototype._hash=function(){var e=a.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},t.exports=c},{"./hash":47,"./sha256":52,inherits:42,"safe-buffer":45}],52:[function(e,t,r){var n=e("inherits"),i=e("./hash"),o=e("safe-buffer").Buffer,a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=new Array(64);function c(){this.init(),this._w=s,i.call(this,64,56)}function d(e,t,r){return r^e&(t^r)}function l(e,t,r){return e&t|r&(e|t)}function u(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function p(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function f(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}n(c,i),c.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},c.prototype._update=function(e){for(var t,r=this._w,n=0|this._a,i=0|this._b,o=0|this._c,s=0|this._d,c=0|this._e,h=0|this._f,m=0|this._g,v=0|this._h,g=0;g<16;++g)r[g]=e.readInt32BE(4*g);for(;g<64;++g)r[g]=0|(((t=r[g-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+r[g-7]+f(r[g-15])+r[g-16];for(var y=0;y<64;++y){var b=v+p(c)+d(c,h,m)+a[y]+r[y]|0,_=u(n)+l(n,i,o)|0;v=m,m=h,h=c,c=s+b|0,s=o,o=i,i=n,n=b+_|0}this._a=n+this._a|0,this._b=i+this._b|0,this._c=o+this._c|0,this._d=s+this._d|0,this._e=c+this._e|0,this._f=h+this._f|0,this._g=m+this._g|0,this._h=v+this._h|0},c.prototype._hash=function(){var e=o.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},t.exports=c},{"./hash":47,inherits:42,"safe-buffer":45}],53:[function(e,t,r){var n=e("inherits"),i=e("./sha512"),o=e("./hash"),a=e("safe-buffer").Buffer,s=new Array(160);function c(){this.init(),this._w=s,o.call(this,128,112)}n(c,i),c.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},c.prototype._hash=function(){var e=a.allocUnsafe(48);function t(t,r,n){e.writeInt32BE(t,n),e.writeInt32BE(r,n+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},t.exports=c},{"./hash":47,"./sha512":54,inherits:42,"safe-buffer":45}],54:[function(e,t,r){var n=e("inherits"),i=e("./hash"),o=e("safe-buffer").Buffer,a=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],s=new Array(160);function c(){this.init(),this._w=s,i.call(this,128,112)}function d(e,t,r){return r^e&(t^r)}function l(e,t,r){return e&t|r&(e|t)}function u(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function p(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function f(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function h(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function m(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function v(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function g(e,t){return e>>>0<t>>>0?1:0}n(c,i),c.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},c.prototype._update=function(e){for(var t=this._w,r=0|this._ah,n=0|this._bh,i=0|this._ch,o=0|this._dh,s=0|this._eh,c=0|this._fh,y=0|this._gh,b=0|this._hh,_=0|this._al,w=0|this._bl,C=0|this._cl,S=0|this._dl,T=0|this._el,A=0|this._fl,k=0|this._gl,R=0|this._hl,E=0;E<32;E+=2)t[E]=e.readInt32BE(4*E),t[E+1]=e.readInt32BE(4*E+4);for(;E<160;E+=2){var P=t[E-30],I=t[E-30+1],x=f(P,I),D=h(I,P),j=m(P=t[E-4],I=t[E-4+1]),O=v(I,P),M=t[E-14],L=t[E-14+1],B=t[E-32],F=t[E-32+1],N=D+L|0,V=x+M+g(N,D)|0;V=(V=V+j+g(N=N+O|0,O)|0)+B+g(N=N+F|0,F)|0,t[E]=V,t[E+1]=N}for(var U=0;U<160;U+=2){V=t[U],N=t[U+1];var H=l(r,n,i),G=l(_,w,C),W=u(r,_),q=u(_,r),J=p(s,T),z=p(T,s),$=a[U],Q=a[U+1],X=d(s,c,y),K=d(T,A,k),Y=R+z|0,Z=b+J+g(Y,R)|0;Z=(Z=(Z=Z+X+g(Y=Y+K|0,K)|0)+$+g(Y=Y+Q|0,Q)|0)+V+g(Y=Y+N|0,N)|0;var ee=q+G|0,te=W+H+g(ee,q)|0;b=y,R=k,y=c,k=A,c=s,A=T,s=o+Z+g(T=S+Y|0,S)|0,o=i,S=C,i=n,C=w,n=r,w=_,r=Z+te+g(_=Y+ee|0,Y)|0}this._al=this._al+_|0,this._bl=this._bl+w|0,this._cl=this._cl+C|0,this._dl=this._dl+S|0,this._el=this._el+T|0,this._fl=this._fl+A|0,this._gl=this._gl+k|0,this._hl=this._hl+R|0,this._ah=this._ah+r+g(this._al,_)|0,this._bh=this._bh+n+g(this._bl,w)|0,this._ch=this._ch+i+g(this._cl,C)|0,this._dh=this._dh+o+g(this._dl,S)|0,this._eh=this._eh+s+g(this._el,T)|0,this._fh=this._fh+c+g(this._fl,A)|0,this._gh=this._gh+y+g(this._gl,k)|0,this._hh=this._hh+b+g(this._hl,R)|0},c.prototype._hash=function(){var e=o.allocUnsafe(64);function t(t,r,n){e.writeInt32BE(t,n),e.writeInt32BE(r,n+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},t.exports=c},{"./hash":47,inherits:42,"safe-buffer":45}],55:[function(e,t,r){(function(r){"use strict";var n=e("./adapter_factory.js");t.exports=n({window:r.window})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":56}],56:[function(e,t,r){"use strict";var n=e("./utils");t.exports=function(t,r){var i=t&&t.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in r)hasOwnProperty.call(r,a)&&(o[a]=r[a]);var s=n.log,c=n.detectBrowser(i),d=e("./chrome/chrome_shim")||null,l=e("./edge/edge_shim")||null,u=e("./firefox/firefox_shim")||null,p=e("./safari/safari_shim")||null,f=e("./common_shim")||null,h={browserDetails:c,commonShim:f,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(c.browser){case"chrome":if(!d||!d.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),h;s("adapter.js shimming chrome."),h.browserShim=d,f.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimMediaStream(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimAddTrackRemoveTrack(i),d.shimGetSendersWithDtmf(i),d.shimSenderReceiverGetStats(i),d.fixNegotiationNeeded(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"firefox":if(!u||!u.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),h;s("adapter.js shimming firefox."),h.browserShim=u,f.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimRemoveStream(i),u.shimSenderGetStats(i),u.shimReceiverGetStats(i),u.shimRTCDataChannel(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"edge":if(!l||!l.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),h;s("adapter.js shimming edge."),h.browserShim=l,f.shimCreateObjectURL(i),l.shimGetUserMedia(i),l.shimPeerConnection(i),l.shimReplaceTrack(i),l.shimGetDisplayMedia(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"safari":if(!p||!o.shimSafari)return s("Safari shim is not included in this adapter release."),h;s("adapter.js shimming safari."),h.browserShim=p,f.shimCreateObjectURL(i),p.shimRTCIceServerUrls(i),p.shimCreateOfferLegacy(i),p.shimCallbacksAPI(i),p.shimLocalStreamsAPI(i),p.shimRemoteStreamsAPI(i),p.shimTrackEventTransceiver(i),p.shimGetUserMedia(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;default:s("Unsupported browser!")}return h}},{"./chrome/chrome_shim":57,"./common_shim":59,"./edge/edge_shim":60,"./firefox/firefox_shim":63,"./safari/safari_shim":65,"./utils":66}],57:[function(e,t,r){"use strict";var n=e("../utils.js"),i=n.log;function o(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&function e(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),Object.keys(r).forEach(function(i){i.endsWith("Id")?e(t,t.get(r[i]),n):i.endsWith("Ids")&&r[i].forEach(function(r){e(t,t.get(r),n)})}))}(e,r,i)})}),i}t.exports={shimGetUserMedia:e("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)n.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],i.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,i=arguments[0];return this.getSenders().forEach(function(e){e.track===i&&(t?n=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===i&&(r?n=!0:r=e),e.track===i}),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=t.getSenders();r.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){if(e.RTCPeerConnection){var t=n.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());r._streams[t.id]=n,r._reverseStreams[n.id]=t,t=n}i.apply(r,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var o=n._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);n._streams[r.id]=a,n._reverseStreams[a.id]=r,n.addStream(a)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var n=c(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(t){return c(e,t)})}});var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===r))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");r._streams=r._streams||{},Object.keys(r._streams).forEach(function(n){r._streams[n].getTracks().find(function(t){return e.track===t})&&(t=r._streams[n])}),t&&(1===t.getTracks().length?r.removeStream(r._reverseStreams[t.id]):t.removeTrack(e.track),r.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}},shimPeerConnection:function(e){var t=n.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(t,r){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})),e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof arguments[0]))return r.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return r.apply(this,[function(e){o[1](s(a(e)))},arguments[0]])}return new Promise(function(e,t){r.apply(i,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,i){r.apply(t,[e[0],n,i])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,i){r.apply(e,[n,i,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var o=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(e){n.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},shimGetDisplayMedia:function(e,t){!e.navigator||!e.navigator.mediaDevices||"getDisplayMedia"in e.navigator.mediaDevices||("function"==typeof t?(e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)})},e.navigator.getDisplayMedia=function(t){return n.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(t)}):console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},{"../utils.js":66,"./getusermedia":58}],58:[function(e,t,r){"use strict";var n=e("../utils.js"),i=n.log;t.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var o={};"number"==typeof n.ideal?(o[i("min",r)]=n.ideal,t.optional.push(o),(o={})[i("max",r)]=n.ideal,t.optional.push(o)):(o[i("",r)]=n.ideal,t.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c,d=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||d))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?c=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(c=["front"]),c)return r.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!r&&t.length&&-1!==c.indexOf("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),n(e)});e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),n(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(e,t,n){a(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(s(e))})})};var c=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return a(e,function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else r.mediaDevices.getUserMedia=function(e){return c(e)};void 0===r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":66}],59:[function(e,t,r){"use strict";var n=e("sdp"),i=e("./utils");t.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),i=n.parseCandidate(e.candidate),o=Object.assign(r,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),o=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return o.set(t,e),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){n(e),o.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),c.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=i.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,i,o,a;if(this._sctp=null,o=arguments[0],(a=n.splitSections(o.sdp)).shift(),a.some(function(e){var t=n.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})){var s,c=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),d=(e=c,i=65536,"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i),l=function(e,r){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var o=n.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(i=2147483637),i}(arguments[0],c);s=0===d&&0===l?Number.POSITIVE_INFINITY:0===d||0===l?Math.max(d,l):Math.min(d,l);var u={};Object.defineProperty(u,"maxMessageSize",{get:function(){return s}}),this._sctp=u}return r.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},i.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}}},{"./utils":66,sdp:46}],60:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./filtericeservers"),o=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var a=o(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=i(e.iceServers)),new a(e)},e.RTCPeerConnection.prototype=a.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(e,t){if("getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)){var r=e.navigator.getDisplayMedia;e.navigator.mediaDevices.getDisplayMedia=function(t){return r.call(e.navigator,t)},e.navigator.getDisplayMedia=function(t){return n.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),r.call(e.navigator,t)}}}}},{"../utils":66,"./filtericeservers":61,"./getusermedia":62,"rtcpeerconnection-shim":44}],61:[function(e,t,r){"use strict";var n=e("../utils");t.exports=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"==typeof i;return o&&(i=[i]),i=i.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=o?i[0]:i,!!i.length}})}},{"../utils":66}],62:[function(e,t,r){"use strict";t.exports=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],63:[function(e,t,r){"use strict";var n=e("../utils");t.exports={shimGetUserMedia:e("./getusermedia"),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=n.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(r,n){if(t.version<38&&r&&r.iceServers){for(var i=[],o=0;o<r.iceServers.length;o++){var a=r.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(r.iceServers[o])}r.iceServers=i}return new e.mozRTCPeerConnection(r,n)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){return o.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(r){t.set(r,e[r]),t[r]=e[r]}),t}(e)),t.version<53&&!r)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(r,n)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&-1!==e.getTracks().indexOf(r.track)&&t.removeTrack(r)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,t){!e.navigator||!e.navigator.mediaDevices||"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)},e.navigator.getDisplayMedia=function(t){return n.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(t)})}}},{"../utils":66,"./getusermedia":64}],64:[function(e,t,r){"use strict";var n=e("../utils"),i=n.log;t.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,n,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n=e[r]="object"==typeof e[r]?e[r]:{ideal:e[r]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(r),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[r]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof n.ideal?i[r]={min:n.ideal,max:n.ideal}:i[r]=n.ideal,e.advanced.push(i),delete n.ideal,Object.keys(n).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),i("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,n,function(e){o(a(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(e){return new Promise(function(t,r){s(e,t,r)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var c=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var l=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),u(e)},o&&o.prototype.getSettings){var p=o.prototype.getSettings;o.prototype.getSettings=function(){var e=p.apply(this,arguments);return l(e,"mozAutoGainControl","autoGainControl"),l(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var f=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),l(e,"autoGainControl","mozAutoGainControl"),l(e,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[e])}}}r.getUserMedia=function(e,i,o){if(t.version<44)return s(e,i,o);n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(i,o)}}},{"../utils":66}],65:[function(e,t,r){"use strict";var n=e("../utils");t.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(n){t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?-1===this._localStreams.indexOf(r)&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var r=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=r.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||r.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=r.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||r.addTransceiver("video")}return t.apply(r,arguments)}}}},{"../utils":66}],66:[function(e,t,r){"use strict";var n=!0,i=!0;function o(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}t.exports={extractVersion:o,wrapPeerConnectionEvent:function(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=o(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)r.browser="chrome",r.version=o(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=o(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=o(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}}},{}],67:[function(e,t,r){const n=e("./externals/janus"),i=e("bluebird/js/release/bluebird"),o=e("./lib/echoTest").echoTest,a=e("./lib/sip").sip,s=e("./lib/splitClient").splitClient,c=e("./lib/splitAgent").splitAgent,d=e("./lib/videoRoom").videoRoom,l=e("./lib/videoPlayer").videoPlayer,u=e("./lib/getDevices").getDevices,p=e("./lib/detect").detect,f=e("./lib/videoMail").videoMail,h=e("./lib/videoCall").videoCall;window.VideoRTC||(window.VideoRTC={});const m=()=>window.VideoRTC.connection.status,v=()=>new i((e,t)=>{n.init({debug:window.VideoRTC.server.debugLevel,callback:()=>{n.isWebrtcSupported()?window.VideoRTC.connection.handle=new n({server:window.VideoRTC.server.endPoints,iceServers:window.VideoRTC.server.iceServers,apisecret:window.VideoRTC.server.apiSecret,success:()=>{n.log("Connected to the VideoGateway"),window.VideoRTC.connection.status=!0,e({detect:p,echoTest:o,getDevices:u,sip:a,splitAgent:c,splitClient:s,videoCall:h,videoRoom:d,videoMail:f,videoPlayer:l})},error:e=>{const r=e.replace(/Janus/,"VideoGateway");n.error(r),window.VideoRTC.connection.status=!1,t(r)},destroyed:()=>{n.error("Destroyed Connection"),window.VideoRTC.connection.status=!1,t()}}):t("No WebRTC support...")}})}),g=()=>{window.VideoRTC.connection&&window.VideoRTC.connection.handle&&window.VideoRTC.connection.handle.destroy&&window.VideoRTC.connection.handle.destroy(),window.VideoRTC.connection={status:!1,handle:null}},y=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),b=()=>"Microsoft Internet Explorer"===navigator.appName?"IE":navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&navigator.userAgent.toLowerCase().indexOf("safari")>-1&&"Netscape"===navigator.appName?"chrome":navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"Netscape"===navigator.appName?"firefox":navigator.userAgent.toLowerCase().indexOf("safari")>-1&&!(navigator.userAgent.toLowerCase().indexOf("chrome")>-1)&&"Netscape"==navigator.appName?"safari":"Opera"===navigator.appName?"opera":"chrome",_=()=>{return`[${DetectRTC.isMobileDevice?"mobile":"web"}] ${DetectRTC.browser.name} ${DetectRTC.browser.version}`};t.exports=function(e,t,r,n){return e||t?(r=("all"===r||r instanceof Array)&&r,window.VideoRTC.server={endPoints:e,iceServers:t,debugLevel:r,apiSecret:n},window.VideoRTC.connection={status:!1,handle:null},window.VideoRTC.getBrowser=b,window.VideoRTC.getDeviceInfo=_,window.VideoRTC.isMobile=y,{connect:v,disconnect:g,getBrowser:b,getDeviceInfo:_,isConnected:m,isMobile:y}):null}},{"./externals/janus":68,"./lib/detect":71,"./lib/echoTest":72,"./lib/getDevices":73,"./lib/sip":74,"./lib/splitAgent":75,"./lib/splitClient":76,"./lib/videoCall":77,"./lib/videoMail":78,"./lib/videoPlayer":79,"./lib/videoRoom":80,"bluebird/js/release/bluebird":5}],68:[function(e,t,r){i.sessions={},i.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||i.extension.isInstalled()}return!0};var n={extensionId:"pkilckpboojemoogepfpkgbihkfkikel",isInstalled:function(){return null!==document.querySelector("#ivrpowers-extension-installed")},getScreen:function(e){var t=window.setTimeout(function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)},1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var r=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",r(n)}else r(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))})}};function i(e){if((e=e||{}).success="function"==typeof e.success?e.success:i.noop,e.error="function"==typeof e.error?e.error:i.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:i.noop,!i.initDone)return e.error("Library not initialized"),{};if(!i.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(i.log("Library initialized: "+i.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,r=null,n={},o=null,a=null,s=0,c=e.server;i.isArray(c)?(i.log("Multiple servers provided ("+c.length+"), will use the first that works"),c=null,a=e.server,i.debug(a)):0===c.indexOf("ws")?(t=!0,i.log("Using WebSockets to contact Janus: "+c)):(t=!1,i.log("Using REST API to contact Janus: "+c));var d=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],l=e.iceTransportPolicy,u=e.bundlePolicy,p=!0===e.ipv6,f=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(f=!0===e.withCredentials);var h=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(h=e.max_poll_events),h<1&&(h=1);var m=null;void 0!==e.token&&null!==e.token&&(m=e.token);var v=null;void 0!==e.apisecret&&null!==e.apisecret&&(v=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);var y=6e4;function b(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(y=e.longPollTimeout),isNaN(y)&&(y=6e4);var _=!1,w=null,C={},S=this,T=0,A={};function k(){if(null!=w)if(i.debug("Long poll..."),_){var t=c+"/"+w+"?rid="+(new Date).getTime();h&&(t=t+"&maxev="+h),m&&(t=t+"&token="+encodeURIComponent(m)),v&&(t=t+"&apisecret="+encodeURIComponent(v)),i.httpAPICall(t,{verb:"GET",withCredentials:f,success:R,timeout:y,error:function(t,r){if(i.error(t+":",r),++T>3)return _=!1,void e.error("Lost connection to the server (is it down?)");k()}})}else i.warn("Is the server down? (connected=false)")}function R(e,n){if(T=0,t||void 0===w||null===w||!0===n||k(),t||!i.isArray(e))if("keepalive"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(d=e.sender))return void i.warn("Missing sender...");if(!(u=C[d]))return void i.debug("This handle is not attached to this session");var o=e.candidate;i.debug("Got a trickled candidate on session "+w),i.debug(o);var a=u.webrtcStuff;a.pc&&a.remoteSdp?(i.debug("Adding remote candidate:",o),o&&!0!==o.completed?a.pc.addIceCandidate(o):a.pc.addIceCandidate(i.endOfCandidates)):(i.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),a.candidates||(a.candidates=[]),a.candidates.push(o),i.debug(a.candidates))}else{if("webrtcup"===e.janus)return i.debug("Got a webrtcup event on session "+w),i.debug(e),(d=e.sender)?(u=C[d])?void u.webrtcState(!0):void i.debug("This handle is not attached to this session"):void i.warn("Missing sender...");if("hangup"===e.janus){if(i.debug("Got a hangup event on session "+w),i.debug(e),!(d=e.sender))return void i.warn("Missing sender...");if(!(u=C[d]))return void i.debug("This handle is not attached to this session");u.webrtcState(!1,e.reason),u.hangup()}else if("detached"===e.janus){if(i.debug("Got a detached event on session "+w),i.debug(e),!(d=e.sender))return void i.warn("Missing sender...");if(!(u=C[d]))return;u.detached=!0,u.ondetached(),u.detach()}else if("media"===e.janus){if(i.debug("Got a media event on session "+w),i.debug(e),!(d=e.sender))return void i.warn("Missing sender...");if(!(u=C[d]))return void i.debug("This handle is not attached to this session");u.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(i.debug("Got a slowlink event on session "+w),i.debug(e),!(d=e.sender))return void i.warn("Missing sender...");if(!(u=C[d]))return void i.debug("This handle is not attached to this session");u.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var s,c;if(i.error("Ooops: "+e.error.code+" "+e.error.reason),i.debug(e),s=e.transaction)(c=A[s])&&c(e),delete A[s];return}if("event"===e.janus){var d;if(i.debug("Got a plugin event on session "+w),i.debug(e),!(d=e.sender))return void i.warn("Missing sender...");var l=e.plugindata;if(!l)return void i.warn("Missing plugindata...");i.debug("  -- Event is coming from "+d+" ("+l.plugin+")");var u,p=l.data;if(i.debug(p),!(u=C[d]))return void i.warn("This handle is not attached to this session");var f=e.jsep;f&&(i.debug("Handling SDP as well..."),i.debug(f));var h=u.onmessage;h?(i.debug("Notifying application..."),h(p,f)):i.debug("No provided notification callback")}else{if("timeout"===e.janus)return i.error("Timeout on session "+w),i.debug(e),void(t&&r.close(3504,"Gateway timeout"));i.warn("Unknown message/event  '"+e.janus+"' on session "+w),i.debug(e)}}}else i.debug("Got a success on session "+w),i.debug(e),e.license&&!window.VideoRTC.license&&(window.VideoRTC.license=e.license,window.VideoRTC.license.livechat="true"==window.VideoRTC.license.livechat,window.VideoRTC.license.screensharing="true"==window.VideoRTC.license.screensharing,window.VideoRTC.license.videorecording="true"==window.VideoRTC.license.videorecording),e.unique_ids&&(window.VideoRTC.unique_ids=e.unique_ids),(s=e.transaction)&&((c=A[s])&&c(e),delete A[s]);else i.debug("Got an ack on session "+w),i.debug(e),(s=e.transaction)&&((c=A[s])&&c(e),delete A[s]);else i.vdebug("Got a keepalive on session "+w);else for(var m=0;m<e.length;m++)R(e[m],!0)}function E(){if(c&&t&&_){o=setTimeout(E,g);var e={janus:"keepalive",session_id:w,transaction:i.randomString(12)};m&&(e.token=m),v&&(e.apisecret=v),r.send(JSON.stringify(e))}}function P(d){var l=i.randomString(12),u={janus:"create",transaction:l};if(d.reconnect&&(_=!1,u.janus="claim",u.session_id=w,r&&(r.onopen=null,r.onerror=null,r.onclose=null,o&&(clearTimeout(o),o=null))),m&&(u.token=m),v&&(u.apisecret=v),!c&&i.isArray(a)&&(0===(c=a[s]).indexOf("ws")?(t=!0,i.log("Server #"+(s+1)+": trying WebSockets to contact Janus ("+c+")")):(t=!1,i.log("Server #"+(s+1)+": trying REST API to contact Janus ("+c+")"))),t)for(var p in r=i.newWebSocket(c,"janus-protocol"),n={error:function(){if(i.error("Error connecting to the Janus WebSockets server... "+c),i.isArray(a)&&!d.reconnect)return++s==a.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(c=null,void setTimeout(function(){P(d)},200));d.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){A[l]=function(e){if(i.debug(e),"success"!==e.janus)return i.error("Ooops: "+e.error.code+" "+e.error.reason),void d.error(e.error.reason);o=setTimeout(E,g),_=!0,w=e.session_id?e.session_id:e.data.id,d.reconnect?i.log("Claimed session: "+w):i.log("Created session: "+w),i.sessions[w]=S,d.success()},r.send(JSON.stringify(u))},message:function(e){R(JSON.parse(e.data))},close:function(){c&&_&&(_=!1,e.error("Lost connection to the server (is it down?)"))}})r.addEventListener(p,n[p]);else i.httpAPICall(c,{verb:"POST",withCredentials:f,body:u,success:function(e){if(i.debug(e),"success"!==e.janus)return i.error("Ooops: "+e.error.code+" "+e.error.reason),void d.error(e.error.reason);_=!0,w=e.session_id?e.session_id:e.data.id,d.reconnect?i.log("Claimed session: "+w):i.log("Created session: "+w),i.sessions[w]=S,k(),d.success()},error:function(e,t){if(i.error(e+":",t),i.isArray(a)&&!d.reconnect)return++s==a.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(c=null,void setTimeout(function(){P(d)},200));""===t?d.error(e+": Is the server down?"):d.error(e+": "+t)}})}function I(e,n){if((n=n||{}).success="function"==typeof n.success?n.success:i.noop,n.error="function"==typeof n.error?n.error:i.noop,!_)return i.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var o=C[e];if(!o||!o.webrtcStuff)return i.warn("Invalid handle"),void n.error("Invalid handle");var a=n.message,s=n.jsep,d=i.randomString(12),l={janus:"message",body:a,transaction:d};if(o.token&&(l.token=o.token),v&&(l.apisecret=v),s&&(l.jsep=s),i.debug("Sending message to plugin (handle="+e+"):"),i.debug(l),t)return l.session_id=w,l.handle_id=e,A[d]=function(e){if(i.debug("Message sent!"),i.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return i.warn("Request succeeded, but missing plugindata..."),void n.success();i.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return i.debug(r),void n.success(r)}"ack"===e.janus?n.success():e.error?(i.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(i.error("Unknown error"),n.error("Unknown error"))},void r.send(JSON.stringify(l));i.httpAPICall(c+"/"+w+"/"+e,{verb:"POST",withCredentials:f,body:l,success:function(e){if(i.debug("Message sent!"),i.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return i.warn("Request succeeded, but missing plugindata..."),void n.success();i.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return i.debug(r),void n.success(r)}"ack"===e.janus?n.success():e.error?(i.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(i.error("Unknown error"),n.error("Unknown error"))},error:function(e,t){i.error(e+":",t),n.error(e+": "+t)}})}function x(e,n){if(_){var o=C[e];if(o&&o.webrtcStuff){var a={janus:"trickle",candidate:n,transaction:i.randomString(12)};if(o.token&&(a.token=o.token),v&&(a.apisecret=v),i.vdebug("Sending trickle candidate (handle="+e+"):"),i.vdebug(a),t)return a.session_id=w,a.handle_id=e,void r.send(JSON.stringify(a));i.httpAPICall(c+"/"+w+"/"+e,{verb:"POST",withCredentials:f,body:a,success:function(e){i.vdebug("Candidate sent!"),i.vdebug(e),"ack"===e.janus||i.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){i.error(e+":",t)}})}else i.warn("Invalid handle")}else i.warn("Is the server down? (connected=false)")}function D(e,t,r,n){var o=C[e];if(o&&o.webrtcStuff){var a=o.webrtcStuff,s=function(e){i.log("Received state change on data channel:",e);var t=e.target.label,r=a.dataChannel[t]?a.dataChannel[t].readyState:"null";if(i.log("State change on <"+t+"> data channel: "+r),"open"===r){if(a.dataChannel[t].pending&&a.dataChannel[t].pending.length>0){for(var n of(i.log("Sending pending messages on <"+t+">:",a.dataChannel[t].pending.length),a.dataChannel[t].pending))i.log("Sending data on data channel <"+t+">"),i.debug(n),a.dataChannel[t].send(n);a.dataChannel[t].pending=[]}o.ondataopen(t)}};a.dataChannel[t]=r||a.pc.createDataChannel(t,{ordered:!0}),a.dataChannel[t].onmessage=function(e){i.log("Received message on data channel:",e);var t=e.target.label;o.ondata(e.data,t)},a.dataChannel[t].onopen=s,a.dataChannel[t].onclose=s,a.dataChannel[t].onerror=function(e){i.error("Got error on data channel:",e)},a.dataChannel[t].pending=[],n&&a.dataChannel[t].pending.push(n)}else i.warn("Invalid handle")}function j(e,t){(t=t||{}).success="function"==typeof t.success?t.success:i.noop,t.error="function"==typeof t.error?t.error:i.noop;var r=C[e];if(!r||!r.webrtcStuff)return i.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff,o=t.text||t.data;if(!o)return i.warn("Invalid data"),void t.error("Invalid data");var a=t.label?t.label:i.dataChanDefaultLabel;return n.dataChannel[a]?"open"!==n.dataChannel[a].readyState?(n.dataChannel[a].pending.push(o),void t.success()):(i.log("Sending data on data channel <"+a+">"),i.debug(o),n.dataChannel[a].send(o),void t.success()):(D(e,a,!1,o),void t.success())}function O(e,t){(t=t||{}).success="function"==typeof t.success?t.success:i.noop,t.error="function"==typeof t.error?t.error:i.noop;var r=C[e];if(!r||!r.webrtcStuff)return i.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff;if(!n.dtmfSender){if(n.pc){var o=n.pc.getSenders().find(function(e){return e.track&&"audio"===e.track.kind});if(!o)return i.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");n.dtmfSender=o.dtmf,n.dtmfSender&&(i.log("Created DTMF Sender"),n.dtmfSender.ontonechange=function(e){i.debug("Sent DTMF tone: "+e.tone)})}if(!n.dtmfSender)return i.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var a=t.dtmf;if(!a)return i.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var s=a.tones;if(!s)return i.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var c="number"==typeof a.duration?a.duration:500,d="number"==typeof a.gap?a.gap:50;i.debug("Sending DTMF string "+s+" (duration "+c+"ms, gap "+d+"ms)"),n.dtmfSender.insertDTMF(s,c,d),t.success()}function M(e,n){(n=n||{}).success="function"==typeof n.success?n.success:i.noop,n.error="function"==typeof n.error?n.error:i.noop;var o=!0===n.noRequest;i.log("Destroying handle "+e+" (only-locally="+o+")"),W(e);var a=C[e];if(!a||a.detached)return delete C[e],void n.success();if(o)return delete C[e],void n.success();if(!_)return i.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var s={janus:"detach",transaction:i.randomString(12)};if(a.token&&(s.token=a.token),v&&(s.apisecret=v),t)return s.session_id=w,s.handle_id=e,r.send(JSON.stringify(s)),delete C[e],void n.success();i.httpAPICall(c+"/"+w+"/"+e,{verb:"POST",withCredentials:f,body:s,success:function(t){i.log("Destroyed handle:"),i.debug(t),"success"!==t.janus&&i.error("Ooops: "+t.error.code+" "+t.error.reason),delete C[e],n.success()},error:function(t,r){i.error(t+":",r),delete C[e],n.success()}})}function L(e,t,r,n,o){var a=C[e];if(!a||!a.webrtcStuff)return i.warn("Invalid handle"),void n.error("Invalid handle");var s=a.webrtcStuff;i.debug("streamsDone:",o),o&&(i.debug("  -- Audio tracks:",o.getAudioTracks()),i.debug("  -- Video tracks:",o.getVideoTracks()));var c=!1;if(s.myStream&&r.update&&!s.streamExternal){if((!r.update&&q(r)||r.update&&(r.addAudio||r.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(s.myStream.addTrack(o.getAudioTracks()[0]),i.unifiedPlan){i.log((r.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var f=null;if((m=s.pc.getTransceivers())&&m.length>0)for(var h of m)if(h.sender&&h.sender.track&&"audio"===h.sender.track.kind||h.receiver&&h.receiver.track&&"audio"===h.receiver.track.kind){f=h;break}f&&f.sender?f.sender.replaceTrack(o.getAudioTracks()[0]):s.pc.addTrack(o.getAudioTracks()[0],o)}else i.log((r.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),s.pc.addTrack(o.getAudioTracks()[0],o);if((!r.update&&z(r)||r.update&&(r.addVideo||r.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(s.myStream.addTrack(o.getVideoTracks()[0]),i.unifiedPlan){i.log((r.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var m,v=null;if((m=s.pc.getTransceivers())&&m.length>0)for(var h of m)if(h.sender&&h.sender.track&&"video"===h.sender.track.kind||h.receiver&&h.receiver.track&&"video"===h.receiver.track.kind){v=h;break}v&&v.sender?v.sender.replaceTrack(o.getVideoTracks()[0]):s.pc.addTrack(o.getVideoTracks()[0],o)}else i.log((r.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),s.pc.addTrack(o.getVideoTracks()[0],o)}else s.myStream=o,c=!0;if(!s.pc){var g={iceServers:d,iceTransportPolicy:l,bundlePolicy:u};"chrome"===i.webRTCAdapter.browserDetails.browser&&(g.sdpSemantics=i.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var y={optional:[{DtlsSrtpKeyAgreement:!0}]};if(p&&y.optional.push({googIPv6:!0}),n.rtcConstraints&&"object"==typeof n.rtcConstraints)for(var _ in i.debug("Adding custom PeerConnection constraints:",n.rtcConstraints),n.rtcConstraints)y.optional.push(n.rtcConstraints[_]);"edge"===i.webRTCAdapter.browserDetails.browser&&(g.bundlePolicy="max-bundle"),i.log("Creating PeerConnection"),i.debug(y),s.pc=new RTCPeerConnection(g,y),i.debug(s.pc),s.pc.getStats&&(s.volume={},s.bitrate.value="0 kbits/sec"),i.log("Preparing local SDP and gathering candidates (trickle="+s.trickle+")"),s.pc.oniceconnectionstatechange=function(e){s.pc&&a.iceState(s.pc.iceConnectionState)},s.pc.onicecandidate=function(t){if(!t.candidate||"edge"===i.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)i.log("End of candidates."),s.iceDone=!0,!0===s.trickle?x(e,{completed:!0}):function(e,t){(t=t||{}).success="function"==typeof t.success?t.success:i.noop,t.error="function"==typeof t.error?t.error:i.noop;var r=C[e];if(!r||!r.webrtcStuff)return void i.warn("Invalid handle, not sending anything");var n=r.webrtcStuff;if(i.log("Sending offer/answer SDP..."),!n.mySdp)return void i.warn("Local SDP instance is invalid, not sending anything...");n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},!1===n.trickle&&(n.mySdp.trickle=!1);i.debug(t),n.sdpSent=!0,t.success(n.mySdp)}(e,n);else{var r={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===s.trickle&&x(e,r)}},s.pc.ontrack=function(e){if(i.log("Handling Remote Track"),i.debug(e),e.streams&&(s.remoteStream=e.streams[0],a.onremotestream(s.remoteStream),!e.track.onended)){var t=null;i.log("Adding onended callback to track:",e.track),e.track.onended=function(e){i.log("Remote track removed:",e),s.remoteStream&&(clearTimeout(t),s.remoteStream.removeTrack(e.target),a.onremotestream(s.remoteStream))},e.track.onmute=function(e){i.log("Remote track muted:",e),s.remoteStream&&null==t&&(t=setTimeout(function(){i.log("Removing remote track"),s.remoteStream.removeTrack(e.target),a.onremotestream(s.remoteStream),t=null},4200))},e.track.onunmute=function(e){if(i.log("Remote track flowing again:",e),null!=t)clearTimeout(t),t=null;else try{s.remoteStream.addTrack(e.target),a.onremotestream(s.remoteStream)}catch(e){i.error(e)}}}}}if(c&&o){i.log("Adding local stream");var w=!0===n.simulcast2;o.getTracks().forEach(function(e){if(i.log("Adding local track:",e),w)if("audio"===e.kind)s.pc.addTrack(e,o);else{i.log("Enabling rid-based simulcasting:",e);const t=b(n.simulcastMaxBitrates);s.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:[{rid:"h",active:!0,maxBitrate:t.high},{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:t.low,scaleResolutionDownBy:4}]})}else s.pc.addTrack(e,o)})}(function(e){if(i.debug("isDataEnabled:",e),"edge"===i.webRTCAdapter.browserDetails.browser)return i.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(r)&&!s.dataChannel[i.dataChanDefaultLabel]&&(i.log("Creating data channel"),D(e,i.dataChanDefaultLabel,!1),s.pc.ondatachannel=function(t){i.log("Data channel created by Janus:",t),D(e,t.channel.label,t.channel)}),s.myStream&&a.onlocalstream(s.myStream),t?s.pc.setRemoteDescription(t).then(function(){if(i.log("Remote description accepted!"),s.remoteSdp=t.sdp,s.candidates&&s.candidates.length>0){for(var o=0;o<s.candidates.length;o++){var a=s.candidates[o];i.debug("Adding remote candidate:",a),a&&!0!==a.completed?s.pc.addIceCandidate(a):s.pc.addIceCandidate(i.endOfCandidates)}s.candidates=[]}!function(e,t,r){(r=r||{}).success="function"==typeof r.success?r.success:i.noop,r.error="function"==typeof r.error?r.error:i.noop,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:i.noop;var n=C[e];if(!n||!n.webrtcStuff)return i.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff,a=!0===r.simulcast;a?i.log("Creating answer (iceDone="+o.iceDone+", simulcast="+a+")"):i.log("Creating answer (iceDone="+o.iceDone+")");var s=null;if(i.unifiedPlan){s={};var c=null,d=null,l=o.pc.getTransceivers();if(l&&l.length>0)for(var u of l)u.sender&&u.sender.track&&"audio"===u.sender.track.kind||u.receiver&&u.receiver.track&&"audio"===u.receiver.track.kind?c||(c=u):(u.sender&&u.sender.track&&"video"===u.sender.track.kind||u.receiver&&u.receiver.track&&"video"===u.receiver.track.kind)&&(d||(d=u));var p=q(t),f=J(t);if(p||f){if(p&&f){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",i.log("Setting audio transceiver to sendrecv:",c)}catch(e){i.error(e)}}else if(p&&!f)try{c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",i.log("Setting audio transceiver to sendonly:",c))}catch(e){i.error(e)}else if(!p&&f)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",i.log("Setting audio transceiver to recvonly:",c)}catch(e){i.error(e)}else c=o.pc.addTransceiver("audio",{direction:"recvonly"}),i.log("Adding recvonly audio transceiver:",c)}else if(t.removeAudio&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",i.log("Setting audio transceiver to inactive:",c)}catch(e){i.error(e)}var h=z(t),m=$(t);if(h||m){if(h&&m){if(d)try{d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",i.log("Setting video transceiver to sendrecv:",d)}catch(e){i.error(e)}}else if(h&&!m){if(d)try{d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",i.log("Setting video transceiver to sendonly:",d)}catch(e){i.error(e)}}else if(!h&&m)if(d)try{d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",i.log("Setting video transceiver to recvonly:",d)}catch(e){i.error(e)}else d=o.pc.addTransceiver("video",{direction:"recvonly"}),i.log("Adding recvonly video transceiver:",d)}else if(t.removeVideo&&d)try{d.setDirection?d.setDirection("inactive"):d.direction="inactive",i.log("Setting video transceiver to inactive:",d)}catch(e){i.error(e)}}else s="firefox"===i.webRTCAdapter.browserDetails.browser||"edge"===i.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:J(t),offerToReceiveVideo:$(t)}:{mandatory:{OfferToReceiveAudio:J(t),OfferToReceiveVideo:$(t)}};i.debug(s);var v=z(t);if(v&&a&&"firefox"===i.webRTCAdapter.browserDetails.browser){i.log("Enabling Simulcasting for Firefox (RID)");var g=o.pc.getSenders()[1];i.log(g);var y=g.getParameters();i.log(y);const e=b(r.simulcastMaxBitrates);g.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:e.high},{rid:"medium",active:!0,priority:"medium",maxBitrate:e.medium},{rid:"low",active:!0,priority:"low",maxBitrate:e.low}]})}o.pc.createAnswer(s).then(function(e){i.debug(e);var t={type:e.type,sdp:e.sdp};r.customizeSdp(t),e.sdp=t.sdp,i.log("Setting local description"),v&&a&&("chrome"===i.webRTCAdapter.browserDetails.browser?i.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==i.webRTCAdapter.browserDetails.browser&&i.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(r.error),o.mediaConstraints=s,o.iceDone||o.trickle?r.success(e):i.log("Waiting for all candidates...")},r.error)}(e,r,n)},n.error):function(e,t,r){(r=r||{}).success="function"==typeof r.success?r.success:i.noop,r.error="function"==typeof r.error?r.error:i.noop,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:i.noop;var n=C[e];if(!n||!n.webrtcStuff)return i.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff,a=!0===r.simulcast;a?i.log("Creating offer (iceDone="+o.iceDone+", simulcast="+a+")"):i.log("Creating offer (iceDone="+o.iceDone+")");var s={};if(i.unifiedPlan){var c=null,d=null,l=o.pc.getTransceivers();if(l&&l.length>0)for(var u of l)u.sender&&u.sender.track&&"audio"===u.sender.track.kind||u.receiver&&u.receiver.track&&"audio"===u.receiver.track.kind?c||(c=u):(u.sender&&u.sender.track&&"video"===u.sender.track.kind||u.receiver&&u.receiver.track&&"video"===u.receiver.track.kind)&&(d||(d=u));var p=q(t),f=J(t);p||f?p&&f?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",i.log("Setting audio transceiver to sendrecv:",c)):p&&!f?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",i.log("Setting audio transceiver to sendonly:",c)):!p&&f&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",i.log("Setting audio transceiver to recvonly:",c)):(c=o.pc.addTransceiver("audio",{direction:"recvonly"}),i.log("Adding recvonly audio transceiver:",c))):t.removeAudio&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",i.log("Setting audio transceiver to inactive:",c));var h=z(t),m=$(t);h||m?h&&m?d&&(d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",i.log("Setting video transceiver to sendrecv:",d)):h&&!m?d&&(d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",i.log("Setting video transceiver to sendonly:",d)):!h&&m&&(d?(d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",i.log("Setting video transceiver to recvonly:",d)):(d=o.pc.addTransceiver("video",{direction:"recvonly"}),i.log("Adding recvonly video transceiver:",d))):t.removeVideo&&d&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive",i.log("Setting video transceiver to inactive:",d))}else s.offerToReceiveAudio=J(t),s.offerToReceiveVideo=$(t);!0===r.iceRestart&&(s.iceRestart=!0);i.debug(s);var v=z(t);if(v&&a&&"firefox"===i.webRTCAdapter.browserDetails.browser){i.log("Enabling Simulcasting for Firefox (RID)");var g=o.pc.getSenders().find(function(e){return"video"==e.track.kind});if(g){var y=g.getParameters();y||(y={});const e=b(r.simulcastMaxBitrates);y.encodings=[{rid:"h",active:!0,maxBitrate:e.high},{rid:"m",active:!0,maxBitrate:e.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:e.low,scaleResolutionDownBy:4}],g.setParameters(y)}}o.pc.createOffer(s).then(function(e){i.debug(e);var t={type:e.type,sdp:e.sdp};r.customizeSdp(t),e.sdp=t.sdp,i.log("Setting local description"),v&&a&&("chrome"===i.webRTCAdapter.browserDetails.browser||"safari"===i.webRTCAdapter.browserDetails.browser?(i.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var t=e.split("\r\n"),r=!1,n=[-1],o=[-1],a=null,s=null,c=null,d=null,l=-1,u=0;u<t.length;u++){var p=t[u].match(/m=(\w+) */);if(p){var f=p[1];if("video"===f){if(!(n[0]<0)){l=u;break}r=!0}else if(n[0]>-1){l=u;break}}else if(r){var h=t[u].match(/a=ssrc-group:FID (\d+) (\d+)/);if(h)n[0]=h[1],o[0]=h[2],t.splice(u,1),u--;else{if(n[0]){var m=t[u].match("a=ssrc:"+n[0]+" cname:(.+)");if(m&&(a=m[1]),(m=t[u].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(s=m[1]),(m=t[u].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(c=m[1]),(m=t[u].match("a=ssrc:"+n[0]+" label:(.+)"))&&(d=m[1]),0===t[u].indexOf("a=ssrc:"+o[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+n[0])){t.splice(u,1),u--;continue}}0!=t[u].length||(t.splice(u,1),u--)}}}if(n[0]<0){l=-1,r=!1;for(var u=0;u<t.length;u++){var p=t[u].match(/m=(\w+) */);if(p){var f=p[1];if("video"===f){if(!(n[0]<0)){l=u;break}r=!0}else if(n[0]>-1){l=u;break}}else if(r){if(n[0]<0){var v=t[u].match(/a=ssrc:(\d+)/);if(v){n[0]=v[1],t.splice(u,1),u--;continue}}else{var m=t[u].match("a=ssrc:"+n[0]+" cname:(.+)");if(m&&(a=m[1]),(m=t[u].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(s=m[1]),(m=t[u].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(c=m[1]),(m=t[u].match("a=ssrc:"+n[0]+" label:(.+)"))&&(d=m[1]),0===t[u].indexOf("a=ssrc:"+o[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+n[0])){t.splice(u,1),u--;continue}}0!=t[u].length||(t.splice(u,1),u--)}}}if(n[0]<0)return i.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;l<0&&(l=t.length);n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(var u=0;u<n.length;u++)a&&(t.splice(l,0,"a=ssrc:"+n[u]+" cname:"+a),l++),s&&(t.splice(l,0,"a=ssrc:"+n[u]+" msid:"+s),l++),c&&(t.splice(l,0,"a=ssrc:"+n[u]+" mslabel:"+c),l++),d&&(t.splice(l,0,"a=ssrc:"+n[u]+" label:"+d),l++),a&&(t.splice(l,0,"a=ssrc:"+o[u]+" cname:"+a),l++),s&&(t.splice(l,0,"a=ssrc:"+o[u]+" msid:"+s),l++),c&&(t.splice(l,0,"a=ssrc:"+o[u]+" mslabel:"+c),l++),d&&(t.splice(l,0,"a=ssrc:"+o[u]+" label:"+d),l++);t.splice(l,0,"a=ssrc-group:FID "+n[2]+" "+o[2]),t.splice(l,0,"a=ssrc-group:FID "+n[1]+" "+o[1]),t.splice(l,0,"a=ssrc-group:FID "+n[0]+" "+o[0]),t.splice(l,0,"a=ssrc-group:SIM "+n[0]+" "+n[1]+" "+n[2]),(e=t.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==i.webRTCAdapter.browserDetails.browser&&i.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(r.error),o.mediaConstraints=s,o.iceDone||o.trickle?(i.log("Offer ready"),i.debug(r),r.success(e)):i.log("Waiting for all candidates...")},r.error)}(e,r,n)}function B(e,t,r){(r=r||{}).success="function"==typeof r.success?r.success:i.noop,r.error="function"==typeof r.error?r.error:G;var n=r.jsep;if(t&&n)return i.error("Provided a JSEP to a createOffer"),void r.error("Provided a JSEP to a createOffer");if(!(t||n&&n.type&&n.sdp))return i.error("A valid JSEP is required for createAnswer"),void r.error("A valid JSEP is required for createAnswer");r.media="object"==typeof r.media&&r.media?r.media:{audio:!0,video:!0};var o=r.media,a=C[e];if(!a||!a.webrtcStuff)return i.warn("Invalid handle"),void r.error("Invalid handle");var s,c=a.webrtcStuff;if(c.trickle=(s=r.trickle,i.debug("isTrickleEnabled:",s),!1!==s),c.pc){if(i.log("Updating existing media session"),o.update=!0,r.stream)r.stream!==c.myStream&&i.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,c.myStream&&c.myStream.getAudioTracks()&&c.myStream.getAudioTracks().length)return i.error("Can't add audio stream, there already is one"),void r.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(c.myStream?c.myStream.getAudioTracks()&&0!==c.myStream.getAudioTracks().length?!q(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0):(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),q(o)&&(o.keepVideo=!1,o.addAudio=!0)):(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),q(o)&&(o.keepAudio=!1,o.addAudio=!0)),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,c.myStream&&c.myStream.getVideoTracks()&&c.myStream.getVideoTracks().length)return i.error("Can't add video stream, there already is one"),void r.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);c.myStream&&c.myStream.getVideoTracks()&&0!==c.myStream.getVideoTracks().length?!z(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0):(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),z(o)&&(o.keepVideo=!1,o.addVideo=!0)),o.addData&&(o.data=!0)}if(q(o)&&o.keepAudio&&z(o)&&o.keepVideo)return a.consentDialog(!1),void L(e,n,o,r,c.myStream)}else o.update=!1,o.keepAudio=!1,o.keepVideo=!1;if(o.update&&!c.streamExternal){if(o.removeAudio||o.replaceAudio){if(c.myStream&&c.myStream.getAudioTracks()&&c.myStream.getAudioTracks().length){var d=c.myStream.getAudioTracks()[0];i.log("Removing audio track:",d),c.myStream.removeTrack(d);try{d.stop()}catch(e){}}if(c.pc.getSenders()&&c.pc.getSenders().length){var l=!0;if(o.replaceAudio&&i.unifiedPlan&&(l=!1),l)for(var d of c.pc.getSenders())d&&d.track&&"audio"===d.track.kind&&(i.log("Removing audio sender:",d),c.pc.removeTrack(d))}}if(o.removeVideo||o.replaceVideo){if(c.myStream&&c.myStream.getVideoTracks()&&c.myStream.getVideoTracks().length){d=c.myStream.getVideoTracks()[0];i.log("Removing video track:",d),c.myStream.removeTrack(d);try{d.stop()}catch(e){}}if(c.pc.getSenders()&&c.pc.getSenders().length){var u=!0;if(o.replaceVideo&&i.unifiedPlan&&(u=!1),u)for(var d of c.pc.getSenders())d&&d.track&&"video"===d.track.kind&&(i.log("Removing video sender:",d),c.pc.removeTrack(d))}}}if(r.stream){var p=r.stream;if(i.log("MediaStream provided by the application"),i.debug(p),o.update&&c.myStream&&c.myStream!==r.stream&&!c.streamExternal){try{var f=c.myStream.getTracks();for(var h of f)i.log(h),h&&h.stop()}catch(e){}c.myStream=null}return c.streamExternal=!0,a.consentDialog(!1),void L(e,n,o,r,p)}if(q(o)||z(o)){if(!i.isGetUserMediaAvailable())return void r.error("getUserMedia not available");var m={mandatory:{},optional:[]};a.consentDialog(!0);var v=q(o);v&&o&&"object"==typeof o.audio&&(v=o.audio);var g=z(o);if(g&&o){var y=!0===r.simulcast,b=!0===r.simulcast2;if(!y&&!b||n||o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"==typeof o.video)g=o.video;else{var _=0,w=0;"lowres"===o.video?(w=240,240,_=320):"lowres-16:9"===o.video?(w=180,180,_=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(w=720,720,_=1280):"fhdres"===o.video?(w=1080,1080,_=1920):"4kres"===o.video?(w=2160,2160,_=3840):"stdres"===o.video?(w=480,480,_=640):"stdres-16:9"===o.video?(w=360,360,_=640):(i.log("Default video setting is stdres 4:3"),w=480,480,_=640),i.log("Adding media constraint:",o.video),g={height:{ideal:w},width:{ideal:_}},i.log("Adding video constraint:",g)}else if("screen"===o.video||"window"===o.video){if(o.screenshareFrameRate||(o.screenshareFrameRate=3),navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return void navigator.mediaDevices.getDisplayMedia({video:!0,audio:o.captureDesktopAudio}).then(function(t){a.consentDialog(!1),q(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(i){t.addTrack(i.getAudioTracks()[0]),L(e,n,o,r,t)}):L(e,n,o,r,t)},function(e){a.consentDialog(!1),r.error(e)});function S(t,i){a.consentDialog(!1),t?r.error(t):L(e,n,o,r,i)}function T(e,t,r){i.log("Adding media constraint (screen capture)"),i.debug(e),navigator.mediaDevices.getUserMedia(e).then(function(e){r?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(r){e.addTrack(r.getAudioTracks()[0]),t(null,e)}):t(null,e)}).catch(function(e){a.consentDialog(!1),t(e)})}if("chrome"===i.webRTCAdapter.browserDetails.browser){var A=i.webRTCAdapter.browserDetails.version,k=33;window.navigator.userAgent.match("Linux")&&(k=35),A>=26&&A<=k?T(m={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:q(o)&&!o.keepAudio},S):i.extension.getScreen(function(e,t){if(e)return a.consentDialog(!1),r.error(e);(m={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,T(m,S,q(o)&&!o.keepAudio)})}else if("firefox"===i.webRTCAdapter.browserDetails.browser){if(!(i.webRTCAdapter.browserDetails.version>=33)){var R=new Error("NavigatorUserMediaError");return R.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",a.consentDialog(!1),void r.error(R)}T(m={video:{mozMediaSource:o.video,mediaSource:o.video},audio:q(o)&&!o.keepAudio},function(e,t){if(S(e,t),!e)var r=t.currentTime,n=window.setInterval(function(){t||window.clearInterval(n),t.currentTime==r&&(window.clearInterval(n),t.onended&&t.onended()),r=t.currentTime},500)})}return}}o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then(function(t){var s=t.some(function(e){return"audioinput"===e.kind}),c=function(e){if(i.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!=typeof e.video||"object"!=typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(o)||t.some(function(e){return"videoinput"===e.kind}),d=q(o),l=z(o),u=function(e){return i.debug("isAudioSendRequired:",e),!!e&&!1!==e.audio&&!1!==e.audioSend&&void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio}(o),f=function(e){return i.debug("isVideoSendRequired:",e),!!e&&!1!==e.video&&!1!==e.videoSend&&void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo}(o);if(d||l||u||f){var h=!!d&&s,m=!!l&&c;if(!h&&!m)return a.consentDialog(!1),r.error("No capture device found"),!1;if(!h&&u)return a.consentDialog(!1),r.error("Audio capture is required, but no capture device found"),!1;if(!m&&f)return a.consentDialog(!1),r.error("Video capture is required, but no capture device found"),!1}var y={audio:!(!s||o.keepAudio)&&v,video:!(!c||o.keepVideo)&&g};i.debug("getUserMedia constraints",y),y.audio||y.video?navigator.mediaDevices.getUserMedia(y).then(function(t){a.consentDialog(!1),L(e,n,o,r,t)}).catch(function(e){a.consentDialog(!1),r.error({code:e.code,name:e.name,message:e.message})}):(a.consentDialog(!1),L(e,n,o,r,p))}).catch(function(e){a.consentDialog(!1),r.error("enumerateDevices error",e)})}else L(e,n,o,r)}function F(e,t){(t=t||{}).success="function"==typeof t.success?t.success:i.noop,t.error="function"==typeof t.error?t.error:G;var r=t.jsep,n=C[e];if(!n||!n.webrtcStuff)return i.warn("Invalid handle"),void t.error("Invalid handle");var o=n.webrtcStuff;if(r){if(!o.pc)return i.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");o.pc.setRemoteDescription(r).then(function(){if(i.log("Remote description accepted!"),o.remoteSdp=r.sdp,o.candidates&&o.candidates.length>0){for(var e=0;e<o.candidates.length;e++){var n=o.candidates[e];i.debug("Adding remote candidate:",n),n&&!0!==n.completed?o.pc.addIceCandidate(n):o.pc.addIceCandidate(i.endOfCandidates)}o.candidates=[]}t.success()},t.error)}else t.error("Invalid JSEP")}function N(e,t){var r=C[e];if(!r||!r.webrtcStuff)return i.warn("Invalid handle"),0;var n=t?"remote":"local",o=r.webrtcStuff;return o.volume[n]||(o.volume[n]={value:0}),!o.pc.getStats||"chrome"!==i.webRTCAdapter.browserDetails.browser&&"safari"!==i.webRTCAdapter.browserDetails.browser?(i.warn("Getting the "+n+" volume unsupported by browser"),0):t&&!o.remoteStream?(i.warn("Remote stream unavailable"),0):t||o.myStream?o.volume[n].timer?o.volume[n].value:(i.log("Starting "+n+" volume monitor"),o.volume[n].timer=setInterval(function(){o.pc.getStats().then(function(e){e.forEach(function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(o.volume[n].value=e.audioLevel?e.audioLevel:0))})})},200),0):(i.warn("Local stream unavailable"),0)}function V(e,t){var r=C[e];if(!r||!r.webrtcStuff)return i.warn("Invalid handle"),!0;var n=r.webrtcStuff;return n.pc?n.myStream?t?n.myStream.getVideoTracks()&&0!==n.myStream.getVideoTracks().length?!n.myStream.getVideoTracks()[0].enabled:(i.warn("No video track"),!0):n.myStream.getAudioTracks()&&0!==n.myStream.getAudioTracks().length?!n.myStream.getAudioTracks()[0].enabled:(i.warn("No audio track"),!0):(i.warn("Invalid local MediaStream"),!0):(i.warn("Invalid PeerConnection"),!0)}function U(e,t,r){var n=C[e];if(!n||!n.webrtcStuff)return i.warn("Invalid handle"),!1;var o=n.webrtcStuff;return o.pc?o.myStream?t?o.myStream.getVideoTracks()&&0!==o.myStream.getVideoTracks().length?(o.myStream.getVideoTracks()[0].enabled=!r,!0):(i.warn("No video track"),!1):o.myStream.getAudioTracks()&&0!==o.myStream.getAudioTracks().length?(o.myStream.getAudioTracks()[0].enabled=!r,!0):(i.warn("No audio track"),!1):(i.warn("Invalid local MediaStream"),!1):(i.warn("Invalid PeerConnection"),!1)}function H(e){var t=C[e];if(!t||!t.webrtcStuff)return i.warn("Invalid handle"),"Invalid handle";var r=t.webrtcStuff;return r.pc?r.pc.getStats?r.bitrate.timer?r.bitrate.value:(i.log("Starting bitrate timer (via getStats)"),r.bitrate.timer=setInterval(function(){r.pc.getStats().then(function(e){e.forEach(function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(r.bitrate.bsnow=e.bytesReceived,r.bitrate.tsnow=e.timestamp,null===r.bitrate.bsbefore||null===r.bitrate.tsbefore)r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow;else{var n=r.bitrate.tsnow-r.bitrate.tsbefore;"safari"===i.webRTCAdapter.browserDetails.browser&&(n/=1e3);var o=Math.round(8*(r.bitrate.bsnow-r.bitrate.bsbefore)/n);"safari"===i.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),r.bitrate.value=o+" kbits/sec",r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):(i.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function G(e){i.error("WebRTC error:",e)}function W(e,n){i.log("Cleaning WebRTC stuff");var o=C[e];if(o){var a=o.webrtcStuff;if(a){if(!0===n){var s={janus:"hangup",transaction:i.randomString(12)};o.token&&(s.token=o.token),v&&(s.apisecret=v),i.debug("Sending hangup request (handle="+e+"):"),i.debug(s),t?(s.session_id=w,s.handle_id=e,r.send(JSON.stringify(s))):i.httpAPICall(c+"/"+w+"/"+e,{verb:"POST",withCredentials:f,body:s})}a.remoteStream=null,a.volume&&(a.volume.local&&a.volume.local.timer&&clearInterval(a.volume.local.timer),a.volume.remote&&a.volume.remote.timer&&clearInterval(a.volume.remote.timer)),a.volume={},a.bitrate.timer&&clearInterval(a.bitrate.timer),a.bitrate.timer=null,a.bitrate.bsnow=null,a.bitrate.bsbefore=null,a.bitrate.tsnow=null,a.bitrate.tsbefore=null,a.bitrate.value=null;try{if(!a.streamExternal&&a.myStream){i.log("Stopping local stream tracks");var d=a.myStream.getTracks();for(var l of d)i.log(l),l&&l.stop()}}catch(e){}a.streamExternal=!1,a.myStream=null;try{a.pc.close()}catch(e){}a.pc=null,a.candidates=null,a.mySdp=null,a.remoteSdp=null,a.iceDone=!1,a.dataChannel={},a.dtmfSender=null}o.oncleanup()}}function q(e){return i.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function J(e){return i.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function z(e){return i.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function $(e){return i.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}P(e),this.getServer=function(){return c},this.isConnected=function(){return _},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:i.noop,e.error="function"==typeof e.error?e.error:i.noop,e.reconnect=!0,P(e)},this.getSessionId=function(){return w},this.destroy=function(a){!function(a){(a=a||{}).success="function"==typeof a.success?a.success:i.noop,a.error="function"==typeof a.error?a.error:i.noop;var s=!0===a.unload,d=!0;void 0!==a.notifyDestroyed&&null!==a.notifyDestroyed&&(d=!0===a.notifyDestroyed);var l=!0===a.cleanupHandles;if(i.log("Destroying session "+w+" (unload="+s+")"),!w)return i.warn("No session to destroy"),a.success(),void(d&&e.destroyed());if(l)for(var u in C)M(u,{noRequest:!0});if(!_)return i.warn("Is the server down? (connected=false)"),w=null,void a.success();var p={janus:"destroy",transaction:i.randomString(12)};m&&(p.token=m);v&&(p.apisecret=v);if(s)return t?(r.onclose=null,r.close(),r=null):navigator.sendBeacon(c+"/"+w,JSON.stringify(p)),i.log("Destroyed session:"),w=null,_=!1,a.success(),void(d&&e.destroyed());if(t){p.session_id=w;var h=function(){for(var e in n)r.removeEventListener(e,n[e]);r.removeEventListener("message",g),r.removeEventListener("error",y),o&&clearTimeout(o),r.close()},g=function(t){var r=JSON.parse(t.data);r.session_id==p.session_id&&r.transaction==p.transaction&&(h(),a.success(),d&&e.destroyed())},y=function(t){h(),a.error("Failed to destroy the server: Is the server down?"),d&&e.destroyed()};return r.addEventListener("message",g),r.addEventListener("error",y),void r.send(JSON.stringify(p))}i.httpAPICall(c+"/"+w,{verb:"POST",withCredentials:f,body:p,success:function(t){i.log("Destroyed session:"),i.debug(t),w=null,_=!1,"success"!==t.janus&&i.error("Ooops: "+t.error.code+" "+t.error.reason),a.success(),d&&e.destroyed()},error:function(t,r){i.error(t+":",r),w=null,_=!1,a.success(),d&&e.destroyed()}})}(a)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:i.noop,e.error="function"==typeof e.error?e.error:i.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:i.noop,e.iceState="function"==typeof e.iceState?e.iceState:i.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:i.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:i.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:i.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:i.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:i.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:i.noop,e.ondata="function"==typeof e.ondata?e.ondata:i.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:i.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:i.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:i.noop,!_)return i.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return i.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,a=e.token?e.token:m,s=i.randomString(12),d={janus:"attach",plugin:n,opaque_id:o,transaction:s};a&&(d.token=a);v&&(d.apisecret=v);if(t)return A[s]=function(t){if(i.debug(t),"success"!==t.janus)return i.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;i.log("Created handle: "+r);var o={session:S,plugin:n,id:r,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(){return N(r,!0)},getRemoteVolume:function(){return N(r,!0)},getLocalVolume:function(){return N(r,!1)},isAudioMuted:function(){return V(r,!1)},muteAudio:function(){return U(r,!1,!0)},unmuteAudio:function(){return U(r,!1,!1)},isVideoMuted:function(){return V(r,!0)},muteVideo:function(){return U(r,!0,!0)},unmuteVideo:function(){return U(r,!0,!1)},getBitrate:function(){return H(r)},send:function(e){I(r,e)},data:function(e){j(r,e)},dtmf:function(e){O(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){B(r,!0,e)},createAnswer:function(e){B(r,!1,e)},handleRemoteJsep:function(e){F(r,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){W(r,!0===e)},detach:function(e){M(r,e)}};C[r]=o,e.success(o)},d.session_id=w,void r.send(JSON.stringify(d));i.httpAPICall(c+"/"+w,{verb:"POST",withCredentials:f,body:d,success:function(t){if(i.debug(t),"success"!==t.janus)return i.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;t.license&&!window.VideoRTC.license&&(window.VideoRTC.license=t.license,window.VideoRTC.license.livechat="true"==window.VideoRTC.license.livechat,window.VideoRTC.license.screensharing="true"==window.VideoRTC.license.screensharing,window.VideoRTC.license.videorecording="true"==window.VideoRTC.license.videorecording),t.unique_ids&&(window.VideoRTC.unique_ids=t.unique_ids),i.log("Created handle: "+r);var o={session:S,plugin:n,id:r,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(){return N(r,!0)},getRemoteVolume:function(){return N(r,!0)},getLocalVolume:function(){return N(r,!1)},isAudioMuted:function(){return V(r,!1)},muteAudio:function(){return U(r,!1,!0)},unmuteAudio:function(){return U(r,!1,!1)},isVideoMuted:function(){return V(r,!0)},muteVideo:function(){return U(r,!0,!0)},unmuteVideo:function(){return U(r,!0,!1)},getBitrate:function(){return H(r)},send:function(e){I(r,e)},data:function(e){j(r,e)},dtmf:function(e){O(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){B(r,!0,e)},createAnswer:function(e){B(r,!1,e)},handleRemoteJsep:function(e){F(r,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){W(r,!0===e)},detach:function(e){M(r,e)}};C[r]=o,e.success(o)},error:function(t,r){i.error(t+":",r),""===r?e.error(t+": Is the server down?"):e.error(t+": "+r)}})}(e)}}i.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,r=e&&e.Promise||Promise,o=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new o(e,t)},extension:e&&e.extension||n,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||window.adapter,httpAPICall:function(e,n){var o={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(o.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(o.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(o.body=JSON.stringify(n.body));var a=t(e,o).catch(function(e){return r.reject({message:"Probably a network error, is the server down?",error:e})});if(n.timeout){var s=new r(function(e,t){var r=setTimeout(function(){return clearTimeout(r),t({message:"Request timed out",timeout:n.timeout})},n.timeout)});a=r.race([a,s])}return a.then(function(e){return e.ok?typeof n.success==typeof i.noop?e.json().then(function(e){n.success(e)}).catch(function(t){return r.reject({message:"Failed to parse response body",error:t,response:e})}):void 0:r.reject({message:"API call failed",response:e})}).catch(function(e){typeof n.error==typeof i.noop&&n.error(e.message||"<< internal error >>",e)}),a}}},i.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||n,webRTCAdapter:e&&e.adapter||window.adapter,httpAPICall:function(e,r){var n=void 0!==r.body?{contentType:"application/json",data:JSON.stringify(r.body)}:{},o=void 0!==r.withCredentials?{xhrFields:{withCredentials:r.withCredentials}}:{};return t.ajax(t.extend(n,o,{url:e,type:r.verb,cache:!1,dataType:"json",async:r.async,timeout:r.timeout,success:function(e){typeof r.success==typeof i.noop&&r.success(e)},error:function(e,t,n){typeof r.error==typeof i.noop&&r.error(t,n)}}))}}},i.noop=function(){},i.dataChanDefaultLabel="JanusDataChannel",i.endOfCandidates=null,i.init=function(t){if(window.adapter=e("webrtc-adapter"),(t=t||{}).callback="function"==typeof t.callback?t.callback:i.noop,i.initDone)t.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),i.trace=i.noop,i.debug=i.noop,i.vdebug=i.noop,i.log=i.noop,i.warn=i.noop,i.error=i.noop,!0===t.debug||"all"===t.debug)i.trace=console.trace.bind(console),i.debug=console.debug.bind(console),i.vdebug=console.debug.bind(console),i.log=console.log.bind(console),i.warn=console.warn.bind(console),i.error=console.error.bind(console);else if(Array.isArray(t.debug))for(var r of t.debug)switch(r){case"trace":i.trace=console.trace.bind(console);break;case"debug":i.debug=console.debug.bind(console);break;case"vdebug":i.vdebug=console.debug.bind(console);break;case"log":i.log=console.log.bind(console);break;case"warn":i.warn=console.warn.bind(console);break;case"error":i.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+r+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}i.log("Initializing library");var n=t.dependencies||i.useDefaultDependencies();i.isArray=n.isArray,i.webRTCAdapter=n.webRTCAdapter,i.httpAPICall=n.httpAPICall,i.newWebSocket=n.newWebSocket,i.extension=n.extension,i.extension.init(),i.listDevices=function(e,t){e="function"==typeof e?e:i.noop,null==t&&(t={audio:!0,video:!0}),i.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then(function(t){navigator.mediaDevices.enumerateDevices().then(function(r){i.debug(r),e(r);try{var n=t.getTracks();for(var o of n)o&&o.stop()}catch(e){}})}).catch(function(t){i.error(t),e([])}):(i.warn("navigator.mediaDevices unavailable"),e([]))},i.attachMediaStream=function(e,t){try{e.srcObject=t}catch(r){try{e.src=URL.createObjectURL(t)}catch(e){i.error("Error attaching stream to element")}}},i.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(r){try{e.src=t.src}catch(e){i.error("Error reattaching stream to element")}}};var o=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",a=window["on"+o];if(window.addEventListener(o,function(e){for(var t in i.log("Closing window"),i.sessions)i.sessions[t]&&i.sessions[t].destroyOnUnload&&(i.log("Destroying session "+t),i.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));a&&"function"==typeof a&&a()}),i.safariVp8=!1,"safari"===i.webRTCAdapter.browserDetails.browser&&i.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var s of RTCRtpSender.getCapabilities("video").codecs)if(s&&s.mimeType&&"video/vp8"===s.mimeType.toLowerCase()){i.safariVp8=!0;break}i.safariVp8?i.log("This version of Safari supports VP8"):i.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var c=new RTCPeerConnection({},{});c.createOffer({offerToReceiveVideo:!0}).then(function(e){i.safariVp8=-1!==e.sdp.indexOf("VP8"),i.safariVp8?i.log("This version of Safari supports VP8"):i.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),c.close(),c=null})}if(i.unifiedPlan=!1,"firefox"===i.webRTCAdapter.browserDetails.browser&&i.webRTCAdapter.browserDetails.version>=59)i.unifiedPlan=!0;else if("chrome"===i.webRTCAdapter.browserDetails.browser&&i.webRTCAdapter.browserDetails.version<72)i.unifiedPlan=!1;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){const e=new RTCPeerConnection;try{e.addTransceiver("audio"),i.unifiedPlan=!0}catch(e){}e.close()}else i.unifiedPlan=!1;i.initDone=!0,t.callback()}},i.isWebrtcSupported=function(){return!!window.RTCPeerConnection},i.isGetUserMediaAvailable=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)},i.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",n=0;n<e;n++){var i=Math.floor(Math.random()*t.length);r+=t.substring(i,i+1)}return r},t.exports=i},{"webrtc-adapter":55}],69:[function(e,t,r){const n=e("sha.js"),i=e("deep-extend"),o={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},fwvga:{width:{ideal:854},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}},"full-hd":{width:{ideal:1920},height:{ideal:1080}},"4k":{width:{ideal:3840},height:{ideal:2160}},"8k":{width:{ideal:7680},height:{ideal:4320}}};t.exports={mergeDataChannelOptions:(e,t)=>{let r=JSON.parse(JSON.stringify(e));return i(r,t),r.allowedTypes=t.allowedTypes||r.allowedTypes,r},generateFileId:e=>n("sha256").update(e+Date.now()).digest("hex"),isJson:e=>{try{JSON.parse(e)}catch(e){return!1}return!0},pad:(e,t)=>{let r=e+"";for(;r.length<t;)r="0"+r;return r},videoResolutions:e=>o[e]||{}}},{"deep-extend":39,"sha.js":48}],70:[function(e,t,r){window.VideoRTC=e("./core"),window.VideoRTC.connection={},window.VideoRTC.server={},window.VideoRTC.license=void 0,window.VideoRTC.unique_ids=void 0,window.VideoRTC.getBrowser=(()=>{}),window.VideoRTC.isMobile=(()=>{})},{"./core":67}],71:[function(e,t,r){const n=e("bluebird/js/release/bluebird"),i=e("detectrtc");r.detect=(()=>{const e=()=>i,t=e=>{const t=e||{chrome:!0,firefox:!0,opera:!1,safari:!1};return!!(i.isWebRTCSupported&&(i.browser.isChrome&&!0===t.chrome||i.browser.isFirefox&&!0===t.firefox||i.browser.isOpera&&!0===t.opera||i.browser.isSafari&&!0===t.safari))},r=()=>({hasCamera:i.hasWebcam,videoDevices:i.videoInputDevices,domainCameraPermissions:i.isWebsiteHasWebcamPermissions}),o=()=>({hasMicrophone:i.hasMicrophone,audioInputDevices:i.audioInputDevices,domainMicrophonePermissions:i.isWebsiteHasMicrophonePermissions}),a=()=>({hasSpeakers:i.hasSpeakers,audioOutputDevices:i.audioOutputDevices});return new n(n=>{i.load(()=>{n({getDetectionInfo:e,detectBrowserCompatibility:t,detectCamera:r,detectMicrophone:o,detectSpeakers:a})})})})},{"bluebird/js/release/bluebird":5,detectrtc:40}],72:[function(e,t,r){const n=e("../externals/janus"),i=e("bluebird/js/release/bluebird");e("../extra/utils");r.echoTest=((e,t,r)=>{if(!t||!t.local||!t.remote||1!==t.local.nodeType||1!==t.remote.nodeType)return null;let o=!!(r&&r.stream&&r.stream.muteRemoteAudio)&&r.stream.muteRemoteAudio,a=null,s=(r&&r.stream&&r.stream,{});r&&r.account&&(s.account=r.account),s.module="echo-test",s.device=window.VideoRTC.getDeviceInfo();const c=()=>{if(t)for(let e in t){if(!t.hasOwnProperty(e))continue;let r=t[e];r&&r.innerHTML&&(r.innerHTML="")}},d=()=>parseInt(a.getBitrate().split(" ")[0]),l=()=>{const e={audio:!0,video:!0};a.send({message:e}),n.debug("Trying a createOffer too (audio/video sendrecv)"),a.createOffer({success:t=>{a.send({message:e,jsep:t})},error:e=>{n.error("WebRTC error:",e)}})};return new i((r,i)=>{window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.echotest",opaqueId:JSON.stringify(s),success:e=>{a=e,r({getCurrentBitrate:d,launchConnection:l,closeUsecase:c})},error:e=>{n.error("Error attaching plugin...",e),i(e)},consentDialog:e=>{},iceState:e=>{n.debug(`ICE state changed to ${e}`)},mediaState:(e,t)=>{n.debug(`VideoGateway ${t?"started":"stopped"} receiving our ${e}`)},webrtcState:e=>{n.debug(`VideoGateway says our WebRTC PeerConnection is ${e?"up":"down"} now`)},slowLink:(t,r)=>{n.debug(`VideoGateway reports problems ${t?"sending":"receiving"} packets on this PeerConnection (${r} NACKs/s ${t?"received":"sent"})`),e&&e.onSlowLink&&e.onSlowLink(t,r)},onmessage:(e,t)=>{n.debug("Got a message"),n.debug(JSON.stringify(e)),void 0!==t&&null!==t&&(n.debug("Handling SDP as well..."),n.debug(t),a.handleRemoteJsep({jsep:t}));const r=e.result;null!==r&&void 0!==r&&"done"===r&&n.debug("The Echo Test is over")},onlocalstream:e=>{if(n.debug("Got a local stream"),!t.local)return!1;if(!document.getElementById("video-local")){let e=t.local,r=document.createElement("div");r.id="video-local-container",r.className="videortc-video-container",r.innerHTML='<video class="is-local-video" autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="video-local"></video>',e.insertBefore(r,e.firstChild)}let r=document.getElementById("video-local");n.attachMediaStream(r,e),r.muted=!0;let i=e.getVideoTracks();if(null===i||void 0===i||0===i.length){if(!document.getElementById("no-cam-id-local")){var o=document.createElement("div");o.innerHTML="No camera available",o.style.position="relative",o.style.height="100%",o.style.width="100%",o.style.top="100%",o.style.left="50%",o.style.transform="translate(-50%,-50%)",o.className="no-camera-available",o.id="no-cam-id-local";var a=document.getElementById("video-local");a.insertBefore(o,a.firstChild)}document.getElementById("no-cam-id-local").style.display="block"}else document.getElementById("no-cam-id-local")&&(document.getElementById("no-cam-id-local").style.display="none")},onremotestream:r=>{if(n.debug("Got a remote stream"),!t.remote)return!1;if(!document.getElementById("video-remote")){let r=t.remote,n=document.createElement("div");n.id="video-remote-container",n.className="videortc-video-container",n.innerHTML='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="video-remote"></video>',r.insertBefore(n,r.firstChild),e&&e.onConnected&&e.onConnected()}let i=document.getElementById("video-remote");n.attachMediaStream(i,r),o&&(i.muted=!0);let a=r.getVideoTracks();if(null===a||void 0===a||0===a.length){if(!document.getElementById("no-cam-id-remote")){let e=document.createElement("div");e.innerHTML="No camera available",e.style.position="relative",e.style.height="100%",e.style.width="100%",e.style.top="100%",e.style.left="50%",e.style.transform="translate(-50%,-50%)",e.className="no-camera-available",e.id="no-cam-id-remote";let t=document.getElementById("video-remote");t.insertBefore(e,t.firstChild)}document.getElementById("no-cam-id-remote").style.display="block"}else document.getElementById("no-cam-id-remote")&&(document.getElementById("no-cam-id-remote").style.display="none")},ondataopen:()=>{},ondata:e=>{},oncleanup:()=>{n.debug("Cleanup notification")}})})})},{"../externals/janus":68,"../extra/utils":69,"bluebird/js/release/bluebird":5}],73:[function(e,t,r){const n=e("../externals/janus"),i=e("bluebird/js/release/bluebird");r.getDevices=(e=>(null==e&&(e={audio:!0,video:!0}),new i((t,r)=>{n.listDevices(e=>{let r=[],n=[];e.forEach(e=>{let t=e.label;null!==t&&void 0!==t&&""!==t||(t=""),"audioinput"===e.kind&&(""===t&&(t="Audio "+(r.length+1)),r.push({label:t,id:e.deviceId})),"videoinput"===e.kind&&(""===t&&(t="Camera "+(n.length+1)),n.push({label:t,id:e.deviceId}))}),t({audioDevices:r,videoDevices:n})},e)})))},{"../externals/janus":68,"bluebird/js/release/bluebird":5}],74:[function(e,t,r){const n=e("../externals/janus"),i=e("bluebird/js/release/bluebird");r.sip=((e,t,r)=>{if(!t||!t.local||!t.remote||1!==t.local.nodeType||1!==t.remote.nodeType)return null;let o=r&&r.stream?r.stream:{};o.aDeviceId||(o.aDeviceId=void 0),o.vDeviceId||(o.vDeviceId=void 0);let a={};r&&r.account&&(a.account=r.account),a.module="sip",a.device=window.VideoRTC.getDeviceInfo();let s=null,c=!1,d=null;const l=()=>{if(t)for(let e in t){if(!t.hasOwnProperty(e))continue;let r=t[e];r&&r.innerHTML&&(r.innerHTML="")}},u=()=>{s.send({message:{request:"decline",code:480}})},p=()=>{s.send({message:{request:"hangup"}}),s.hangup()},f=()=>window.VideoRTC.license,h=()=>{const e=d.sdp.indexOf("m=audio ")>-1,t=d.sdp.indexOf("m=video ")>-1;let r={audio:!1,video:!1};e&&(r.audio={deviceId:{exact:o.aDeviceId||void 0}}),t&&(r.video={deviceId:{exact:o.vDeviceId||void 0}}),s.createAnswer({jsep:d,media:r,success:e=>{n.debug(e),s.send({message:{request:"accept"},jsep:e})},error:e=>{n.error("WebRTC error:",e)}})},m=e=>{s.dtmf({dtmf:{tones:e}})},v=(t,r,n,i,o)=>{if(!t||!r)return void(e&&e.onRegisteredFailed&&e.onRegisteredFailed(400,"Bad Request"));let a={request:"register",username:t,display_name:r,proxy:n};i&&o?(a.authuser=i,a.secret=o):a.type="guest",s.send({message:a})},g=(e,t,r)=>{s.createOffer({media:{audioSend:!0,audioRecv:!0,videoSend:!0===r,videoRecv:!0===r,audio:{deviceId:{exact:o.aDeviceId||void 0}}},success:r=>{n.debug("Got SDP!"),n.debug(r);const i={request:"call",uri:e,headers:t};s.send({message:i,jsep:r})},error:e=>{n.error("WebRTC error...",e)}})},y=e=>{if("screen"!==e&&"video"!==e)return!1;s.createOffer({media:{video:e,replaceVideo:!0},success:e=>{},error:e=>{n.error("WebRTC error...",e)}})},b=()=>(s.isAudioMuted()?s.unmuteAudio():s.muteAudio(),s.isAudioMuted()),_=()=>(s.isVideoMuted()?s.unmuteVideo():s.muteVideo(),s.isVideoMuted());return new i((r,i)=>{window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.sip",opaqueId:JSON.stringify(a),success:e=>{s=e,r({accept:h,call:g,closeUsecase:l,decline:u,getLicense:f,hangup:p,register:v,sendDtmf:m,toggleAudio:b,toggleVideo:_,replaceVideo:y})},error:e=>{n.error("Error attaching plugin...",e),i(e)},consentDialog:e=>{},iceState:e=>{},mediaState:(e,t)=>{},webrtcState:e=>{},slowLink:(e,t)=>{},onmessage:(t,r)=>{n.debug("Got a message"),n.debug(JSON.stringify(t));const i=t.error;if(null!=i&&void 0!=i)return void n.error(i);const o=t.result;if(null!==o&&void 0!==o&&void 0!==o.event&&null!==o.event){const t=o.event;if("registration_failed"===t)return n.warn(`Registration failed: ${o.code} ${o.reason}`),void(e&&e.onRegisteredFailed&&e.onRegisteredFailed(o.code,o.reason));"registered"===t?(n.log(`Successfully registered as ${o.username}`),c=!0,e&&e.onRegistered&&e.onRegistered(o.username)):"calling"===t?(n.log("Waiting for the peer to answer..."),e&&e.onCalling&&e.onCalling()):"incomingcall"===t?(d=r,n.debug("Handling SDP as well..."),n.debug(r),n.log(`Incoming call from ${o.username}`),e&&e.onIncomingCall&&e.onIncomingCall(o.username)):"accepting"===t||("progress"===t?(n.log(`There's early media from ${o.username}, waiting for the call!`),n.log(r),null!==r&&void 0!==r&&s.handleRemoteJsep({jsep:r,error:p}),n.warn("Early media...")):"accepted"===t?(n.log(`${o.username} accepted the call`),n.log(r),e&&e.onAccepted&&e.onAccepted(),null!==r&&void 0!==r&&s.handleRemoteJsep({jsep:r,error:p}),n.log("Call accepted")):"hangup"===t&&(n.log(`Call hung up (${o.code} ${o.reason})`),s.hangup(),e&&e.onHangUp&&e.onHangUp(o.code,o.reason)))}},onlocalstream:r=>{if(n.debug("Got a local stream"),!t.local)return!1;if(!document.getElementById("video-local-container")){let n=t.local,i=document.createElement("div");i.id="video-local-container",i.className="videortc-video-container",i.innerHTML='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="audio-local"></video>',n.insertBefore(i,n.firstChild),e&&e.onLocalReady&&e.onLocalReady(r)}let i=document.getElementById("audio-local");n.attachMediaStream(i,r),i.muted=!0},onremotestream:r=>{if(n.debug("Got a remote stream"),!t.remote)return!1;if(!document.getElementById("video-remote-container")){let n=t.remote,i=document.createElement("div");i.id="video-remote-container",i.className="videortc-video-container",i.innerHTML='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="audio-remote"></video>',n.insertBefore(i,n.firstChild),e&&e.onRemoteReady&&e.onRemoteReady(r)}let i=document.getElementById("audio-remote");n.attachMediaStream(i,r)},ondataopen:()=>{},ondata:e=>{},oncleanup:()=>{n.log("Got a cleanup notification")},detached:()=>{}})})})},{"../externals/janus":68,"bluebird/js/release/bluebird":5}],75:[function(e,t,r){const n=e("../externals/janus"),i=e("bluebird/js/release/bluebird"),o=e("../modules/datachannel"),a=e("../extra/utils");r.splitAgent=((e,t,r)=>{if(!t||!t.agent||!t.client||1!==t.agent.nodeType||1!==t.client.nodeType)return null;t.screenAgent&&(t.screenLocal=t.screenAgent);let s=r&&r.stream?r.stream:{},c=!!(r&&r.dataChannel&&r.dataChannel.dataEnabled)&&r.dataChannel.dataEnabled;s.videoEnabled||(s.videoEnabled=!1),s.aDeviceId||(s.aDeviceId=void 0),s.vDeviceId||(s.vDeviceId=void 0),s.videoStream||(s.videoStream=void 0),s.resolution||(s.resolution=void 0);let d={};r&&r.account&&(d.account=r.account),d.module="split-agent",d.device=window.VideoRTC.getDeviceInfo();let l=r&&r.session?r.session:{};l.agentName||(l.agentName="Unknown"),l.sessionId||(l.sessionId=0);let u=null,p=null,f=null,h=null,m=null,v=null,g=null,y=null,b=l.agentName,_=l.sessionId,w=null,C=null,S=0,T=null,A=null,k=null,R=!0;r.account&&r.account;const E=()=>{if(t)for(let e in t){if(!t.hasOwnProperty(e))continue;let r=t[e];r&&r.innerHTML&&(r.innerHTML="")}},P=(e,t)=>{const r={request:"join",room:e||0,ptype:"publisher",display:t||"Agent"};u.send({message:r})},I=e=>{A=e,S++,T=a.pad(S,3);const t={prefix:e,record_id:S};G("videortc-start-videorecording",JSON.stringify(t)),D(_,A,T)},x=()=>{G("videortc-stop-videorecording",A),j(_)},D=(e,t,r)=>{const n={request:"configure",record:!0,filename:`/videortc-records/${t}split-${e}-${r}-peer`};u.send({message:n})},j=e=>{const t={request:"configure",room:e,record:!1};u.send({message:t})},O=()=>window.VideoRTC.license,M=()=>(u.isVideoMuted()?u.unmuteVideo():u.muteVideo(),u.isVideoMuted()),L=(e,t,r,n,i)=>{o.send(e,t,r,n,i)},B=(r,i,a,s)=>{p=null,window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(d),success:e=>{p=e;const t={request:"join",room:_,ptype:"subscriber",feed:r};"safari"!==n.webRTCAdapter.browserDetails.browser||"vp9"!==s&&("vp8"!==s||n.safariVp8)||(s&&(s=s.toUpperCase()),t.offer_video=!1),p.videoCodec=s,p.send({message:t})},error:e=>{n.error("Error attaching plugin...",e)},destroyed:()=>{},consentDialog:e=>{},onmessage:(e,t)=>{n.debug("Got a message (listener)");const r=e.videoroom;void 0!==r&&null!==r&&("attached"===r?(p.rfid=e.id,p.rfdisplay=e.display,n.log(`Successfully attached to feed ${p.rfid} (${p.rfdisplay}) in room ${e.room}`)):void 0!==e.error&&null!==e.error&&n.error(e.error)),void 0!==t&&null!==t&&p.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:e=>{const t={request:"start",room:_};p.send({message:t,jsep:e})},error:e=>{n.error("WebRTC error:",e)}})},onlocalstream:e=>{},onremotestream:r=>{if(n.debug("Remote stream"),!document.getElementById("container-remote1")){const n=(e,t,r,n)=>{let i="";return i+='<span id="'+e+'" style="',i+=" position:absolute;margin:10px;padding:3px 5px;color:white;font-weight:bold;border-radius:5px;",i+="background:"+r+";",i+=n,i+='">'+t+"</span>"};let i=t.client,o=document.createElement("div");o.id="container-remote1";let a="";a+='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="videoremote1"></video>',a+=n("remote-name","{"!==p.rfdisplay[0]?p.rfdisplay:"Client","#55D8D5","left:0; margin-top: 10px;"),a+=n("remote-resolution","","#8DCC6D","left:0; margin-top: 40px;"),a+=n("remote-bitrate","","#FF6E5F","left:0; margin-top: 70px;"),o.innerHTML=a,i.appendChild(o),e&&e.onAcceptedVideo&&e.onAcceptedVideo(r);const s=document.getElementById("videoremote1");s.onplaying=(()=>{let e=s.videoWidth,t=s.videoHeight;document.getElementById("remote-resolution").innerHTML=e+"x"+t,"firefox"===window.VideoRTC.getBrowser()&&setTimeout(()=>{let e=s.videoWidth,t=s.videoHeight;document.getElementById("remote-resolution").innerHTML=e+"x"+t},2e3)})}let i=document.getElementById("container-remote1"),o=document.getElementById("videoremote1");n.attachMediaStream(o,r),o.muted=!0;let a=r.getVideoTracks();if(null===a||void 0===a||0===a.length){if(!document.getElementById("no-cam-id-remote")){let e=document.createElement("div");e.innerHTML="No camera available",e.style.position="relative",e.style.height="100%",e.style.width="100%",e.style.top="100%",e.style.left="50%",e.style.transform="translate(-50%,-50%)",e.className="no-camera-available",e.id="no-cam-id-remote",i.insertBefore(e,i.firstChild)}document.getElementById("no-cam-id-remote").style.display="block",e&&e.onRemoteVideoReady&&e.onRemoteVideoReady(!1,r)}else document.getElementById("no-cam-id-remote")&&(document.getElementById("no-cam-id-remote").style.display="none"),e&&e.onRemoteVideoReady&&e.onRemoteVideoReady(!0,r);null!==C&&clearInterval(bitrateTimer),bitrateTimer=null,bitrateTimer=setInterval(()=>{const e=p.getBitrate();document.getElementById("remote-bitrate")&&(document.getElementById("remote-bitrate").innerHTML=e)},1e3)},oncleanup:()=>{n.log(`Got a cleanup notification (remote feed ${r})`),null!==C&&clearInterval(C),C=null},detached:()=>{},ondataopen:()=>{n.log("The DataChannel is available"),e&&e.onAcceptedData&&e.onAcceptedData()},ondata:t=>{n.debug("We got data from the DataChannel"),o.receive(t,e.onDataReceived)}})},F=()=>{const e={audioRecv:!1,videoRecv:!1,audioSend:!1,videoSend:s.videoEnabled,data:c,video:{deviceId:{exact:s.vDeviceId||void 0},width:a.videoResolutions(s.resolution).width,height:a.videoResolutions(s.resolution).height}};u.createOffer({media:e,stream:s.videoStream,success:e=>{const t={request:"configure",audio:!1,video:!0,record:!1,data:c,audiocodec:"opus",videocodec:"vp8"};u.send({message:t,jsep:e})},error:e=>{n.error("WebRTC error:",e),F()}})},N=r=>{window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(d),success:e=>{var t={request:"join",room:r,ptype:"publisher",display:"ScreenAgent"};(f=e).send({message:t})},error:e=>{},consentDialog:e=>{},onmessage:(i,o)=>{const a=i.videoroom;if(void 0!==a&&null!==a)if("joined"===a){if(void 0!==i.publishers&&null!==i.publishers&&1==i.publishers.length){const e=i.publishers;n.debug("Got a list of available publishers:"),n.debug(e),g=i.publishers[0].id,y=i.publishers[0].display,V(r,g),n.debug("  >> ["+g+"] "+y)}}else if("destroyed"===a)n.warn("The room has been destroyed!");else if("event"===a)if(void 0!==i.publishers&&null!==i.publishers&&1==i.publishers.length){const e=i.publishers;n.debug("Got a list of available publishers:"),n.debug(e),g=i.publishers[0].id,y=i.publishers[0].display,V(r,g)}else if(void 0!==i.leaving&&null!==i.leaving){const r=i.leaving;n.log("Publisher left: "+r);let o=t.screenRemote;o.innerHTML="",o.style="",h&&h.detach(),e&&e.onScreensharingClosed&&e.onScreensharingClosed()}else if(void 0!==i.unpublished&&null!==i.unpublished){const e=i.unpublished;n.log("Publisher left: "+e);let r=t.screenRemote;r.innerHTML="",r.style="",h&&h.detach()}else void 0!==i.error&&null!==i.error&&n.error(i.error);void 0!==o&&null!==o&&(n.debug("Handling SDP as well..."),n.debug(o),f.handleRemoteJsep({jsep:o}))},onlocalstream:e=>{let r=t.screenLocal;document.getElementById("screenAgent")||(r.innerHTML='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="screenAgent"></video>');let i=document.getElementById("screenAgent");n.attachMediaStream(i,e),i.muted=!0},onremotestream:e=>{},oncleanup:()=>{},detached:()=>{}})},V=(r,i)=>{window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(d),success:e=>{const t={request:"join",room:r,ptype:"subscriber",feed:i};(h=e).send({message:t})},error:e=>{n.error("Error attaching plugin...",cause)},onmessage:(e,t)=>{n.debug("Got a message (listener)");const r=e.videoroom;void 0!==r&&null!==r&&("attached"===r||void 0!==e.error&&null!==e.error&&n.error(e.error)),void 0!==t&&null!==t&&(n.debug("Handling SDP as well..."),n.debug(t),h.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,audioRecv:!1,videoRecv:!0,data:!1},success:e=>{n.debug("Got SDP"),n.debug(e);const t={request:"start",room:_};h.send({message:t,jsep:e})},error:e=>{n.error("WebRTC error:",e)}}))},onlocalstream:e=>{},onremotestream:r=>{let i=t.screenRemote;if(!document.getElementById("container-screenremote")){let e="";e+='<div id="container-screenremote">',e+='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="screenremote"></video>',e+="</div>",i.innerHTML=e}let o=document.getElementById("screenremote");n.attachMediaStream(o,r),o.muted=!0,e&&e.onScreensharingAccepted&&e.onScreensharingAccepted()},oncleanup:()=>{}})},U=(e,t,r)=>O().screensharing?"https:"!==window.location.protocol?(r("Screensharing requires HTTPS"),!1):window.isMobile?(r("Screensharing is not available on Mobile devices"),!1):n.isExtensionEnabled()?(w=e,void f.createOffer({media:{video:"screen",audio:!1,videoRecv:!1,data:!1},success:e=>{f.send({message:{request:"configure",audio:!1,video:!0,data:!1,audiocodec:"opus",videocodec:"vp8"},jsep:e}),t()},error:e=>{n.error(e),e&&"NotAllowedError"===e.name&&"firefox"===window.getBrowser()&&r("Firefox needs that the domain this web application is from is listed in Allowed domains."),n.error("WebRTC error:",e)}})):(r("You're using a recent version of Chrome but don't have the screensharing extension installed: click <b><a href='https://chrome.google.com/webstore/detail/videortc-screensharing/pkilckpboojemoogepfpkgbihkfkikel' target='_blank'>here</a></b> to do so"),!1):(r("Screensharing is not a feature of your Gateway"),!1),H=(e,r)=>{f.send({message:{request:"leave"}}),f.detach(),N(k);let n=t.screenLocal;n.innerHTML="",n.style="",e()},G=(e,t)=>{if(!e)return;let r={action:e};t&&(r.data=t);const n={request:"configure",display:JSON.stringify(r)};u.send({message:n}),setTimeout(()=>{const e={request:"configure",display:b};u.send({message:e})},2e3)},W=(e,t)=>{if(!u)return!1;u.detach(),setTimeout(()=>{q(r=>{e&&(s.videoEnabled=e),t&&(c=t),P(_,b)},e=>{n.error(e)})},500)},q=(i,s)=>{window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(d),success:t=>{u=t;const a=r&&r.dataChannel?r.dataChannel:{},s={fileOk:e.onFileTransferOk||function(){},fileKo:e.onFileTransferKo||function(){}};o.initialize(a,t,s)||n.error("Datachannel options can't be loaded:"),R&&P(_,b),R=!1,i({closeUsecase:E,getLicense:O,notify:G,startRecording:I,stopRecording:x,startScreensharing:U,stopScreensharing:H,toggleVideo:M,sendData:L,setMode:W})},error:e=>{s(e)},destroyed:()=>{},consentDialog:e=>{},onmessage:(r,i)=>{const o=r.videoroom;if(void 0!=o&&null!=o)if("joined"===o){const n=JSON.parse(r.description);if(k=parseInt(n.screenId),r.publishers.length>=2)return void(e&&e.onError&&e.onError("There's already an agent connected"));F(),void 0!==r.publishers&&null!==r.publishers&&1==r.publishers.length&&(m=r.publishers[0].id,v=r.publishers[0].display,r.publishers[0].audio_codec,l=r.publishers[0].video_codec,B(m,0,0,l)),k&&k>0&&t.screenRemote&&O().screensharing&&N(k),e&&e.onJoined&&e.onJoined()}else if("destroyed"===o)e&&e.onDestroyed&&e.onDestroyed();else if("event"===o)if(void 0!==r.publishers&&null!==r.publishers){var s=r.publishers;for(var c in s){var d=s[c].id,l=(s[c].display,s[c].audio_codec,s[c].video_codec);B(d,0,0,l)}}else if(void 0!==r.leaving&&null!==r.leaving){const t=r.leaving;n.log(`Publisher left: ${t}`),null!=p&&m==t&&(n.debug(`Feed ${p.rfid} (${p.rfdisplay}) has left the room, detaching`),p.detach()),e&&e.onVideoClosed&&e.onVideoClosed()}else if(void 0!==r.unpublished&&null!==r.unpublished){const e=r.unpublished;if(n.log(`Publisher left ${e}`),m!=e)return;if("ok"===e)return void u.hangup();null!=p&&(n.debug(`Feed ${p.rfid} (${p.rfdisplay}) has left the room, detaching`),p.detach())}else if(void 0!==r.display&&null!==r.display){if(!a.isJson(r.display))return;const t=JSON.parse(r.display),i=t.action||"",o=t.data||"";if("videortc-prefix-videorecording"==i){const e=JSON.parse(o);S=e.last_rec_id}else e&&e.onNotified&&(n.debug("Notification received: "+i),e.onNotified(i,o))}else void 0!==r.error&&null!==r.error?(r.error.toLowerCase().indexOf("already attached")>-1&&window.VideoRTC.connection.handle.destroy(),e&&e.onError&&e.onError(r.error)):void 0!==r.result&&null!==r.result&&r.result;void 0!==i&&null!==i&&u.handleRemoteJsep({jsep:i})},onlocalstream:r=>{let i=t.agent;document.getElementById("videoAgent")||(i.innerHTML='<video class="is-local-video" autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="videoAgent"></video>');let o=document.getElementById("videoAgent");n.attachMediaStream(o,r),o.muted=!0;let a=r.getVideoTracks();if(null===a||void 0===a||0===a.length){if(!document.getElementById("no-cam-id-local")){let e=document.createElement("div");e.innerHTML="No camera available",e.style.position="relative",e.style.height="100%",e.style.width="100%",e.style.top="100%",e.style.left="50%",e.style.transform="translate(-50%,-50%)",e.className="no-camera-available",e.id="no-cam-id-local",i.insertBefore(e,i.firstChild)}document.getElementById("no-cam-id-local").style.display="block",e&&e.onReadyLocalStream&&e.onReadyLocalStream(!1,r)}else document.getElementById("no-cam-id-local")&&(document.getElementById("no-cam-id-local").style.display="none"),e&&e.onReadyLocalStream&&e.onReadyLocalStream(!0,r)},onremotestream:e=>{},oncleanup:()=>{},detached:()=>{}})};return new i((e,t)=>{q(e,t)})})},{"../externals/janus":68,"../extra/utils":69,"../modules/datachannel":81,"bluebird/js/release/bluebird":5}],76:[function(e,t,r){const n=e("../externals/janus"),i=e("bluebird/js/release/bluebird"),o=e("../modules/datachannel"),a=e("../extra/utils"),s=e("./getDevices");r.splitClient=((e,t,r)=>{if(!t||!t.local||!t.remote||1!==t.local.nodeType||1!==t.remote.nodeType)return null;let c=r&&r.stream?r.stream:{},d=!!(r&&r.dataChannel&&r.dataChannel.dataEnabled)&&r.dataChannel.dataEnabled;c.audioEnabled||(c.audioEnabled=!1),c.videoEnabled||(c.videoEnabled=!1),c.aDeviceId||(c.aDeviceId=void 0),c.vDeviceId||(c.vDeviceId=void 0),c.audioStream||(c.audioStream=void 0),c.videoStream||(c.videoStream=void 0),c.resolution||(c.resolution=void 0);let l={};r&&r.account&&(l.account=r.account),l.module="split-client",l.device=window.VideoRTC.getDeviceInfo();let u,p=null,f=null,h=null,m=null,v=null,g=null,y=null,b=null,_=null,w=null,C=void 0,S=void 0,T=null,A=null,k=void(r.account&&r.account),R=[];c.videoEnabled&&s.getDevices({audio:!1,video:!0}).then(e=>{R=e.videoDevices,u=0});const E=()=>{if(t)for(let e in t){if(!t.hasOwnProperty(e))continue;let r=t[e];r&&r.innerHTML&&(r.innerHTML="")}},P=(e,t,r,n,i)=>{o.send(e,t,r,n,i)},I=e=>{m.dtmf({dtmf:{tones:e}})},x=()=>(m.isAudioMuted()?m.unmuteAudio():m.muteAudio(),m.isAudioMuted()),D=()=>{let e=document.getElementById("remote-audio"),t=!1;return e&&(e.muted=!e.muted,t=e.muted),t},j=()=>(v.isVideoMuted()?v.unmuteVideo():v.muteVideo(),v.isVideoMuted()),O=()=>{const e={request:"join",room:p,ptype:"publisher",display:T};v.send({message:e})},M=e=>{var t={request:"destroy",room:e,secret:e+""};v.send({message:t})},L=()=>{v.createOffer({media:{audioRecv:!1,audioSend:!1,videoRecv:!1,videoSend:c.videoEnabled,data:d,video:{deviceId:{exact:c.vDeviceId||void 0},width:a.videoResolutions(c.resolution).width,height:a.videoResolutions(c.resolution).height}},stream:c.videoStream,success:e=>{n.debug("Got publisher SDP"),n.debug(e);const t={request:"configure",audio:!1,video:c.videoEnabled,data:d};v.send({message:t,jsep:e})},error:e=>{n.error("WebRTC error:",e),L()}})},B=t=>{const r={request:"configure",room:t,record:!1};v.send({message:r}),m.send({message:{request:"recording",action:"stop",audio:!0,video:!1,peer_audio:!0,peer_video:!1}}),e&&e.onStopRecording&&e.onStopRecording()},F=(t,r,n,o)=>new i((i,a)=>{const s={name:r||"SPLIT Room",screenId:f},c={request:"create",room:t,description:JSON.stringify(s),is_private:!0,secret:n,bitrate:o||128e3,publishers:2,record:!1};h.send({message:c,success:t=>{if(t.error)return e&&e.onRegisteredFailed&&e.onRegisteredFailed(t.error),void a(t.error);i()}})}),N=(e,t,r,i,o)=>{C=e,S=i,o=o,F(p,"SPLIT VideoRoom",p+"",t).then(()=>{if(H().screensharing)return F(f,"SPLIT ScreenRoom",f+"",r)}).then(()=>{h.detach(),h=null;const e={request:"register",username:`sip:${C}@localhost`,display_name:C,type:"guest"};m.send({message:e})}).catch(e=>{n.error("WebRTC error...",e)})},V=()=>{m.send({message:{request:"hangup"}}),m.hangup()},U=e=>{if("user"!==e&&"environment"!==e&&"left"!==e&&"right"!==e&&"next"!==e)return!1;let t;"next"===e?(++u>=R.length&&(u=0),t={deviceId:{exact:R[u].id}}):t={facingMode:e},v.createOffer({media:{video:t,replaceVideo:!0},success:e=>{},error:e=>{n.error("WebRTC error...",e)}})},H=()=>window.VideoRTC.license,G=(r,i,a,s)=>{g=null,l.module="",window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(l),success:e=>{g=e,n.log(`Plugin attached! (${g.getPlugin()}, id=${g.getId()})`),n.log("This is a subscriber");const t={request:"join",room:p,ptype:"subscriber",feed:r};"safari"!==n.webRTCAdapter.browserDetails.browser||"vp9"!==s&&("vp8"!==s||n.safariVp8)||(s&&(s=s.toUpperCase()),t.offer_video=!1),g.videoCodec=s,g.send({message:t})},error:e=>{n.error("Error attaching plugin...",e)},onmessage:(e,t)=>{n.debug("Got a message (listener)");const r=e.videoroom;void 0!==r&&null!==r&&("attached"===r?(g.rfid=e.id,g.rfdisplay=e.display,n.log(`Successfully attached to feed ${g.rfid} (${g.rfdisplay}) in room ${e.room}`)):void 0!==e.error&&null!==e.error&&n.error(e.error)),void 0!==t&&null!==t&&(n.debug("Handling SDP as well..."),n.debug(t),g.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,audioRecv:!0,videoRecv:!0,data:d},success:e=>{n.debug("Got SDP"),n.debug(e);const t={request:"start",room:p};g.send({message:t,jsep:e})},error:e=>{n.error("WebRTC error:",e)}}))},onlocalstream:e=>{},onremotestream:r=>{n.debug("Remote stream");let i=t.remote;if(!document.getElementById("container-remote1")){const t=(e,t,r,n)=>{let i="";return i+='<span id="'+e+'" style="',i+=" position:absolute;margin:10px;padding:3px 5px;color:white;font-weight:bold;border-radius:5px;",i+="background:"+r+";",i+=n,i+='">'+t+"</span>"};let o=document.createElement("div");o.id="container-remote1";let a="";a+='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="videoremote1"></video>',a+=t("remote-name","{"!==g.rfdisplay[0]?g.rfdisplay:"Agent","#55D8D5","left:0; margin-top: 10px;"),a+=t("remote-resolution","","#8DCC6D","left:0; margin-top: 40px;"),a+=t("remote-bitrate","","#FF6E5F","left:0; margin-top: 70px;"),o.innerHTML=a,i.appendChild(o);const s=document.getElementById("videoremote1");s.onplaying=(()=>{let e=s.videoWidth,t=s.videoHeight;document.getElementById("remote-resolution").innerHTML=e+"x"+t,"firefox"===n.webRTCAdapter.browserDetails.browser&&setTimeout(()=>{let e=s.videoWidth,t=s.videoHeight;document.getElementById("remote-resolution").innerHTML=e+"x"+t},2e3)}),e&&e.onAcceptedVideo&&e.onAcceptedVideo(r)}let o=document.getElementById("container-remote1"),a=document.getElementById("videoremote1");n.attachMediaStream(a,r),a.muted=!0;let s=r.getVideoTracks();if(null===s||void 0===s||0===s.length){if(!document.getElementById("no-cam-id-remote")){let e=document.createElement("div");e.innerHTML="No camera available",e.style.position="relative",e.style.height="100%",e.style.width="100%",e.style.top="100%",e.style.left="50%",e.style.transform="translate(-50%,-50%)",e.className="no-camera-available",e.id="no-cam-id-remote",o.insertBefore(e,o.firstChild)}document.getElementById("no-cam-id-remote").style.display="block",e&&e.onRemoteVideoReady&&e.onRemoteVideoReady(!1,r)}else document.getElementById("no-cam-id-remote")&&(document.getElementById("no-cam-id-remote").style.display="none"),e&&e.onRemoteVideoReady&&e.onRemoteVideoReady(!0,r);if(null!==A&&clearInterval(bitrateTimer),bitrateTimer=null,bitrateTimer=setInterval(()=>{const e=g.getBitrate();document.getElementById("remote-bitrate")&&(document.getElementById("remote-bitrate").innerHTML=e)},1e3),k){const e={last_rec_id:k};$("videortc-prefix-videorecording",JSON.stringify(e))}},oncleanup:()=>{n.log(`Got a cleanup notification (remote feed ${r})`),null!==A&&clearInterval(A),A=null},ondataopen:()=>{n.log("The DataChannel is available"),e&&e.onAcceptedData&&e.onAcceptedData()},ondata:t=>{n.debug(`We got data from the DataChannel: ${t}`),o.receive(t,e.onDataReceived)}})},W=r=>{l.module="",window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(l),success:e=>{const t={request:"join",room:r,ptype:"publisher",display:"ScreenClient"};(y=e).send({message:t})},error:e=>{},consentDialog:e=>{},onmessage:(i,o)=>{const a=i.videoroom;if(void 0!==a&&null!==a)if("joined"===a){if(void 0!==i.publishers&&null!==i.publishers){var s=i.publishers;n.debug("Got a list of available publishers:"),n.debug(s);for(let e in s){const t=s[e].id,i=s[e].display;n.debug("  >> ["+t+"] "+i),b||q(r,t)}}}else if("destroyed"===a)n.warn("The room has been destroyed");else if("event"===a)if(void 0!==i.publishers&&null!==i.publishers){const e=i.publishers;n.debug("Got a list of available publishers:"),n.debug(e);for(let t in e){const i=e[t].id,o=e[t].display;n.debug("  >> ["+i+"] "+o),b||q(r,i)}}else if(void 0!==i.leaving&&null!==i.leaving){const r=i.leaving;n.log(`Publisher left: ${r}`);let o=t.screenRemote;o.innerHTML="",o.style="",b&&b.detach(),b=null,e&&e.onScreensharingClosed&&e.onScreensharingClosed()}else if(void 0!==i.unpublished&&null!==i.unpublished){const e=i.unpublished;n.log(`Publisher left: ${e}`);let r=t.screenRemote;r.innerHTML="",r.style="",b&&b.detach(),b=null}else void 0!==i.error&&null!==i.error&&n.error(i.error);void 0!==o&&null!==o&&(n.debug("Handling SDP as well..."),n.debug(o),y.handleRemoteJsep({jsep:o}))},onlocalstream:e=>{let r=t.screenLocal;document.getElementById("screenClient")||(r.innerHTML='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="screenClient"></video>');let i=document.getElementById("screenClient");n.attachMediaStream(i,e),i.muted=!0},onremotestream:e=>{},oncleanup:()=>{},detached:()=>{}})},q=(r,i)=>{l.module="",window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(l),success:e=>{const t={request:"join",room:r,ptype:"subscriber",feed:i};(b=e).send({message:t})},error:e=>{n.error(`Error attaching plugin... ${e}`)},onmessage:(e,t)=>{n.debug("Got a message (listener)");const r=e.videoroom;void 0!==r&&null!==r&&("attached"===r||void 0!==e.error&&null!==e.error&&n.error(e.error)),void 0!==t&&null!==t&&(n.debug("Handling SDP as well..."),n.debug(t),b.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,audioRecv:!1,videoRecv:!0,data:!1},success:e=>{n.debug("Got SDP"),n.debug(e);const t={request:"start",room:p};b.send({message:t,jsep:e})},error:e=>{n.error("WebRTC error:",e)}}))},onlocalstream:e=>{},onremotestream:r=>{let i=t.screenRemote;if(!document.getElementById("screenremote")){let e="";e+='<div id="container-screenremote">',e+='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="screenremote"></video>',e+="</div>",i.innerHTML=e}let o=document.getElementById("screenremote");n.attachMediaStream(o,r),o.muted=!0,e&&e.onScreensharingAccepted&&e.onScreensharingAccepted()},oncleanup:()=>{}})},J=(e,t,r)=>H().screensharing?"https:"!==window.location.protocol?(r("ScreenSharing requires HTTPS"),!1):window.isMobile?(r("ScreenSharing is not available on Mobile devices"),!1):n.isExtensionEnabled()?void y.createOffer({media:{video:"screen",audio:!1,videoRecv:!1,data:!1},success:e=>{y.send({message:{request:"configure",audio:!1,video:!0,data:!1},jsep:e}),t()},error:e=>{e&&"NotAllowedError"===e.name&&"firefox"===window.getBrowser()&&r("Firefox needs that the domain this web application is from is listed in Allowed domains."),n.error("WebRTC error:",e)}}):(r("You're using a recent version of Chrome but don't have the screensharing extension installed: click <b><a href='https://chrome.google.com/webstore/detail/videortc-screensharing/pkilckpboojemoogepfpkgbihkfkikel' target='_blank'>here</a></b> to do so"),!1):(r("ScreenSharing is not a feature of your Gateway"),!1),z=(e,r)=>{y.send({message:{request:"leave"}}),y.detach(),W(f);let n=t.screenLocal;n.innerHTML="",n.style="",e()},$=(e,t)=>{if(!e)return;let r={action:e};t&&(r.data=t);const n={request:"configure",display:JSON.stringify(r)};v.send({message:n}),setTimeout(()=>{const e={request:"configure",display:T};v.send({message:e})},2e3)},Q=(e,t)=>{if(!v)return!1;v.detach(),g&&g.detach&&g.detach(),setTimeout(()=>{X(r=>{e&&(c.videoEnabled=e),t&&(d=t),O()},e=>{n.error(e)})},500)},X=(i,s)=>{l.module="",window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(l),success:t=>{v=t;const a=r&&r.dataChannel?r.dataChannel:{},s={fileOk:e.onFileTransferOk||function(){},fileKo:e.onFileTransferKo||function(){}};o.initialize(a,t,s)||n.error("Datachannel options can't be loaded"),i()},error:e=>{s()},consentDialog:e=>{},onmessage:(r,i)=>{const o=r.videoroom;if(void 0!==o&&null!==o)if("joined"===o){if(n.log(`Successfully joined room ${r.room} with ID ${r.id}`),(c.videoEnabled||d)&&L(),void 0!==r.publishers&&null!==r.publishers){const e=r.publishers;n.debug("Got a list of available publishers:"),n.debug(e);for(let t in e){const r=e[t].id,i=e[t].display,o=(e[t].audio_codec,e[t].video_codec);n.debug("  >> ["+r+"] "+i),G(r,0,0,o)}}e&&e.onJoined&&e.onJoined(),f&&f>0&&t.screenRemote&&!y&&H().screensharing&&W(f)}else if("destroyed"===o)n.warn("The room has been destroyed!");else if("event"===o)if(void 0!==r.publishers&&null!==r.publishers&&1==r.publishers.length)n.debug("Got a list of available publishers"),_=r.publishers[0].id,w=r.publishers[0].display,audio=r.publishers[0].audio_codec,video=r.publishers[0].video_codec,G(_,0,audio,video);else if(void 0!==r.leaving&&null!==r.leaving){const i=r.leaving;if(n.log("Publisher left: "+i),null!=g&&_==i){n.debug("Feed "+g.rfid+" ("+g.rfdisplay+") has left the room, detaching"),g.detach();let r=t.remote;r.innerHTML="",r.style="",B(p),e&&e.onVideoClosed&&e.onVideoClosed()}}else if(void 0!==r.unpublished&&null!==r.unpublished){const e=r.unpublished;if(_!=e)return;if(n.log("Publisher left: "+e),"ok"===e)return void v.hangup();null!=g&&(n.debug("Feed "+g.rfid+" ("+g.rfdisplay+") has left the room, detaching"),g.detach())}else if(void 0!==r.display&&null!==r.display){if(!a.isJson(r.display))return;const t=JSON.parse(r.display),i=t.action||"",o=t.data||"";if("videortc-start-videorecording"===i){const t=JSON.parse(o);((t,r,n)=>{const i={request:"configure",record:!0,filename:`/videortc-records/${n}split-${t}-${r}-user`};v.send({message:i});const o={request:"recording",action:"start",audio:!0,video:!1,peer_audio:!0,peer_video:!1,filename:`/videortc-records/${n}split-${t}-${r}`};m.send({message:o}),e&&e.onStartRecording&&e.onStartRecording()})(p,a.pad(t.record_id,3),t.prefix),k=t.record_id}else"videortc-stop-videorecording"===i?B(p):e&&e.onNotified&&(n.debug("Notification received: "+i),e.onNotified(i,o))}else void 0!==r.error&&null!==r.error&&n.error(r.error);void 0!==i&&null!==i&&(n.debug("Handling SDP as well..."),n.debug(i),v.handleRemoteJsep({jsep:i}))},onlocalstream:r=>{let i=t.local;document.getElementById("videolocal1")||(i.innerHTML='<video class="is-local-video" poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" autoplay playsinline id="videolocal1"></video>');let o=document.getElementById("videolocal1");n.attachMediaStream(o,r),o.muted=!0;let a=r.getVideoTracks();if(null===a||void 0===a||0===a.length){if(!document.getElementById("no-cam-id-local")){let e=document.createElement("div");e.innerHTML="No camera available",e.style.position="relative",e.style.height="100%",e.style.width="100%",e.style.top="100%",e.style.left="50%",e.style.transform="translate(-50%,-50%)",e.className="no-camera-available",e.id="no-cam-id-local",i.insertBefore(e,i.firstChild)}document.getElementById("no-cam-id-local").style.display="block",e&&e.onReadyLocalStream&&e.onReadyLocalStream(!1,r)}else document.getElementById("no-cam-id-local")&&(document.getElementById("no-cam-id-local").style.display="none"),e&&e.onReadyLocalStream&&e.onReadyLocalStream(!0,r)},onremotestream:e=>{},oncleanup:()=>{},detached:()=>{}})},K=()=>new i((r,i)=>{l.module="",window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.sip",opaqueId:JSON.stringify(l),success:e=>{m=e,r()},error:e=>{i(e)},consentDialog:()=>{},mediaState:(e,t)=>{n.log("VideoGateway (AudioHandle) "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:e=>{n.log("VideoGateway (AudioHandle) says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:(t,r)=>{const i=t.error;if(null!=i&&void 0!=i)return n.error(i),void(e&&e.onHangup&&e.onHangup(t.error_code,i));const o=t.result;if(null!==o&&void 0!==o&&void 0!==o.event&&null!==o.event){const t=o.event;if("registration_failed"===t)return n.warn("Registration failed: "+o.code+" "+o.reason),void(e&&e.onRegisteredFailed&&e.onRegisteredFailed(o.reason));"registered"===t?m.createOffer({media:{audioSend:c.audioEnabled,audioRecv:!0,videoSend:!1,videoRecv:!1,audio:{deviceId:{exact:c.aDeviceId||void 0}},data:!1},stream:c.audioStream,success:e=>{T=C;let t=S||{};t["X-Split-Id"]=p+"";const r={request:"call",username:"videortc",uri:"sip:videortc@127.0.0.1:5099",headers:t};m.send({message:r,jsep:e})},error:e=>{n.error("WebRTC error...",e)}}):"calling"===t?(n.log("Waiting for the peer to answer..."),e&&e.onCalling&&e.onCalling()):"progress"===t?null!==r&&void 0!==r&&m.handleRemoteJsep({jsep:r,error:V}):"accepted"===t?(n.log("Accepted..."),null!==r&&void 0!==r&&m.handleRemoteJsep({jsep:r,error:V}),O()):"message"===t?(n.log("SIP Message received..."),e&&e.onSipMessage&&e.onSipMessage(o.sender,o.content)):"hangup"===t&&(n.log("Call hung up ("+o.code+" "+o.reason+")!"),m.hangup(),M(p),H().screensharing&&M(f),setTimeout(()=>{200===o.code&&window.VideoRTC.connection.handle.destroy(),e&&e.onHangup&&e.onHangup(o.code,o.reason)},500))}},onlocalstream:t=>{n.debug("AudioHandle: Local stream"),e&&e.onReadyLocalAudio&&e.onReadyLocalAudio()},onremotestream:r=>{if(n.debug("AudioHandle: Remote stream"),!document.getElementById("remote-audio")){let n=t.remote,i=document.createElement("div");i.style.display="none",i.innerHTML='<video poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" autoplay playsinline style="display:none;" id="remote-audio"></video>',n.parentNode.insertBefore(i,n.nextSibling),e&&e.onAcceptedAudio&&e.onAcceptedAudio({userName:T,sessionId:p},r)}n.attachMediaStream(document.getElementById("remote-audio"),r)},oncleanup:()=>{n.log("VideoGateway (AudioHandle) cleanup notification")},detached:()=>{n.log("VideoGateway (AudioHandle) detached notification")}})}),Y=()=>new i((e,t)=>{X(e,t)});return new i((e,t)=>{(()=>new i((e,t)=>{window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(l),success:t=>{h=t,p=window.VideoRTC.unique_ids[1],f=window.VideoRTC.unique_ids[2],e()},error:e=>{t(e)},consentDialog:e=>{},onmessage:(e,t)=>{const r=e.error;if(null!=r&&void 0!=r)return void n.error(r);const i=e.result;null!==i&&void 0!==i&&void 0!==i.event&&null!==i.event&&n.debug("Result (with event):"+i)},onlocalstream:e=>{},onremotestream:e=>{},oncleanup:()=>{},detached:()=>{}})}))().then(K).then(Y).then(()=>{e({call:N,closeUsecase:E,getLicense:H,hangup:V,notify:$,sendData:P,sendDtmf:I,setMode:Q,startScreensharing:J,stopScreensharing:z,toggleAudio:x,toggleAudioRemote:D,toggleVideo:j,replaceVideo:U})}).catch(e=>{t(e)})})})},{"../externals/janus":68,"../extra/utils":69,"../modules/datachannel":81,"./getDevices":73,"bluebird/js/release/bluebird":5}],77:[function(e,t,r){const n=e("../externals/janus"),i=e("bluebird/js/release/bluebird"),o=e("../modules/datachannel"),a=e("../extra/utils");r.videoCall=((e,t,r)=>{let s=null,c=null,d="Name",l=null,u=null,p=null,f=r&&r.stream?r.stream:{};f.aDeviceId||(f.aDeviceId=void 0),f.vDeviceId||(f.vDeviceId=void 0),f.resolution||(f.resolution=void 0);let h={};r&&r.account&&(h.account=r.account),h.module="video-call",h.device=window.VideoRTC.getDeviceInfo();let m=r&&r.display?r.display:{};const v=()=>{if(t)for(let e in t){if(!t.hasOwnProperty(e))continue;let r=t[e];r&&r.innerHTML&&(r.innerHTML="")}},g=(e,t)=>{u=e,p=t,s.send({message:{request:"list"}})},y=e=>{s.send({message:{request:"register",username:e||Date.now()+""}})},b=(e,t,r)=>{let n=128e3;"high"===r?n=256e3:"low"===r&&(n=64e3),s.send({message:{request:"set",audio:e,video:t,bitrate:n||64e3,record:!1}})},_=()=>{s.send({message:{request:"hangup"}}),s.hangup()},w=()=>{s.createAnswer({jsep:l,media:{data:!0},success:e=>{s.send({message:{request:"accept"},jsep:e})},error:e=>{n.error("WebRTC error:",e)}})},C=e=>{s.createOffer({media:{data:!0,audio:{deviceId:{exact:f.aDeviceId||void 0}},video:{deviceId:{exact:f.vDeviceId||void 0},width:a.videoResolutions(f.resolution).width,height:a.videoResolutions(f.resolution).height}},success:t=>{const r={request:"call",username:e};s.send({message:r,jsep:t})},error:e=>{n.error("WebRTC error...",e)}})},S=(e,t,r,n,i)=>{o.send(e,t,r,n,i)},T=()=>(s.isAudioMuted()?s.unmuteAudio():s.muteAudio(),s.isAudioMuted()),A=()=>(s.isVideoMuted()?s.unmuteVideo():s.muteVideo(),s.isVideoMuted());return new i((i,a)=>{window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videocall",opaqueId:JSON.stringify(h),success:t=>{s=t;const n=r&&r.dataChannel?r.dataChannel:{},a={fileOk:e.onFileTransferOk||function(){},fileKo:e.onFileTransferKo||function(){}};o.initialize(n,t,a)||console.log("Datachannel options can't be loaded:"),i({call:C,acceptCall:w,closeUsecase:v,getPeers:g,hangUp:_,register:y,sendData:S,setCall:b,toggleAudio:T,toggleVideo:A})},error:e=>{n.error("Error attaching plugin...",e),a(e)},consentDialog:e=>{},onmessage:(t,r)=>{r&&(l=r);const i=t.result;if(null!==i&&void 0!==i){if(void 0!==i.list&&null!==i.list){let t=[];if(u instanceof RegExp)for(let e=0;e<i.list.length;e++)u.test(i.list[e])&&t.push(i.list[e]);else t=i.list;"ASC"===p?t.sort():"DESC"===p&&t.reverse(),e&&e.onGotPeers&&e.onGotPeers(t)}else if(void 0!==i.event&&null!==i.event){const t=i.event;if("registered"===t)n.log("Successfully registered as "+i.username+"!"),e&&e.onRegistered&&e.onRegistered(i.username,!0);else if("calling"===t)n.log("Waiting for the peer to answer..."),e&&e.onCalling&&e.onCalling();else if("incomingcall"===t)n.log("Incoming call from "+i.username+"!"),d=i.username,e&&e.onIncomingCall&&e.onIncomingCall(i.username);else if("accepted"===t){const t=i.username;null===t||void 0===t?n.log("Call started"):(n.log(t+" accepted the call!"),d=t),null!==l&&void 0!==l&&s.handleRemoteJsep({jsep:l}),e&&e.onAccepted&&e.onAccepted(i.username)}else"hangup"===t?(n.log("Call hung up by "+i.username+" ("+i.reason+")"),s.hangup(),e&&e.onHangUp&&e.onHangUp(i.username,i.reason)):"set"===t&&e&&e.onSetCall&&e.onSetCall()}}else{const r=t.error;r.indexOf("already taken")>0&&e&&e.onRegistered&&e.onRegistered(r,!1),s.hangup(),null!==c&&null!==c&&clearInterval(c),c=null}},onlocalstream:e=>{n.debug(" ::: Got a local stream :::");let r=t.videos;if(!document.getElementById("localvideo")){let e=document.createElement("div");e.id="localvideo",e.className="videortc-video-container",e.innerHTML='<video class="is-local-video" autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="videolocal1"></video>',r.insertBefore(e,r.firstChild)}let i=document.getElementById("videolocal1");n.attachMediaStream(i,e),i.muted=!0;let o=e.getVideoTracks();if(null===o||void 0===o||0===o.length){if(!document.getElementById("no-cam-id-local")){let e=document.createElement("div");e.innerHTML="No camera available",e.style.position="relative",e.style.height="100%",e.style.width="100%",e.style.top="100%",e.style.left="50%",e.style.transform="translate(-50%,-50%)",e.className="no-camera-available",e.id="no-cam-id-local";let t=document.getElementById("localvideo");t.insertBefore(e,t.firstChild)}document.getElementById("no-cam-id-local").style.display="block"}else document.getElementById("no-cam-id-local")&&(document.getElementById("no-cam-id-local").style.display="none")},onremotestream:r=>{n.debug("Remote stream");const i=(e,t,r,n)=>{let i="";return i+='<span id="'+e+'" style="',i+=" position:absolute;margin:10px;padding:3px 5px;color:white;font-weight:bold;border-radius:5px;",i+="background:"+r+";",i+=n,i+='">'+t+"</span>"};let o=t.videos,a=document.getElementById("container-remote");if(!a||0===a.innerHTML.length){let e="",t=d;m&&m.namePattern&&m.namePattern instanceof RegExp&&(t=t.replace(m.namePattern,"")),e+='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="videoremote"></video>',e+=i("remote-name",t,"#55D8D5","left:0; margin-top: 10px;"),e+=i("remote-resolution","","#8DCC6D","left:0; margin-top: 40px;"),e+=i("remote-bitrate","","#FF6E5F","left:0; margin-top: 70px;");let r=document.createElement("div");r.id="container-remote",r.className="videortc-video-container",r.innerHTML=e,o.appendChild(r);const n=document.getElementById("videoremote");n.onplaying=(()=>{let e=n.videoWidth,t=n.videoHeight;document.getElementById("remote-resolution").innerHTML=e+"x"+t,"firefox"===window.VideoRTC.getBrowser()&&setTimeout(()=>{let e=n.videoWidth,t=n.videoHeight;document.getElementById("remote-resolution").innerHTML=e+"x"+t},2e3)})}let l=document.getElementById("videoremote");n.attachMediaStream(l,r);let u=r.getVideoTracks();if(null===u||void 0===u||0===u.length){if(!document.getElementById("no-cam-id-remote")){let e=document.createElement("div");e.innerHTML="No camera available",e.style.position="relative",e.style.height="100%",e.style.width="100%",e.style.top="100%",e.style.left="50%",e.style.transform="translate(-50%,-50%)",e.className="no-camera-available",e.id="no-cam-id-remote";let t=document.getElementById("container-remote");t.insertBefore(e,t.firstChild)}document.getElementById("no-cam-id-remote").style.display="block",e&&e.onRemoteStreamReady&&e.onRemoteStreamReady(!1,r)}else document.getElementById("no-cam-id-remote")&&(document.getElementById("no-cam-id-remote").style.display="none"),e&&e.onRemoteStreamReady&&e.onRemoteStreamReady(!0,r);null!==c&&null!==c&&clearInterval(c),c=null,c=setInterval(()=>{const e=s.getBitrate();document.getElementById("remote-bitrate").innerHTML=e},1e3)},ondataopen:e=>{n.log("The DataChannel is available!")},ondata:t=>{n.debug("We got data from the DataChannel! "+t);let r=d;m&&m.namePattern&&m.namePattern instanceof RegExp&&(r=r.replace(m.namePattern,"")),o.receive(t,e.onDataReceived,r)},oncleanup:()=>{n.log("Got a cleanup notification"),null!==c&&null!==c&&clearInterval(c),c=null},detached:()=>{}})})})},{"../externals/janus":68,"../extra/utils":69,"../modules/datachannel":81,"bluebird/js/release/bluebird":5}],78:[function(e,t,r){const n=e("../externals/janus"),i=e("bluebird/js/release/bluebird"),o=e("../extra/utils");r.videoMail=((e,t,r)=>{let a=null,s=null,c=1048576,d=r&&r.stream?r.stream:{};d.audioEnabled||(d.audioEnabled=!1),d.videoEnabled||(d.videoEnabled=!1),d.aDeviceId||(d.aDeviceId=void 0),d.vDeviceId||(d.vDeviceId=void 0),d.resolution||(d.resolution=void 0);let l={};r&&r.account&&(l.account=r.account),l.module="video-mail",l.device=window.VideoRTC.getDeviceInfo();const u=()=>{if(t)for(let e in t){if(!t.hasOwnProperty(e))continue;let r=t[e];r&&r.innerHTML&&(r.innerHTML="")}},p=(e,t)=>{const r=`${e}VideoMail-${t}-${Date.now()}`;a.send({message:{request:"configure","video-bitrate-max":c,"video-keyframe-interval":15e3}}),a.createOffer({media:{audioRecv:!1,audioSend:d.audioEnabled||!1,videoRecv:!1,videoSend:d.videoEnabled||!1,data:!1,audio:{deviceId:{exact:d.aDeviceId}},video:{deviceId:{exact:d.vDeviceId},width:o.videoResolutions(d.resolution).width,height:o.videoResolutions(d.resolution).height}},success:e=>{n.debug("Got SDP"),n.debug(e);const t={request:"record",name:r};a.send({message:t,jsep:e})},error:e=>{n.error("WebRTC error...",e),a.hangup()}})},f=()=>{a.send({message:{request:"stop"}}),a.hangup()},h=()=>(a.isAudioMuted()?a.unmuteAudio():a.muteAudio(),a.isAudioMuted()),m=()=>(a.isVideoMuted()?a.unmuteVideo():a.muteVideo(),a.isVideoMuted());return new i((r,i)=>{window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.recordplay",opaqueId:JSON.stringify(l),success:e=>{a=e,r({closeUsecase:u,startRecording:p,stopRecording:f,toggleAudio:h,toggleVideo:m})},error:e=>{n.error("Error attaching plugin...",e),i(e)},consentDialog:e=>{},onmessage:(r,i)=>{const o=r.result;if(null!==o&&void 0!==o&&void 0!==o.status&&null!==o.status){const r=o.status;if("recording"===r){null!==i&&void 0!==i&&a.handleRemoteJsep({jsep:i});const t=o.id;null!==t&&void 0!==t&&(n.log("The ID of the current recording is "+t),s=t),e&&e.onRecording&&e.onRecording()}else if("slow_link"===r)0!==o.uplink&&(c=parseInt(c/1.5),a.send({message:{request:"configure","video-bitrate-max":c,"video-keyframe-interval":15e3}}));else if("stopped"===r){if(n.log("Session has stopped"),o.id,null===s||void 0===s)return;t.videomail.innerHTML="",a.hangup(),null!==s&&e&&e.onStopped&&e.onStopped(),s=null}}},onlocalstream:e=>{n.debug("Got a local stream"),document.getElementById("vmail")||(t.videomail.innerHTML='<video class="is-local-video" autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="vmail"></video>');let r=document.getElementById("vmail");n.attachMediaStream(r,e),r.muted=!0;let i=e.getVideoTracks();if(null===i||void 0===i||0===i.length){if(!document.getElementById("no-cam-id-local")){let e=document.createElement("div");e.innerHTML="No camera available",e.style.position="relative",e.style.height="100%",e.style.width="100%",e.style.top="100%",e.style.left="50%",e.style.transform="translate(-50%,-50%)",e.className="no-camera-available",e.id="no-cam-id-local",container.insertBefore(e,container.firstChild)}document.getElementById("no-cam-id-local").style.display="block"}else document.getElementById("no-cam-id-local")&&(document.getElementById("no-cam-id-local").style.display="none")},onremotestream:e=>{},oncleanup:()=>{t.videomail.innerHTML=""},detached:()=>{}})})})},{"../externals/janus":68,"../extra/utils":69,"bluebird/js/release/bluebird":5}],79:[function(e,t,r){const n=e("../externals/janus"),i=e("bluebird/js/release/bluebird");r.videoPlayer=((e,t,r)=>{let o=null,a=null,s=null,c=null,d={};r&&r.account&&(d.account=r.account),d.module="video-player",d.device=window.VideoRTC.getDeviceInfo();const l=()=>{if(t)for(let e in t){if(!t.hasOwnProperty(e))continue;let r=t[e];r&&r.innerHTML&&(r.innerHTML="")}},u=(r,i)=>{if(c)return;let o=[],a=null;if(i){for(let e=0;e<s.length;e++)s[e].id===r&&(a=s[e].name);for(let e=0;e<s.length;e++)s[e].name===a&&o.push(s[e].id)}else o.push(r);o.forEach(r=>{c=!0,(r=>{let i=null,o=!1;d.module="",window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.recordplay",opaqueId:JSON.stringify(d),success:e=>{const t={request:"play",id:r};(i=e).send({message:t})},error:e=>{n.error("Error attaching plugin...",e)},consentDialog:e=>{},onmessage:(r,a)=>{n.debug("Got a message");const s=r.result;if(null!==s&&void 0!==s){if(void 0!==s.status&&null!==s.status){const r=s.status;"preparing"===r||"refreshing"===r?(n.log("Preparing the recording playout"),i.createAnswer({jsep:a,media:{audioSend:!1,videoSend:!1},success:e=>{n.debug("Got SDP"),n.debug(e),i.send({message:{request:"start"},jsep:e})},error:e=>{n.error("WebRTC error:",e)}})):"slow_link"===r?0!==s.uplink&&(bandwidth=parseInt(bandwidth/1.5),i.send({message:{request:"configure","video-bitrate-max":bandwidth,"video-keyframe-interval":15e3}})):"playing"===r?n.log("Playout has started"):"stopped"===r&&(n.log("Session has stopped"),s.id,c&&e&&e.onStopped&&e.onStopped(),c=!1,t.videoplayer.innerHTML="",o=!1,i.detach())}}else null!==r.error&&r.error},onlocalstream:e=>{},onremotestream:e=>{if(o)return;o=!0;const r=Date.now();let i=t.videoplayer,a=document.getElementById("container-videoplayer"+r),s="";if(!a||0===a.innerHTML.length){s+='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="videoplayer-'+r+'"></video>';let t=document.createElement("div");t.id="container-videoplayer"+r,t.innerHTML=s,i.appendChild(t);let o=document.getElementById("videoplayer-"+r);n.attachMediaStream(o,e);let a=e.getVideoTracks();if(null===a||void 0===a||0===a.length){let e=document.createElement("div");e.innerHTML="No camera available",e.style.position="relative",e.style.height="100%",e.style.width="100%",e.style.top="100%",e.style.left="50%",e.style.transform="translate(-50%,-50%)",e.className="no-camera-available",i.insertBefore(e,i.firstChild)}}},oncleanup:()=>{i.send({message:{request:"stop"}})}})})(r)})},p=(e,t)=>new i((r,i)=>{o.send({message:{request:"update"},success:i=>{o.send({message:{request:"list"},success:i=>{if(null!==i&&void 0!==i){if(void 0!==i.list&&null!==i.list){let n=i.list;n.sort((e,t)=>e.date<t.date?1:t.date<e.date?-1:0),s=n;let o=[],c=null;for(let r in n)if(n[r].id,n[r].name,n[r].date,e.test(n[r].name)){if(c=!0,!t)for(let e=0;e<o.length;e++)-1!==o[e].name.toLowerCase().indexOf(n[r].name.toLowerCase())&&(c=!1);c&&o.push({id:n[r].id,name:n[r].name,date:n[r].date})}r(a=o)}}else n.error("Got no response to our query for available recordings")}})}})});return new i((e,t)=>{window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.recordplay",opaqueId:JSON.stringify(d),success:t=>{o=t,e({closeUsecase:l,getRecords:p,playRecord:u})},error:e=>{n.error("Error attaching plugin...",e),t(e)},consentDialog:e=>{},webrtcState:e=>{n.log("VideoGateway says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:(e,t)=>{const r=e.result;if(null!==r&&void 0!==r){if(void 0!==r.status&&null!==r.status){const e=r.status;"preparing"===e||"refreshing"===e?(n.log("Preparing the recording playout"),o.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1},success:e=>{n.debug("Got SDP!"),n.debug(e),o.send({message:{request:"start"},jsep:e})},error:e=>{n.error("WebRTC error:",e)}}),r.warning&&n.warn(r.warning)):"slow_link"===e?0!==r.uplink&&(bandwidth=parseInt(bandwidth/1.5),o.send({message:{request:"configure","video-bitrate-max":bandwidth,"video-keyframe-interval":15e3}})):"playing"===e?n.log("Playout has started"):"stopped"===e&&(n.log("Session has stopped"),o.hangup())}}else{const t=e.error;n.error(t),o.hangup()}},onlocalstream:e=>{},onremotestream:e=>{},oncleanup:()=>{n.log("Got a cleanup notification")},detached:()=>{}})})})},{"../externals/janus":68,"bluebird/js/release/bluebird":5}],80:[function(e,t,r){const n=e("../externals/janus"),i=e("bluebird/js/release/bluebird"),o=e("../modules/datachannel"),a=e("../extra/utils");r.videoRoom=((e,t,r)=>{if(!t||!t.videos||1!==t.videos.nodeType)return null;let s=r&&r.stream?r.stream:{};s.audioEnabled||(s.audioEnabled=!1),s.videoEnabled||(s.videoEnabled=!1),s.aDeviceId||(s.aDeviceId=void 0),s.vDeviceId||(s.vDeviceId=void 0),s.resolution||(s.resolution=void 0),s.voiceProcessor||(s.voiceProcessor=!1);let c={};r&&r.account&&(c.account=r.account),c.module="video-room",c.device=window.VideoRTC.getDeviceInfo();let d,l=null,u=null,p=[],f=[],h=1,m=null,v=null;const g=()=>{if(t)for(let e in t){if(!t.hasOwnProperty(e))continue;let r=t[e];r&&r.innerHTML&&(r.innerHTML="")}},y=(t,r,n,i,o,a)=>{let s=128e3,c=o;"high"===i.toLowerCase()&&(s=256e3),"medium"===i.toLowerCase()&&(s=128e3),"low"===i.toLowerCase()&&(s=64e3),o>6&&(c=6);const d={request:"create",is_private:t||!0,secret:r||Date.now()+"",bitrate:s,publishers:c||6,record:a||!1};n&&(d.pin=n),l.send({message:d,success:t=>{e&&e.onCreated&&e.onCreated(t.room)}})},b=(e,t)=>{const r={request:"destroy",room:e,secret:t};l.send({message:r})},_=(e,t,r)=>{v=e||"Peer";let n={request:"join",room:d=t||1234,ptype:"publisher",display:v};r&&(m=r,n.pin=m),l.send({message:n})},w=()=>h,C=()=>(l.isAudioMuted()?l.unmuteAudio():l.muteAudio(),l.isAudioMuted()),S=()=>(l.isVideoMuted()?l.unmuteVideo():l.muteVideo(),l.isVideoMuted()),T=(r,i,a,l)=>{let u=null,v=!1;c.module="",window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(c),success:e=>{u=e;let t={request:"join",room:d||1234,ptype:"subscriber",feed:r};m&&(t.pin=m),"safari"!==n.webRTCAdapter.browserDetails.browser||"vp9"!==l&&("vp8"!==l||n.safariVp8)||(l&&(l=l.toUpperCase()),t.offer_video=!1),u.videoCodec=l,u.send({message:t})},error:e=>{n.error("Error attaching plugin...",e)},onmessage:(t,r)=>{n.debug("Got a message (subscriber)");const i=t.videoroom;if(n.debug("Event: "+i),void 0!==t.error&&null!==t.error)n.error(t.error),e&&e.onError&&e.onError(t.error,t.error_code);else if(void 0!=i&&null!=i&&"attached"===i){for(let e=1;e<6;e++)if(void 0===p[e]||null===p[e]){p[e]=u,u.rfindex=e;break}u.rfid=t.id,u.rfdisplay=t.display,n.log("Successfully attached to feed "+u.rfid+" ("+u.rfdisplay+") in room "+t.room)}void 0!==r&&null!==r&&(n.debug("Handling SDP as well..."),n.debug(r),u.createAnswer({jsep:r,media:{audioSend:!1,videoSend:!1,data:!0},success:e=>{n.debug("Got SDP"),n.debug(e);const t={request:"start",room:d};u.send({message:t,jsep:e})},error:e=>{n.error("WebRTC error:",e)}}))},webrtcState:e=>{n.log("VideoGateway says this WebRTC PeerConnection (feed #"+u.rfindex+") is "+(e?"up":"down")+" now")},onlocalstream:e=>{},onremotestream:e=>{if(v)return;v=!0,n.debug("Remote feed #"+u.rfindex);const r=(e,t,r,n)=>{let i="";return i+='<span id="'+e+'" style="',i+=" position:absolute;margin:10px;padding:3px 5px;color:white;font-weight:bold;border-radius:5px;",i+="background:"+r+";",i+=n,i+='">'+t+"</span>"};let i=t.videos,o=document.getElementById("container-remote"+u.rfindex),a="";if(!o||0===o.innerHTML.length){h++,a+='<video autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="videoremote'+u.rfindex+'"></video>',a+=r("remote-name"+u.rfindex,u.rfdisplay,"#55D8D5","left:0; margin-top: 10px;"),a+=r("remote-resolution"+u.rfindex,"","#8DCC6D","left:0; margin-top: 40px;"),a+=r("remote-bitrate"+u.rfindex,"","#FF6E5F","left:0; margin-top: 70px;");let t=document.createElement("div");t.id="container-remote"+u.rfindex,t.className="videortc-video-container",t.innerHTML=a,i.appendChild(t);const o=document.getElementById("videoremote"+u.rfindex);o.onplaying=(()=>{let e=o.videoWidth,t=o.videoHeight;document.getElementById("remote-resolution"+u.rfindex).innerHTML=e+"x"+t,"firefox"===window.VideoRTC.getBrowser()&&setTimeout(()=>{let e=o.videoWidth,t=o.videoHeight;document.getElementById("remote-resolution"+u.rfindex).innerHTML=e+"x"+t},2e3)}),n.attachMediaStream(o,e);let c=e.getVideoTracks();if(null===c||void 0===c||0===c.length){let r=document.createElement("div");if(r.innerHTML="No camera available",r.style.position="relative",r.style.height="100%",r.style.width="100%",r.style.top="100%",r.style.left="50%",r.style.transform="translate(-50%,-50%)",r.className="no-camera-available",t.insertBefore(r,t.firstChild),s.voiceProcessor){r.innerHTML="";let t=document.createElement("span");t.className="volume-level-processor",r.insertBefore(t,r.firstChild),k(e,t)}for(let e=0;e<t.childNodes.length;e++)t.childNodes[e].id&&(t.childNodes[e].id.indexOf("remote-resolution")>=0||t.childNodes[e].id.indexOf("remote-bitrate")>=0)&&(t.childNodes[e].style.display="none")}f[u.rfindex]=setInterval(()=>{const e=u.getBitrate();document.getElementById("remote-bitrate"+u.rfindex).innerHTML=e},1e3)}},oncleanup:()=>{n.log(" ::: Got a cleanup notification (remote feed "+r+") :::"),null!==f[u.rfindex]&&clearInterval(f[u.rfindex]),f[u.rfindex]=null},ondataopen:()=>{n.log("The DataChannel is available!"),e&&e.onAcceptedData&&e.onAcceptedData()},ondata:t=>{n.debug("We got data from the DataChannel! "+t),o.receive(t,e.onDataReceived)}})},A=()=>{l.createOffer({media:{audioRecv:!1,audioSend:s.audioEnabled,videoRecv:!1,videoSend:s.videoEnabled,data:!0,audio:{deviceId:{exact:s.aDeviceId||void 0}},video:{deviceId:{exact:s.vDeviceId||void 0},width:a.videoResolutions(s.resolution).width,height:a.videoResolutions(s.resolution).height}},success:e=>{l.send({message:{request:"configure",audio:!0,video:!0,data:!0,audiocodec:"opus",videocodec:"vp8"},jsep:e})},error:e=>{n.error("WebRTC error:",e),A()}})},k=(e,t)=>{let r=new AudioContext,n=r.createMediaStreamSource(e),i=r.createAnalyser();i.smoothingTimeConstant=.3,i.fftSize=1024;let o=r.createScriptProcessor(2048,1,1);o.onaudioprocess=(e=>{let r=new Uint8Array(i.frequencyBinCount);i.getByteFrequencyData(r);let n=0;for(let e=0;e<r.length;e++)n+=r[e];n/=r.length,n*=.7,t.style.border="solid "+n+"px",t.style["border-radius"]=15+n+"px"}),n.connect(i),i.connect(o),o.connect(r.destination)},R=e=>{c.module="",window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(c),success:t=>{u=t;const r={request:"join",room:e,ptype:"publisher",display:v+"-screen"||"ScreenClient"};m&&(r.pin=m),u.send({message:r})},error:e=>{n.error("Error: "+e)},consentDialog:e=>{},onmessage:(e,t)=>{const r=e.videoroom;if(void 0!==r&&null!==r)if("joined"===r){if(void 0!==e.publishers&&null!==e.publishers){const t=e.publishers;n.debug("Got a list of available publishers/feeds:"),n.debug(t);for(let e in t){const r=t[e].id,i=t[e].display;n.debug("  >> ["+r+"] "+i)}}}else if("destroyed"===r)n.warn("The room has been destroyed");else if("event"===r)if(void 0!==e.publishers&&null!==e.publishers){const t=e.publishers;n.debug("Got a list of available publishers/feeds:"),n.debug(t);for(let e in t){const r=t[e].id,i=t[e].display;n.debug("  >> ["+r+"] "+i)}}else if(void 0!==e.leaving&&null!==e.leaving){const t=e.leaving;n.log("Publisher left: "+t)}else if(void 0!==e.unpublished&&null!==e.unpublished){const t=e.unpublished;n.log("Publisher left: "+t)}else void 0!==e.error&&null!==e.error&&n.error(e.error);void 0!==t&&null!==t&&(n.debug("Handling SDP as well..."),n.debug(t),u.handleRemoteJsep({jsep:t}))},onlocalstream:e=>{},onremotestream:e=>{},oncleanup:()=>{},detached:()=>{}})},E=(e,t,r)=>"https:"!==window.location.protocol?(r("Screensharing requires HTTPS"),!1):window.isMobile?(r("Screensharing is not available on Mobile devices"),!1):n.isExtensionEnabled()?void u.createOffer({media:{video:"screen",audio:!1,videoRecv:!1},success:e=>{u.send({message:{request:"configure",audio:!1,video:!0,data:!1,audiocodec:"opus",videocodec:"vp8"},jsep:e}),t()},error:e=>{n.error(e),e&&"NotAllowedError"===e.name&&"firefox"===window.getBrowser()&&r("Firefox needs that the domain this web application is from is listed in Allowed domains."),n.error("WebRTC error:",e)}}):(r("You're using a recent version of Chrome but don't have the screensharing extension installed: click <b><a href='https://chrome.google.com/webstore/detail/videortc-screensharing/pkilckpboojemoogepfpkgbihkfkikel' target='_blank'>here</a></b> to do so"),!1),P=(e,t)=>{u.send({message:{request:"leave"}}),u.detach(),R(d),e()},I=(e,t,r,n,i)=>{o.send(e,t,r,n,i)};return new i((r,i)=>{window.VideoRTC.connection.handle.attach({plugin:"videortc.plugin.videoroom",opaqueId:JSON.stringify(c),success:t=>{l=t;const i={fileOk:e.onFileTransferOk||function(){},fileKo:e.onFileTransferKo||function(){}};o.initialize({},t,i)||n.warn("Datachannel options can't be loaded:"),r({closeUsecase:g,createVideoroom:y,destroyVideoroom:b,getPeers:w,joinVideoroom:_,sendData:I,startScreensharing:E,stopScreensharing:P,toggleAudio:C,toggleVideo:S})},error:t=>{n.error("Error attaching plugin...",t),e&&e.onError&&e.onError(468,t),i(t)},consentDialog:e=>{n.debug("Consent dialog should be "+(e?"on":"off")+" now")},mediaState:(e,t)=>{n.log("VideoGateway "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:e=>{n.log("VideoGateway says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:(t,r)=>{const i=t.videoroom;if(n.debug("Event: "+i),void 0!==i&&null!==i)if("joined"===i){if(A(),void 0!==t.publishers&&null!==t.publishers){const e=t.publishers;n.debug("Got a list of available publishers/feeds:"),n.debug(e);for(let t in e){const r=e[t].id,i=e[t].display,o=e[t].audio_codec,a=e[t].video_codec;n.debug("  >> ["+r+"] "+i+" (audio: "+o+", video: "+a+")"),T(r,0,0,a)}}e&&e.onJoined&&e.onJoined(),R(d)}else if("destroyed"===i)n.warn("The room has been destroyed"),e&&e.onDestroyed&&e.onDestroyed();else if("event"===i)if(void 0!==t.publishers&&null!==t.publishers){const r=t.publishers;let i,o;n.debug("Got a list of available publishers/feeds:"),n.debug(r);for(let e in r){i=r[e].id,o=r[e].display;const t=r[e].audio_codec,a=r[e].video_codec;n.debug("  >> ["+i+"] "+o+" (audio: "+t+", video: "+a+")"),T(i,0,0,a)}e&&e.onPeerJoined&&e.onPeerJoined(i,o)}else if(void 0!==t.leaving&&null!==t.leaving){const r=t.leaving;n.log("Publisher left: "+r);let i=null;for(let e=1;e<6;e++)if(null!=p[e]&&void 0!=p[e]&&p[e].rfid==r){i=p[e];break}null!=i&&(h--,n.debug("Feed "+i.rfid+" ("+i.rfdisplay+") has left the room, detaching"),e&&e.onPeerLeft&&e.onPeerLeft(i.rfid,i.rfdisplay),document.getElementById("container-remote"+i.rfindex).remove(),p[i.rfindex]=null,i.detach())}else if(void 0!==t.unpublished&&null!==t.unpublished){const r=t.unpublished;if(n.log("Publisher left: "+r),"ok"===r)return void l.hangup();let i=null;for(let e=1;e<6;e++)if(null!=p[e]&&void 0!=p[e]&&p[e].rfid==r){i=p[e];break}null!=i&&(h--,n.debug("Feed "+i.rfid+" ("+i.rfdisplay+") has left the room, detaching"),e&&e.onPeerLeft&&e.onPeerLeft(i.rfid,i.rfdisplay),document.getElementById("container-remote"+i.rfindex).remove(),p[i.rfindex]=null,i.detach())}else void 0!==t.error&&null!==t.error&&e&&e.onError&&e.onError(t.error,t.error_code);void 0!==r&&null!==r&&(n.debug("Handling SDP as well..."),n.debug(r),l.handleRemoteJsep({jsep:r}))},onlocalstream:r=>{n.debug("Got a local stream");let i=t.videos,o=document.createElement("div");o.id="localvideo",o.className="videortc-video-container",o.innerHTML='<video class="is-local-video" autoplay playsinline poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" id="videolocal1"></video>',i.insertBefore(o,i.firstChild);let a=document.getElementById("videolocal1");n.attachMediaStream(a,r),a.muted=!0;let c=r.getVideoTracks();if(null===c||void 0===c||0===c.length){let t=document.createElement("div");if(t.innerHTML="No camera available",t.style.position="relative",t.style.height="100%",t.style.width="100%",t.style.top="100%",t.style.left="50%",t.style.transform="translate(-50%,-50%)",t.className="no-camera-available",o.insertBefore(t,o.firstChild),s.voiceProcessor){t.innerHTML="";let e=document.createElement("span");e.className="volume-level-processor",t.insertBefore(e,t.firstChild),k(r,e)}e&&e.onReadyLocalStream&&e.onReadyLocalStream(!1,r)}else e&&e.onReadyLocalStream&&e.onReadyLocalStream(!0,r)},onremotestream:e=>{},oncleanup:()=>{n.log("Got a cleanup notification: we are unpublished now")},detached:()=>{n.log("Got a detached notification")}})})})},{"../externals/janus":68,"../extra/utils":69,"../modules/datachannel":81,"bluebird/js/release/bluebird":5}],81:[function(e,t,r){const n=e("../extra/utils"),i={dataEnabled:!0,allowedTypes:["application/x-chat","text/plain","application/pdf","application/zip","application/x-rar","image/jpeg","image/png","application/x-docx","application/x-pptx","application/x-xlsx","application/vnd.oasis.opendocument.text"],maxSize:5,fileTransmission:{timeout:5,retransmissionDelay:10}};let o=void 0,a=[],s=[],c=[],d=void 0,l=void 0;const u=()=>window.debugTx;u()&&(window.datainfo=a,window.sendedinfo=s,window.reconstructionWatchers=c);const p=e=>{let t=!0;return e.dataEnabled&&!0!==e.dataEnabled&&!1!==e.dataEnabled&&(t=!1),e.allowedTypes&&"[object Array]"!==Object.prototype.toString.call(e.allowedTypes)&&(t=!1),e.maxSize&&!/^\d+$/.test(e.maxSize)&&(t=!1),t},f=(e,t)=>{const r={type:"data-channel-control",action:"file-rtx",fileId:e,chunkNb:t};o.data({text:JSON.stringify(r),success:()=>{u()&&console.log("Sended missing fragments msg",r)},error:()=>{u()&&console.error("Error sending missing fragments msg",r)}})},h=e=>{let t=null,r=null;const n=()=>setInterval(()=>{s()&&d();const t=i();u()&&console.log(`Fragments missing from file [${e}]: ${t.length}`),t.length>0&&(h(t),p())},1e3*l.fileTransmission.retransmissionDelay),i=()=>a[e].map((e,t)=>"__NO_VALUE__"===e?t:void 0).filter(e=>void 0!==e),s=()=>{const e=new Date,r=Math.abs(e-t);return Math.floor(r/1e3/60)>=l.fileTransmission.timeout},d=()=>{m(),(e=>{const t={type:"data-channel-control",action:"file-ko",fileId:e};o.data({text:JSON.stringify(t),success:()=>{u()&&console.log("Sended bad transmission msg",t)},error:()=>{u()&&console.error("Error sending bad transmission msg",t)}})})(e),delete c[e]},p=()=>{clearInterval(r),r=n()},h=t=>{for(;t.length;){(t=>{setTimeout(()=>{f(e,t)},1)})(t.splice(0,100))}},m=()=>{clearInterval(r)};return{init:()=>{u()&&console.log(`Creating new file reconstructor for file id: ${e}`),t=new Date,r=n()},refresh:p,destroy:m}},m=e=>{switch(e.action){case"file-ok":u()&&console.log(`File ${s[e.fileId].filename} received correctly`),delete s[e.fileId],d.fileOk(e.fileId);break;case"file-ko":u()&&console.log(`File ${s[e.fileId].filename} not received correctly`),delete s[e.fileId],d.fileKo(e.fileId);break;case"file-rtx":e.chunkNb.forEach(t=>{((e,t)=>{const r=s[e],n={id:e,type:r.type,indexFragment:t,numberFragments:r.fragments.length,fragmentData:r.fragments[t],filename:r.filename};o.data({text:JSON.stringify(n),success:()=>{delete n.fragmentData,u()&&console.log("Sended rtx fragment msg",n)},error:()=>{delete n.fragmentData,u()&&console.error("Error sending rtx fragment msg",n)}})})(e.fileId,t)})}};var v,g;t.exports={initialize:(e,t,r)=>{const a=p(e);return a&&(l=n.mergeDataChannelOptions(i,e),o=t,d=r),a},receive:(e,t,r)=>{if(l.dataEnabled){let n=JSON.parse(e);if("data-channel-control"===n.type)return void m(n);if(n.filename&&u()&&console.log("Received data",n.filename,n.id,n.numberFragments),!a[n.id]&&0===n.indexFragment&&(a[n.id]=new Array(n.numberFragments),a[n.id].fill("__NO_VALUE__"),n.filename)){let e=h(n.id);e.init(),c[n.id]=e}if(n.filename&&!c[n.id])return;if(a[n.id][n.indexFragment]=n.fragmentData,n.filename&&c[n.id]&&c[n.id].refresh(),v=a[n.id],g=n.numberFragments,v.filter(e=>null!==e&&"__NO_VALUE__"!==e).length>=g){let e="";for(let t=0;t<n.numberFragments;t++)a[n.id]&&a[n.id][t]&&(e+=a[n.id][t]);let i={type:n.type,data:e};n.filename&&(i.filename=n.filename),t&&t(i.type,i.data,i.filename,r),delete a[n.id],n.filename&&((e=>{const t={type:"data-channel-control",action:"file-ok",fileId:e};o.data({text:JSON.stringify(t),success:()=>{u()&&console.log("Sended confirmation msg",t)},error:()=>{u()&&console.error("Error sending confirmation msg",t)}})})(n.id),c[n.id].destroy(),delete c[n.id])}}},send:(e,t,r,i,a)=>{if(l.dataEnabled)if(-1===l.allowedTypes.indexOf(e))i&&i(`Sorry! Type ${e} is not allowed.`);else{const c=parseInt(.75*t.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"").length)/1048576;if(c>l.maxSize)i&&i(`Sorry! The file is too big. Maximum file size is ${l.maxSize}MB`);else{const d=t.match(/.{1,1000}/g),l=a?n.generateFileId(a):Date.now();a&&(s[l]={filename:a,type:e,fragments:d});let p=0;a&&u()&&console.log(`Sending file [${a}] of size ${c}MB in ${d.length} chunks`);for(let t=0;t<d.length;t++){let n={id:l,type:e,indexFragment:t,numberFragments:d.length,fragmentData:d[t]};a&&(n.filename=a),((e,t)=>{const n=Math.floor((e+1)/100);setTimeout(()=>{o.data({text:JSON.stringify(t),success:()=>{++p>=d.length&&r&&r(l)},error:e=>{i&&i(e)}})},n)})(t,n)}}}else i&&i("Sorry! Datachannel is not enabled.")}}},{"../extra/utils":69}]},{},[70]);
//# sourceMappingURL=videortc.min.js.map
